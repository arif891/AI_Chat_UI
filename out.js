(()=>{var Gt=Object.defineProperty;var ee=e=>s=>{var t=e[s];if(t)return t();throw new Error("Module not found in bundle: "+s)};var c=(e,s)=>()=>(e&&(s=e(e=0)),s);var d=(e,s)=>{for(var t in s)Gt(e,t,{get:s[t],enumerable:!0})};var ce={};d(ce,{default:()=>Yt});var Yt,de=c(()=>{Yt=[{type:"cmnt",match:/(;|#).*/gm},{expand:"str"},{expand:"num"},{type:"num",match:/\$[\da-fA-F]*\b/g},{type:"kwd",match:/^[a-z]+\s+[a-z.]+\b/gm,sub:[{type:"func",match:/^[a-z]+/g}]},{type:"kwd",match:/^\t*[a-z][a-z\d]*\b/gm},{match:/%|\$/g,type:"oper"}]});var he={};d(he,{default:()=>G});var le,G,$=c(()=>{le={type:"var",match:/\$\w+|\${[^}]*}|\$\([^)]*\)/g},G=[{sub:"todo",match:/#.*/g},{type:"str",match:/(["'])((?!\1)[^\r\n\\]|\\[^])*\1?/g,sub:[le]},{type:"oper",match:/(?<=\s|^)\.*\/[a-z/_.-]+/gi},{type:"kwd",match:/\s-[a-zA-Z]+|$<|[&|;]+|\b(unset|readonly|shift|export|if|fi|else|elif|while|do|done|for|until|case|esac|break|continue|exit|return|trap|wait|eval|exec|then|declare|enable|local|select|typeset|time|add|remove|install|update|delete)(?=\s|$)/g},{expand:"num"},{type:"func",match:/(?<=(^|\||\&\&|\;)\s*)[a-z_.-]+(?=\s|$)/gmi},{type:"bool",match:/(?<=\s|^)(true|false)(?=\s|$)/g},{type:"oper",match:/[=(){}<>!]+/g},{type:"var",match:/(?<=\s|^)[\w_]+(?=\s*=)/g},le]});var ue={};d(ue,{default:()=>Zt});var Zt,ge=c(()=>{Zt=[{type:"kwd",match:/\b(echo|set|if|else|for|goto|call|exit|pause)\b/gi},{type:"var",match:/%[a-zA-Z0-9_]+%/g},{type:"str",match:/"(?:\\.|[^"])*"/g},{type:"cmnt",match:/::.*/g},{type:"cmnt",match:/rem .*/gi},{type:"oper",match:/(=|==|!=|<|>|<=|>=)/g},{type:"num",match:/\b\d+\b/g}]});var me={};d(me,{default:()=>Wt});var Wt,Ee=c(()=>{Wt=[{match:/[^\[\->+.<\]\s].*/g,sub:"todo"},{type:"func",match:/\.+/g},{type:"kwd",match:/[<>]+/g},{type:"oper",match:/[+-]+/g}]});var pe={};d(pe,{default:()=>B});var B,F=c(()=>{B=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/#\s*include (<.*>|".*")/g,sub:[{type:"str",match:/(<|").*/g}]},{match:/asm\s*{[^}]*}/g,sub:[{type:"kwd",match:/^asm/g},{match:/[^{}]*(?=}$)/g,sub:"asm"}]},{type:"kwd",match:/\*|&|#[a-z]+\b|\b(asm|auto|double|int|struct|break|else|long|switch|case|enum|register|typedef|char|extern|return|union|const|float|short|unsigned|continue|for|signed|void|default|goto|sizeof|volatile|do|if|static|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var be={};d(be,{default:()=>jt});var jt,fe=c(()=>{F();jt=[...B]});var ye={};d(ye,{default:()=>Xt});var Xt,Ie=c(()=>{Xt=[{type:"kwd",match:/\b(using|namespace|class|public|static|void|string|int|bool|if|else|for|foreach|while|return|new|try|catch|finally|throw)\b/g},{type:"type",match:/\b(Console|WriteLine|List|Dictionary|Exception|Task|Thread)\b/g},{type:"str",match:/"(?:\\.|[^"])*"/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"cmnt",match:/\/\/.*/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||\?|:)/g}]});var _e={};d(_e,{default:()=>Vt});var Vt,Te=c(()=>{Vt=[{match:/\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/@\w+\b|\b(and|not|only|or)\b|\b[a-z-]+(?=[^{}]*{)/g},{type:"var",match:/\b[\w-]+(?=\s*:)|(::?|\.)[\w-]+(?=[^{}]*{)/g},{type:"func",match:/#[\w-]+(?=[^{}]*{)/g},{type:"num",match:/#[\da-f]{3,8}/g},{type:"num",match:/\d+(\.\d+)?(cm|mm|in|px|pt|pc|em|ex|ch|rem|vm|vh|vmin|vmax|%)?/g,sub:[{type:"var",match:/[a-z]+|%/g}]},{match:/url\([^)]*\)/g,sub:[{type:"func",match:/url(?=\()/g},{type:"str",match:/[^()]+/g}]},{type:"func",match:/\b[a-zA-Z]\w*(?=\s*\()/g},{type:"num",match:/\b[a-z-]+\b/g}]});var Ae={};d(Ae,{default:()=>Qt});var Qt,we=c(()=>{Qt=[{expand:"strDouble"},{type:"oper",match:/,/g}]});var Ce={};d(Ce,{default:()=>Jt});var Jt,Ne=c(()=>{Jt=[{type:"kwd",match:/\b(import|export|library|part of|part|class|extends|with|implements|mixin|enum|typedef|abstract|static|final|const|factory|operator|get|set|return|if|else|for|while|do|switch|case|default|break|continue|assert|try|catch|finally|throw|rethrow|async|await|yield|late|required)\b/g},{type:"type",match:/\b(int|double|num|String|bool|List|Map|Set|dynamic|void|Object)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/'(.*?)'|"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=|\?\?)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var Le={};d(Le,{default:()=>K});var K,z=c(()=>{K=[{type:"deleted",match:/^[-<].*/gm},{type:"insert",match:/^[+>].*/gm},{type:"kwd",match:/!.*/gm},{type:"section",match:/^@@.*@@$|^\d.*|^([*-+])\1\1.*/gm}]});var xe={};d(xe,{default:()=>es});var es,Se=c(()=>{$();es=[{type:"kwd",match:/^(FROM|RUN|CMD|LABEL|MAINTAINER|EXPOSE|ENV|ADD|COPY|ENTRYPOINT|VOLUME|USER|WORKDIR|ARG|ONBUILD|STOPSIGNAL|HEALTHCHECK|SHELL)\b/gmi},...G]});var Re={};d(Re,{default:()=>ts});var ts,Oe=c(()=>{z();ts=[{match:/^#.*/gm,sub:"todo"},{expand:"str"},...K,{type:"func",match:/^(\$ )?git(\s.*)?$/gm},{type:"kwd",match:/^commit \w+$/gm}]});var ke={};d(ke,{default:()=>ss});var ss,ve=c(()=>{ss=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\*|&|\b(break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go|goto|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"oper",match:/[+\-*\/%&|^~=!<>.^-]+/g}]});var Me={};d(Me,{default:()=>q,name:()=>T,properties:()=>A,xmlElement:()=>I});var De,ns,T,A,I,q,Y=c(()=>{De=":A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD",ns=De+"\\-\\.0-9\xB7\u0300-\u036F\u203F-\u2040",T=`[${De}][${ns}]*`,A=`\\s*(\\s+${T}\\s*(=\\s*([^"']\\S*|("|')(\\\\[^]|(?!\\4)[^])*\\4?)?)?\\s*)*`,I={match:RegExp(`<[/!?]?${T}${A}[/!?]?>`,"g"),sub:[{type:"var",match:RegExp(`^<[/!?]?${T}`,"g"),sub:[{type:"oper",match:/^<[\/!?]?/g}]},{type:"str",match:/=\s*([^"']\S*|("|')(\\[^]|(?!\2)[^])*\2?)/g,sub:[{type:"oper",match:/^=/g}]},{type:"oper",match:/[\/!?]?>/g},{type:"class",match:RegExp(T,"g")}]},q=[{match:/<!--((?!-->)[^])*-->/g,sub:"todo"},{type:"class",match:/<!\[CDATA\[[\s\S]*?\]\]>/gi},I,{type:"str",match:RegExp(`<\\?${T}([^?]|\\?[^?>])*\\?+>`,"g"),sub:[{type:"var",match:RegExp(`^<\\?${T}`,"g"),sub:[{type:"oper",match:/^<\?/g}]},{type:"oper",match:/\?+>$/g}]},{type:"var",match:/&(#x?)?[\da-z]{1,8};/gi}]});var Ue={};d(Ue,{default:()=>as});var as,He=c(()=>{Y();as=[{type:"class",match:/<!DOCTYPE("[^"]*"|'[^']*'|[^"'>])*>/gi,sub:[{type:"str",match:/"[^"]*"|'[^']*'/g},{type:"oper",match:/^<!|>$/g},{type:"var",match:/DOCTYPE/gi}]},{match:RegExp(`<style${A}>((?!</style>)[^])*</style\\s*>`,"g"),sub:[{match:RegExp(`^<style${A}>`,"g"),sub:I.sub},{match:RegExp(`${I.match}|[^]*(?=</style\\s*>$)`,"g"),sub:"css"},I]},{match:RegExp(`<script${A}>((?!<\/script>)[^])*<\/script\\s*>`,"g"),sub:[{match:RegExp(`^<script${A}>`,"g"),sub:I.sub},{match:RegExp(`${I.match}|[^]*(?=<\/script\\s*>$)`,"g"),sub:"js"},I]},...q]});var rs,w,k=c(()=>{rs=[["bash",[/#!(\/usr)?\/bin\/bash/g,500],[/\b(if|elif|then|fi|echo)\b|\$/g,10]],["html",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^\s+<!DOCTYPE\s+html/g,500]],["http",[/^(GET|HEAD|POST|PUT|DELETE|PATCH|HTTP)\b/g,500]],["javascript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require)\b/g,10]],["typescript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require|implements|interface|namespace)\b/g,10]],["python",[/\b(def|print|class|and|or|lambda)\b/g,10]],["sql",[/\b(SELECT|INSERT|FROM)\b/g,50]],["pl",[/#!(\/usr)?\/bin\/perl/g,500],[/\b(use|print)\b|\$/g,10]],["lua",[/#!(\/usr)?\/bin\/lua/g,500]],["make",[/\b(ifneq|endif|if|elif|then|fi|echo|.PHONY|^[a-z]+ ?:$)\b|\$/gm,10]],["uri",[/https?:|mailto:|tel:|ftp:/g,30]],["diff",[/^[+><-]/gm,10],[/^@@ ?[-+,0-9 ]+ ?@@/gm,25]],["markdown",[/^(>|\t\*|\t\d+.)/gm,10],[/\[.*\](.*)/g,10]],["docker",[/^(FROM|ENTRYPOINT|RUN)/gm,500]],["xml",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^<\?xml/g,500]],["c",[/#include\b|\bprintf\s+\(/g,100]],["rust",[/^\s+(use|fn|mut|match)\b/gm,100]],["go",[/\b(func|fmt|package)\b/g,100]],["java",[/^import\s+java/gm,500]],["asm",[/^(section|global main|extern|\t(call|mov|ret))/gm,100]],["css",[/^(@import|@page|@media|(\.|#)[a-z]+)/gm,20]],["json",[/\b(true|false|null|\{})\b|\"[^"]+\":/g,10]],["yaml",[/^(\s+)?[a-z][a-z0-9]*:/gmi,10]]],w=e=>rs.map(([s,...t])=>[s,t.reduce((n,[a,r])=>n+[...e.matchAll(a)].length*r,0)]).filter(([s,t])=>t>20).sort((s,t)=>t[1]-s[1])[0]?.[0]||"plain"});var Pe={};d(Pe,{default:()=>os});var os,Ge=c(()=>{k();os=[{type:"kwd",match:/^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH|PRI|SEARCH)\b/gm},{expand:"str"},{type:"section",match:/\bHTTP\/[\d.]+\b/g},{expand:"num"},{type:"oper",match:/[,;:=]/g},{type:"var",match:/[a-zA-Z][\w-]*(?=:)/g},{match:/\n\n[^]*/g,sub:w}]});var $e={};d($e,{default:()=>is});var is,Be=c(()=>{is=[{match:/(^[ \f\t\v]*)[#;].*/gm,sub:"todo"},{type:"str",match:/.*/g},{type:"var",match:/.*(?==)/g},{type:"section",match:/^\s*\[.+\]\s*$/gm},{type:"oper",match:/=/g}]});var Fe={};d(Fe,{default:()=>cs});var cs,Ke=c(()=>{cs=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(abstract|assert|boolean|break|byte|case|catch|char|class|continue|const|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|package|private|protected|public|requires|return|short|static|strictfp|super|switch|synchronized|this|throw|throws|transient|try|var|void|volatile|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var ze={};d(ze,{default:()=>Z});var Z,W=c(()=>{Z=[{match:/\/\*\*((?!\*\/)[^])*(\*\/)?/g,sub:"jsdoc"},{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{match:/`((?!`)[^]|\\[^])*`?/g,sub:"js_template_literals"},{type:"kwd",match:/=>|\b(this|set|get|as|async|await|break|case|catch|class|const|constructor|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|if|implements|import|in|instanceof|interface|let|var|of|new|package|private|protected|public|return|static|super|switch|throw|throws|try|typeof|void|while|with|yield)\b/g},{match:/\/((?!\/)[^\r\n\\]|\\.)+\/[dgimsuy]*/g,sub:"regex"},{expand:"num"},{type:"num",match:/\b(NaN|null|undefined|[A-Z][A-Z_]*)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z$_][\w$_]*(?=\s*((\?\.)?\s*\(|=\s*(\(?[\w,{}\[\])]+\)? =>|function\b)))/g}]});var qe={};d(qe,{default:()=>ds,type:()=>ls});var ds,ls,Ye=c(()=>{ds=[{match:new class{exec(e){let s=this.lastIndex,t,n=a=>{for(;++s<e.length-2;)if(e[s]=="{")n();else if(e[s]=="}")return};for(;s<e.length;++s)if(e[s-1]!="\\"&&e[s]=="$"&&e[s+1]=="{")return t=s++,n(s),this.lastIndex=s+1,{index:t,0:e.slice(t,s+1)};return null}},sub:[{type:"kwd",match:/^\${|}$/g},{match:/(?!^\$|{)[^]+(?=}$)/g,sub:"js"}]}],ls="str"});var Ze={};d(Ze,{default:()=>j,type:()=>hs});var j,hs,X=c(()=>{j=[{type:"err",match:/\b(TODO|FIXME|DEBUG|OPTIMIZE|WARNING|XXX|BUG)\b/g},{type:"class",match:/\bIDEA\b/g},{type:"insert",match:/\b(CHANGED|FIX|CHANGE)\b/g},{type:"oper",match:/\bQUESTION\b/g}],hs="cmnt"});var We={};d(We,{default:()=>us,type:()=>gs});var us,gs,je=c(()=>{X();us=[{type:"kwd",match:/@\w+/g},{type:"class",match:/{[\w\s|<>,.@\[\]]+}/g},{type:"var",match:/\[[\w\s="']+\]/g},...j],gs="cmnt"});var Xe={};d(Xe,{default:()=>ms});var ms,Ve=c(()=>{ms=[{type:"var",match:/("|')?[a-zA-Z]\w*\1(?=\s*:)/g},{expand:"str"},{expand:"num"},{type:"num",match:/\bnull\b/g},{type:"bool",match:/\b(true|false)\b/g}]});var Qe={};d(Qe,{default:()=>Es});var Es,Je=c(()=>{Es=[{type:"kwd",match:/\b(package|import|class|interface|fun|val|var|if|else|for|while|return|when|break|continue|try|catch|finally|throw|object|companion|init|constructor|this|super)\b/g},{type:"type",match:/\b(Int|String|Double|Float|Boolean|Long|Short|Byte|Char|Unit|Any)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var et={};d(et,{default:()=>ps});var ps,tt=c(()=>{ps=[{type:"kwd",match:/\b(documentclass|usepackage|begin|end)\b/g},{type:"func",match:/\b([a-zA-Z]+)\{/g},{type:"cmnt",match:/%.*/g},{type:"oper",match:/[+\-*\/=<>]/g},{type:"str",match:/\{[^}]*\}/g},{type:"num",match:/\b\d+(\.\d+)?\b/g}]});var st={};d(st,{default:()=>V});var V,Q=c(()=>{k();V=[{type:"cmnt",match:/^>.*|(=|-)\1+/gm},{type:"class",match:/\*\*((?!\*\*).)*\*\*/g},{match:/```((?!```)[^])*\n```/g,sub:e=>({type:"kwd",sub:[{match:/\n[^]*(?=```)/g,sub:e.split(`
`)[0].slice(3)||w(e)}]})},{type:"str",match:/`[^`]*`/g},{type:"var",match:/~~((?!~~).)*~~/g},{type:"kwd",match:/_[^_]*_|\*[^*]*\*/g},{type:"kwd",match:/^\s*(\*|\d+\.)\s/gm},{type:"oper",match:/\[[^\]]*]/g},{type:"func",match:/\([^)]*\)/g}]});var nt={};d(nt,{default:()=>bs});var bs,at=c(()=>{Q();k();bs=[{type:"insert",match:/(leanpub-start-insert)((?!leanpub-end-insert)[^])*(leanpub-end-insert)?/g,sub:[{type:"insert",match:/leanpub-(start|end)-insert/g},{match:/(?!leanpub-start-insert)((?!leanpub-end-insert)[^])*/g,sub:w}]},{type:"deleted",match:/(leanpub-start-delete)((?!leanpub-end-delete)[^])*(leanpub-end-delete)?/g,sub:[{type:"deleted",match:/leanpub-(start|end)-delete/g},{match:/(?!leanpub-start-delete)((?!leanpub-end-delete)[^])*/g,sub:w}]},...V]});var rt={};d(rt,{default:()=>fs});var fs,ot=c(()=>{fs=[{type:"cmnt",match:/^#.*/gm},{expand:"strDouble"},{expand:"num"},{type:"err",match:/\b(err(or)?|[a-z_-]*exception|warn|warning|failed|ko|invalid|not ?found|alert|fatal)\b/gi},{type:"num",match:/\b(null|undefined)\b/gi},{type:"bool",match:/\b(false|true|yes|no)\b/gi},{type:"oper",match:/\.|,/g}]});var it={};d(it,{default:()=>ys});var ys,ct=c(()=>{ys=[{match:/^#!.*|--(\[(=*)\[((?!--\]\2\])[^])*--\]\2\]|.*)/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/\b(and|break|do|else|elseif|end|for|function|if|in|local|not|or|repeat|return|then|until|while)\b/g},{type:"bool",match:/\b(true|false|nil)\b/g},{type:"oper",match:/[+*/%^#=~<>:,.-]+/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*[({])/g}]});var dt={};d(dt,{default:()=>Is});var Is,lt=c(()=>{Is=[{match:/^\s*#.*/gm,sub:"todo"},{expand:"str"},{type:"oper",match:/[${}()]+/g},{type:"class",match:/.PHONY:/gm},{type:"section",match:/^[\w.]+:/gm},{type:"kwd",match:/\b(ifneq|endif)\b/g},{expand:"num"},{type:"var",match:/[A-Z_]+(?=\s*=)/g},{match:/^.*$/gm,sub:"bash"}]});var ht={};d(ht,{default:()=>_s});var _s,ut=c(()=>{_s=[{match:/#.*/g,sub:"todo"},{type:"str",match:/(["'])(\\[^]|(?!\1)[^])*\1?/g},{expand:"num"},{type:"kwd",match:/\b(any|break|continue|default|delete|die|do|else|elsif|eval|for|foreach|given|goto|if|last|local|my|next|our|package|print|redo|require|return|say|state|sub|switch|undef|unless|until|use|when|while|not|and|or|xor)\b/g},{type:"oper",match:/[-+*/%~!&<>|=?,]+/g},{type:"func",match:/[a-z_]+(?=\s*\()/g}]});var gt={};d(gt,{default:()=>Ts});var Ts,mt=c(()=>{Ts=[{type:"kwd",match:/\b(echo|print|function|return|if|else|elseif|for|foreach|while|switch|case|break|default|class|public|private|protected|static|new|extends|implements|use|namespace|include|require|include_once|require_once|global|isset|empty|unset|die|exit)\b/g},{type:"type",match:/\b(string|int|float|bool|array|object|resource|null|void|mixed|callable|iterable)\b/g},{type:"var",match:/\$\w+\b/g},{type:"str",match:/"(?:\\.|[^"])*"|'(?:\\.|[^'])*'/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"cmnt",match:/\/\/.*/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"cmnt",match:/#.*/g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||\?|:|\.|\->)/g}]});var Et={};d(Et,{default:()=>As});var As,pt=c(()=>{As=[{expand:"strDouble"}]});var bt={};d(bt,{default:()=>ws});var ws,ft=c(()=>{ws=[{type:"cmnt",match:/#.*$/gm},{type:"str",match:/"(?:[^"\\]|\\.)*"/g},{type:"kwd",match:/\b(if|else|elseif|foreach|while|function|return|param)\b/g},{type:"var",match:/\$\w+\b/g},{type:"func",match:/\b\w+(?=\s*\()/g},{type:"num",match:/\b\d+\b/g},{type:"oper",match:/[-+*/%<>=!&|]/g}]});var yt={};d(yt,{default:()=>Cs});var Cs,It=c(()=>{Cs=[{match:/#.*/g,sub:"todo"},{match:/("""|''')(\\[^]|(?!\1)[^])*\1?/g,sub:"todo"},{type:"str",match:/f("|')(\\[^]|(?!\1).)*\1?|f((["'])\4\4)(\\[^]|(?!\3)[^])*\3?/gi,sub:[{type:"var",match:/{[^{}]*}/g,sub:[{match:/(?!^{)[^]*(?=}$)/g,sub:"py"}]}]},{expand:"str"},{type:"kwd",match:/\b(and|as|assert|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g},{type:"bool",match:/\b(False|True|None)\b/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*\()/g},{type:"oper",match:/[-/*+<>,=!&|^%]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var _t={};d(_t,{default:()=>Ns,type:()=>Ls});var Ns,Ls,Tt=c(()=>{Ns=[{match:/^(?!\/).*/gm,sub:"todo"},{type:"num",match:/\[((?!\])[^\\]|\\.)*\]/g},{type:"kwd",match:/\||\^|\$|\\.|\w+($|\r|\n)/g},{type:"var",match:/\*|\+|\{\d+,\d+\}/g}],Ls="oper"});var At={};d(At,{default:()=>xs});var xs,wt=c(()=>{xs=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(as|break|const|continue|crate|else|enum|extern|false|fn|for|if|impl|in|let|loop|match|mod|move|mut|pub|ref|return|self|Self|static|struct|super|trait|true|type|unsafe|use|where|while|async|await|dyn|abstract|become|box|do|final|macro|override|priv|typeof|unsized|virtual|yield|try)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*!?\s*\()/g}]});var Ct={};d(Ct,{default:()=>Ss});var Ss,Nt=c(()=>{Ss=[{match:/--.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"func",match:/\b(AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/g},{type:"kwd",match:/\b(ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|kwdS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:S|ING)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/g},{type:"num",match:/\.?\d[\d.oxa-fA-F-]*|\bNULL\b/g},{type:"bool",match:/\b(TRUE|FALSE)\b/g},{type:"oper",match:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|IN|ILIKE|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/g},{type:"var",match:/@\S+/g}]});var Lt={};d(Lt,{default:()=>Rs});var Rs,xt=c(()=>{Rs=[{type:"kwd",match:/\b(import|class|struct|enum|func|let|var|if|else|for|while|return|switch|case|break|default|in|where|guard)\b/g},{type:"type",match:/\b(Int|String|Double|Float|Bool|Array|Dictionary|Set|Optional|Void|Any)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var St={};d(St,{default:()=>Os});var Os,Rt=c(()=>{Os=[{match:/#.*/g,sub:"todo"},{type:"str",match:/("""|''')((?!\1)[^]|\\[^])*\1?/g},{expand:"str"},{type:"section",match:/^\[.+\]\s*$/gm},{type:"num",match:/\b(inf|nan)\b|\d[\d:ZT.-]*/g},{expand:"num"},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[+,.=-]/g},{type:"var",match:/\w+(?= \=)/g}]});var Ot={};d(Ot,{default:()=>ks});var ks,kt=c(()=>{W();ks=[{type:"type",match:/:\s*(any|void|number|boolean|string|object|never|enum)\b/g},{type:"kwd",match:/\b(type|namespace|typedef|interface|public|private|protected|implements|declare|abstract|readonly)\b/g},...Z]});var vt={};d(vt,{default:()=>vs});var vs,Dt=c(()=>{vs=[{match:/^#.*/gm,sub:"todo"},{type:"class",match:/^\w+(?=:?)/gm},{type:"num",match:/:\d+/g},{type:"oper",match:/[:/&?]|\w+=/g},{type:"func",match:/[.\w]+@|#[\w]+$/gm},{type:"var",match:/\w+\.\w+(\.\w+)*/g}]});var Mt={};d(Mt,{default:()=>Ds});var Ds,Ut=c(()=>{Ds=[{match:/#.*/g,sub:"todo"},{expand:"str"},{type:"str",match:/(>|\|)\r?\n((\s[^\n]*)?(\r?\n|$))*/g},{type:"type",match:/!![a-z]+/g},{type:"bool",match:/\b(Yes|No)\b/g},{type:"oper",match:/[+:-]/g},{expand:"num"},{type:"var",match:/[a-zA-Z]\w*(?=:)/g}]});var L=class{constructor(s={}){return{database:{name:"chatHistoryDB",version:1},stores:{sessions:{name:"sessions",options:{keyPath:"sessionId",autoIncrement:!1},indexes:[{name:"updateTime",keyPath:"updateTime",options:{unique:!1}},{name:"title",keyPath:"title",options:{unique:!1}}]},conversations:{name:"conversations",options:{keyPath:"sessionId",autoIncrement:!1}}},ai:{system:`
          You are a friendly AI assistant. Follow the user's vibe, and if needed, do role play.
          Your responses should be helpful, informative, and engaging.
          You can use markdown to format your responses.
          The current date and time is: ${new Date().toLocaleString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"long"})}.
        `,options:{}},ui:{pageSize:{history:10,messages:15}},...s}}};var x=class{constructor(s,t=1,n){this.dbName=s,this.version=t,this.upgradeCallback=n,this.db=null,this.openPromise=null}async open(){return this.db?this.db:this.openPromise?this.openPromise:(this.openPromise=new Promise((s,t)=>{let n=indexedDB.open(this.dbName,this.version);n.onupgradeneeded=a=>{this.db=a.target.result,this.upgradeCallback&&this.upgradeCallback(this.db,a.oldVersion,a.newVersion)},n.onsuccess=a=>{this.db=a.target.result,s(this.db),this.openPromise=null},n.onerror=a=>{t(new Error(`Error opening database: ${a.target.error.message}`)),this.openPromise=null}}),this.openPromise)}async transaction(s,t="readonly"){return(await this.open()).transaction(s,t)}async store(s,t="readonly"){return(await this.transaction(s,t)).objectStore(s)}async add(s,t,n){try{let a=await this.store(s,"readwrite");return await this.request(a.add(t,n))}catch(a){throw new Error(`Add operation failed: ${a.message}`)}}async get(s,t,n){try{let a=await this.store(s),r=n!==void 0?a.index(t).get(n):a.get(t);return await this.request(r)}catch(a){throw new Error(`Get operation failed: ${a.message}`)}}async getAll(s,t){try{let n=await this.store(s),a=[];return new Promise((r,o)=>{let h=t?n.openCursor(t):n.openCursor();h.onsuccess=l=>{let u=l.target.result;u?(a.push(u.value),u.continue()):r(a)},h.onerror=l=>o(new Error(`GetAll operation failed: ${l.target.error.message}`))})}catch(n){throw new Error(`GetAll operation failed: ${n.message}`)}}async forEach(s,t,n){try{let a=await this.store(s);return new Promise((r,o)=>{let h=t?a.openCursor(t):a.openCursor();h.onsuccess=async l=>{let u=l.target.result;u?(await n(u.value,u),u.continue()):r()},h.onerror=l=>o(new Error(`ForEach operation failed: ${l.target.error.message}`))})}catch(a){throw new Error(`ForEach operation failed: ${a.message}`)}}async put(s,t,n){try{let a=await this.store(s,"readwrite");return await this.request(a.put(t,n))}catch(a){throw new Error(`Put operation failed: ${a.message}`)}}async delete(s,t){try{let n=await this.store(s,"readwrite");return await this.request(n.delete(t))}catch(n){throw new Error(`Delete operation failed: ${n.message}`)}}async clear(s){try{let t=await this.store(s,"readwrite");return await this.request(t.clear())}catch(t){throw new Error(`Clear operation failed: ${t.message}`)}}close(){this.db&&(this.db.close(),this.db=null,this.openPromise=null)}async deleteDatabase(){return this.close(),new Promise((s,t)=>{let n=indexedDB.deleteDatabase(this.dbName);n.onsuccess=s,n.onerror=a=>t(new Error(`DeleteDatabase operation failed: ${a.target.error.message}`))})}request(s){return new Promise((t,n)=>{s.onsuccess=()=>t(s.result),s.onerror=a=>n(new Error(a.target.error.message))})}};var S=class{constructor(s){this.config=s,this.db=new x(s.database.name,s.database.version,this.upgradeDatabase.bind(this))}upgradeDatabase(s,t,n){console.log(`Upgrading database from version ${t} to ${n}...`);let{stores:a}=this.config;Object.values(a).forEach(r=>{let{name:o,options:h,indexes:l}=r;if(!s.objectStoreNames.contains(o)){let u=s.createObjectStore(o,h);l?.forEach(({name:E,keyPath:f,options:C})=>{u.createIndex(E,f,C)}),console.log(`Created store: ${o}`)}})}async initialize(){try{return await this.db.open(),localStorage.setItem("chatDB",!0),console.log("Database initialized successfully!"),!0}catch(s){return localStorage.setItem("chatDB",!1),console.error("Database initialization failed:",s),!1}}async addMessage(s,t){try{let n=await this.db.get(this.config.stores.conversations.name,s),a=await this.db.get(this.config.stores.sessions.name,s);n.messages.push(t),a.updateTime=Date.now(),await this.db.put(this.config.stores.conversations.name,n),await this.db.put(this.config.stores.sessions.name,a),console.log(`Message added successfully to conversation: ${s}`)}catch(n){console.error(`Error adding message to conversation: ${n.message}`)}}async getRecentItems(s,t=10,n){try{let a=await this.db.store(s),r=n?a.index(n):null;return new Promise((o,h)=>{let l=[],u=0,E=r?r.openCursor(null,"prev"):a.openCursor(null,"prev");E.onsuccess=f=>{let C=f.target.result;C&&u<t?(l.push(C.value),u++,C.continue()):o(l)},E.onerror=f=>{console.error("Error getting recent items:",f.target.error),h(f.target.error)}})}catch(a){throw console.error("Error in getRecentItems:",a),a}}async createNewSession(){try{let s=Number(localStorage.getItem("chatSessions"))||0;return s+=1,localStorage.setItem("chatSessions",s),await this.db.add(this.config.stores.conversations.name,{sessionId:s,messages:[]}),await this.db.add(this.config.stores.sessions.name,{sessionId:s,creationTime:Date.now(),title:`New Chat ${s}`,updateTime:Date.now()}),s}catch(s){return console.error("Error creating new session:",s),null}}async updateChatHistoryTitle(s,t){try{let n=await this.db.get(this.config.stores.sessions.name,Number(s));if(!n){console.warn(`Session ${s} not found`);return}n.title=t,n.updateTime=Date.now(),await this.db.put(this.config.stores.sessions.name,n),console.log(`History item updated: ${t}`)}catch(n){console.error("Error updating chat history title:",n)}}async updateMessage(s,t,n,a){try{let r=await this.db.get(this.config.stores.conversations.name,s);a>=0&&a<r.messages.length?(r.messages[a].content=n,r.messages=r.messages.slice(0,a),await this.db.put(this.config.stores.conversations.name,r),console.log(`Message updated successfully in conversation: ${s}`)):console.warn(`Message index out of bounds: ${a}`)}catch(r){console.error(`Error updating message in conversation: ${r.message}`)}}async deleteSession(s){try{await this.db.delete(this.config.stores.conversations.name,Number(s)),await this.db.delete(this.config.stores.sessions.name,Number(s)),console.log(`Session ${s} deleted successfully`)}catch(t){console.error(`Error deleting session: ${t.message}`)}}};var i=class{static findElement(s,t){return s.querySelector(t)}static findElements(s,t){return s.querySelectorAll(t)}static addClass(s,t){s.classList.add(t)}static removeClass(s,t){s.classList.remove(t)}static toggleClass(s,t){s.classList.toggle(t)}static hasClass(s,t){return s.classList.contains(t)}static setAttribute(s,t,n){s.setAttribute(t,n)}static removeAttribute(s,t){s.removeAttribute(t)}static dispatchEvent(s,t,n={}){let a=new CustomEvent(t,{bubbles:!0,cancelable:!0,composed:!1,detail:n});s.dispatchEvent(a)}static insertHTML(s,t,n){s.insertAdjacentHTML(t,n)}static removeElement(s){s.remove()}static clearInnerHTML(s){s.innerHTML=""}};var R=class{constructor(s,t={}){this.root=s,this.uiOptions={sidebarTogglers:".sidebar-toggler",textarea:"#chat-massage",sendButton:"#chat-send-button",newChatButton:"#new-chat-button",chatHistoryContainer:"#chat-history-container",contentScrollContainer:"#content-scroll-container",contentContainer:"#content-container",modelMenu:"#model-menu",sidebarStateName:"chat-sidebar-open",backdrop:".chat-backdrop",...t},this.initWindowControls(),this.initializeElements(),this.registerEventListeners(),this.editMode=null}initializeElements(){this.sidebarTogglers=i.findElements(this.root,this.uiOptions.sidebarTogglers),this.textarea=i.findElement(this.root,this.uiOptions.textarea),this.sendButton=i.findElement(this.root,this.uiOptions.sendButton),this.newChatButton=i.findElement(this.root,this.uiOptions.newChatButton),this.chatHistoryContainer=i.findElement(this.root,this.uiOptions.chatHistoryContainer),this.contentScrollContainer=i.findElement(this.root,this.uiOptions.contentScrollContainer),this.contentContainer=i.findElement(this.root,this.uiOptions.contentContainer),this.modelMenu=i.findElement(this.root,this.uiOptions.modelMenu)}registerEventListeners(){this.sidebarTogglers.forEach(t=>{t.addEventListener("click",()=>{try{this.toggleSidebar()}catch(n){console.error("Error toggling sidebar:",n)}})}),localStorage.getItem(this.uiOptions.sidebarStateName)==="true"&&i.addClass(this.root,"sidebar-open"),document.addEventListener("keydown",t=>{if(t.key==="Escape"&&i.hasClass(this.root,"sidebar-open"))try{this.toggleSidebar()}catch(n){console.error("Error handling Escape key:",n)}}),this.sendButton.addEventListener("click",async t=>{i.dispatchEvent(this.root,"send-message")}),this.textarea.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),i.dispatchEvent(this.root,"send-message"))}),this.chatHistoryContainer.addEventListener("click",t=>{let n=t.target.closest(".menu__item.rename");if(n){t.stopPropagation();let r=n.closest(".item");this.enableHistoryRenameMode(r);return}let a=t.target.closest(".menu__item.delete");if(a){t.stopPropagation();let r=a.closest(".item");this.deleteHistoryItem(r);return}try{this.displayChatHistory(t.target)}catch(r){console.error("Error showing chat history:",r)}}),this.newChatButton.addEventListener("click",()=>{i.dispatchEvent(this.root,"new-chat")}),this.modelMenu.addEventListener("click",t=>{this.selectModel(t.target)}),document.addEventListener("DOMContentLoaded",()=>{i.addClass(this.root,"loaded")}),this.contentContainer.addEventListener("click",t=>{let n=t.target.closest(".action__button.edit");if(n){let a=n.closest(".chat__block");this.enableEditMode(a)}})}toggleSidebar(){try{let s=this.root.classList.toggle("sidebar-open");localStorage.setItem(this.uiOptions.sidebarStateName,s);let t=i.findElement(this.root,this.uiOptions.backdrop);!t&&s&&(t=document.createElement("backdrop"),i.addClass(t,"chat-backdrop"),t.addEventListener("click",()=>this.toggleSidebar()),this.root.appendChild(t)),t&&i.toggleClass(t,"open")}catch(s){console.error("Error in toggleSidebar:",s)}}updateNetworkStatus(){this.root.classList.toggle("offline",!navigator.onLine)}sanitizeInput(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}renderMessage(s,t){let n=t==="user"?this.sanitizeInput(s):s,a=this.generateMessageBlock(n,t);i.insertHTML(this.contentContainer,"beforeend",a)}addChatHistoryItem(s,t,n="beforeend"){i.insertHTML(this.chatHistoryContainer,n,`<div class="item" data-session-id="${t}">
        <span class="title">${s}</span>
        <div class="menu">
          <button class="menu__item rename" title="Rename">
            <svg class="icon">
                <use href="/assets/image/svg/icons.svg#edit-icon" />
            </svg>
          </button>
          <button class="menu__item delete" title="Delete">
             <svg class="icon">
                <use href="/assets/image/svg/icons.svg#delete-icon" />
            </svg>
          </button>
        </div>
      </div>`)}generateMessageBlock(s,t){switch(t){case"user":return`<div class="chat__block user" data-role="${t}">
                  <div class="actions__wrapper">
                    <button class="action__button edit" title="Edit message">
                      <svg class="icon">
                        <use href="/assets/image/svg/icons.svg#edit-icon" />
                      </svg>
                    </button>
                  </div>
                  <span class="message">${s}</span>
                </div>`;case"assistant":return`<div class="chat__block assistant" data-role="${t}">
                  <svg class="icon assistant__logo">
                    <use href="/assets/image/svg/icons.svg#stars-icon" />
                  </svg>
                  <div class="response_wrapper">
                    <div class="response">
                      ${s}
                    </div>
                    <div class="actions__wrapper">
                      <button class="action__button copy" title="Copy message">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#copy-icon" />
                        </svg>
                      </button>
                      <button class="action__button repeat" title="Regenerate response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#repeat-icon" />
                        </svg>
                      </button>
                      <button class="action__button like" title="Good response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#like-icon" />
                        </svg>
                      </button>
                      <button class="action__button dislike" title="Bad response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#dislike-icon" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>`;case"system":return`<div class="chat__block system">
                  ${s} 
                </div>`;default:return""}}scrollToBottom(){this.contentScrollContainer.scrollTo({top:this.contentScrollContainer.scrollHeight,behavior:"smooth"})}enableEditMode(s){if(this.editMode)return;let t=s.querySelector(".message"),n=t.textContent,a=`
      <div class="edit__wrapper">
        <textarea class="edit-textarea">${n}</textarea>
        <div class="edit__actions">
          <button class="dark r save-edit">Save</button>
          <button class="r cancel-edit">Cancel</button>
        </div> 
      </div>
    `;i.addClass(s,"editing"),i.insertHTML(s,"beforeend",a);let r=s.querySelector(".edit-textarea");r.focus(),this.editMode={block:s,messageSpan:t,original:n,textarea:r},s.querySelector(".save-edit").addEventListener("click",()=>this.saveEdit()),s.querySelector(".cancel-edit").addEventListener("click",()=>this.cancelEdit()),r.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),this.saveEdit()),o.key==="Escape"&&this.cancelEdit()})}saveEdit(){if(!this.editMode)return;let s=this.editMode.textarea.value.trim();if(s&&s!==this.editMode.original){this.editMode.messageSpan.textContent=s;let t=this.editMode.block,n=s,a=Array.from(t.parentNode.children).indexOf(t);i.dispatchEvent(this.root,"save-edit",{messageBlock:t,content:n,messageIndex:a})}this.exitEditMode()}cancelEdit(){this.editMode&&this.exitEditMode()}exitEditMode(){if(!this.editMode)return;i.removeClass(this.editMode.block,"editing");let s=this.editMode.block.querySelector(".edit__wrapper");s&&i.removeElement(s),this.editMode=null}displayChatHistory(s){let t=s.getAttribute("data-session-id");t&&i.dispatchEvent(this.root,"display-chat",{sessionId:t})}selectModel(s){try{let t=s.getAttribute("data-model");if(!t)return;localStorage.setItem("selectedModel",t),i.findElements(this.modelMenu,".model").forEach(a=>{i.removeClass(a,"active")});let n=this.modelMenu.querySelector(`[data-model="${t}"]`);n&&i.addClass(n,"active"),i.dispatchEvent(this.root,"model-selected",{model:t})}catch(t){console.error("Error selecting model:",t)}}populateModelMenu(s){s.forEach(t=>{let[n,a]=t.name.split(":");i.insertHTML(this.modelMenu,"beforeend",`
        <button class="model" data-model="${t.name}">
          <span class="name">${n}</span>
          <span class="info">${a||""}</span>
        </button>
      `)})}setActiveModel(s){let t=this.modelMenu.querySelector(`[data-model="${s}"]`);t&&i.addClass(t,"active")}clearChatHistory(){i.clearInnerHTML(this.contentContainer)}addSystemMessage(s){this.renderMessage(s,"system")}initWindowControls(){if("windowControlsOverlay"in navigator){let s=t=>{try{let n=navigator.windowControlsOverlay.visible,{x:a,y:r,width:o,height:h}=t?.titlebarAreaRect||navigator.windowControlsOverlay.getTitlebarAreaRect();this.root.style.setProperty("--title-bar-height",`${h}px`),this.root.style.setProperty("--title-bar-width",`${o}px`),this.root.style.setProperty("--title-bar-x",`${a}px`),this.root.style.setProperty("--title-bar-y",`${r}px`),this.root.classList.toggle("overlay-visible",n)}catch(n){console.error("Error updating titlebar area:",n)}};navigator.windowControlsOverlay.addEventListener("geometrychange",s),s()}}removeBlocksAfter(s){Array.from(this.contentContainer.children).slice(s).forEach(n=>{i.removeElement(n)})}enableHistoryRenameMode(s){let t=s.querySelector(".title");if(!t||i.hasClass(s,"renaming"))return;let n=t.textContent,a=document.createElement("input");a.type="text",a.value=n,a.className="rename-input";let r=async()=>{let o=a.value.trim(),h=s.dataset.sessionId;o&&o!==n?(i.dispatchEvent(this.root,"rename-chat",{sessionId:h,title:o}),t.textContent=o):t.textContent=n,i.removeElement(a),i.removeClass(s,"renaming")};a.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),a.blur()),o.key==="Escape"&&(t.textContent=n,i.removeElement(a),i.removeClass(s,"renaming"))}),a.addEventListener("blur",r),i.addClass(s,"renaming"),t.after(a),a.focus(),a.select()}deleteHistoryItem(s){let t=s.dataset.sessionId;i.dispatchEvent(this.root,"delete-chat",{sessionId:t}),i.removeElement(s)}};var O=class{constructor(s){this.host=s,this.abortController=new AbortController}async getTitle(s,t){let n=await this.chat({model:s,messages:[{role:"system",content:"You are an AI assistant. Generate a concise, engaging title under 6 words that reflects the core intent of the user's first message, from their perspective. The title should summarize the query clearly to aid in future searchability. Respond *only* with the title\u2014no explanations."},{role:"user",content:`Generate a title for this message: '${t}'.`}]},null);return n.message.content?n.message.content.replaceAll('"',""):null}async chat(s,t=this.abortController.signal){try{let n=await fetch(`http://${this.host}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,stream:!1}),signal:t});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return await n.json()}catch(n){if(n.name==="AbortError")console.warn("Request aborted by user.");else throw console.error("Error in chat:",n),n}}async*streamChat(s,t=this.abortController.signal){try{let n=await fetch(`http://${this.host}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,stream:!0}),signal:t});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);let a=n.body.getReader(),r=new TextDecoder,o="";try{for(;;){let{done:h,value:l}=await a.read();if(h)break;o+=r.decode(l);let u=o.indexOf(`
`);for(;u!==-1;){let E=o.substring(0,u);if(o=o.substring(u+1),E)try{yield JSON.parse(E)}catch(f){console.error("Error parsing JSON:",f,E)}u=o.indexOf(`
`)}}}finally{a.releaseLock()}}catch(n){if(n.name==="AbortError")console.warn("Request aborted by user.");else throw console.error("Error in streamChat:",n),n}}async list(){try{let s=await fetch(`http://${this.host}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);return await s.json()}catch(s){throw console.error("Error in list:",s),s}}abort(){this.abortController.abort(),this.abortController=new AbortController,console.warn("ChatService Aborted")}};var M=1,ne=2,ae=4,re=8,oe=16;function $t(e){switch(e){case M:return"href";case ne:return"src";case ae:return"data-code-lang";case re:return"checked";case oe:return"start"}}var te=24;function U(e){let s=new Uint32Array(te);return s[0]=1,{renderer:e,text:"",pending:"",tokens:s,len:0,token:1,code_fence_body:0,blockquote_idx:0,hr_char:"",hr_chars:0,backticks_count:0,spaces:new Uint8Array(te),indent:"",indent_len:0}}function H(e){e.pending.length>0&&y(e,`
`)}function m(e){e.text.length!==0&&(console.assert(e.len>0,"Never adding text to root"),e.renderer.add_text(e.renderer.data,e.text),e.text="")}function p(e){console.assert(e.len>0,"No nodes to end"),e.len-=1,e.token=e.tokens[e.len],e.renderer.end_token(e.renderer.data)}function g(e,s){e.tokens[e.len]&25165824&&!(s&33554432)&&p(e),e.len+=1,e.tokens[e.len]=s,e.token=s,e.renderer.add_token(e.renderer.data,s)}function Bt(e,s,t){for(;t<=e.len;){if(e.tokens[t]&s)return t;t+=1}return-1}function N(e,s){for(;e.len>s;)p(e)}function v(e,s){let t=-1,n=-1;for(let a=e.blockquote_idx+1;a<=e.len;a+=1)if(e.tokens[a]&33554432){if(e.indent_len<e.spaces[a]){n=-1;break}n=a}else e.tokens[a]&s&&(t=a);return n===-1?t===-1?(N(e,e.blockquote_idx),g(e,s),!0):(N(e,t),!1):(N(e,n),g(e,s),!0)}function D(e,s){g(e,33554432),e.spaces[e.len]=e.indent_len+s,b(e),e.token=268435456}function b(e){e.indent="",e.indent_len=0,e.pending=""}function se(e){switch(e){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return!0;default:return!1}}function y(e,s){for(let t of s){let n=e.pending+t;switch(e.token){case 1048576:case 1:case 524288:case 16777216:case 8388608:switch(console.assert(e.text.length===0,"Root should not have any text"),e.pending[0]){case void 0:e.pending=t;continue;case" ":console.assert(e.pending.length===1),e.pending=t,e.indent+=" ",e.indent_len+=1;continue;case"	":console.assert(e.pending.length===1),e.pending=t,e.indent+="	",e.indent_len+=4;continue;case`
`:if(console.assert(e.pending.length===1),e.tokens[e.len]&33554432&&e.token&1048576){p(e),e.pending=t;continue}N(e,e.blockquote_idx),e.blockquote_idx=0,e.backticks_count=0,e.pending=t;continue;case"#":switch(t){case"#":if(e.pending.length<6){e.pending=n;continue}break;case" ":switch(e.pending.length){case 1:g(e,4),b(e);continue;case 2:g(e,8),b(e);continue;case 3:g(e,16),b(e);continue;case 4:g(e,32),b(e);continue;case 5:g(e,64),b(e);continue;case 6:g(e,128),b(e);continue}console.assert(!1,"Should not reach here")}break;case">":{let r=Bt(e,524288,e.blockquote_idx+1);r===-1?(N(e,e.blockquote_idx),e.blockquote_idx+=1,e.backticks_count=0,g(e,524288)):e.blockquote_idx=r,b(e),e.pending=t;continue}case"-":case"*":case"_":if(e.hr_chars===0&&(console.assert(e.pending.length===1,"Pending should be one character"),e.hr_chars=1,e.hr_char=e.pending),e.hr_chars>0){switch(t){case e.hr_char:e.hr_chars+=1,e.pending=n;continue;case" ":e.pending=n;continue;case`
`:if(e.hr_chars<3)break;e.renderer.add_token(e.renderer.data,4194304),e.renderer.end_token(e.renderer.data),e.pending="",e.hr_chars=0;continue}e.hr_chars=0}if(e.pending[0]!=="_"&&e.pending[1]===" "){v(e,8388608),D(e,2),y(e,n.slice(2));continue}break;case"`":if(e.pending.length<3){if(t==="`"){e.pending=n,e.backticks_count=n.length;continue}e.backticks_count=0;break}switch(t){case"`":e.pending.length===e.backticks_count?(e.pending=n,e.backticks_count=n.length):(g(e,2),b(e),e.backticks_count=0,y(e,n));continue;case`
`:g(e,512),e.pending.length>e.backticks_count&&e.renderer.set_attr(e.renderer.data,ae,e.pending.slice(e.backticks_count)),b(e);continue;default:e.pending=n;continue}case"+":if(t!==" ")break;v(e,8388608),D(e,2);continue;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(e.pending[e.pending.length-1]==="."){if(t!==" ")break;v(e,16777216)&&e.pending!=="1."&&e.renderer.set_attr(e.renderer.data,oe,e.pending.slice(0,-1)),D(e,e.pending.length+1);continue}else{let r=t.charCodeAt(0);if(r===46||se(r)){e.pending=n;continue}}break}let a=n;if(e.token&1048576)e.token=e.tokens[e.len],e.renderer.add_token(e.renderer.data,1048576),e.renderer.end_token(e.renderer.data);else if(e.indent_len>=4){let r=0;for(;r<4;r+=1)if(e.indent[r]==="	"){r=r+1;break}a=e.indent.slice(r)+n,g(e,256)}else g(e,2);b(e),y(e,a);continue;case 256:switch(n){case`
    `:case`
   	`:case`
  	`:case`
 	`:case`
	`:e.text+=`
`,e.pending="";continue;case`
`:case`
 `:case`
  `:case`
   `:e.pending=n;continue;default:e.pending.length!==0?(m(e),p(e),e.pending=t):e.text+=t;continue}case 512:switch(t){case"`":n.length===e.backticks_count+e.code_fence_body?(m(e),p(e),e.pending="",e.backticks_count=0,e.code_fence_body=0):e.pending=n;continue;case`
`:e.text+=e.pending,e.pending=t,e.code_fence_body=1;continue;default:e.text+=n,e.pending="",e.code_fence_body=1;continue}case 1024:switch(t){case"`":n.length===e.backticks_count+ +(e.pending[0]===" ")?(m(e),p(e),e.pending="",e.backticks_count=0):e.pending=n;continue;case`
`:e.text+=e.pending,e.pending="",e.token=1048576,e.blockquote_idx=0,m(e);continue;case" ":e.text+=e.pending,e.pending=t;continue;default:e.text+=n,e.pending="";continue}case 268435456:switch(e.pending.length){case 0:if(t!=="[")break;e.pending=n;continue;case 1:if(t!==" "&&t!=="x")break;e.pending=n;continue;case 2:if(t!=="]")break;e.pending=n;continue;case 3:if(t!==" ")break;e.renderer.add_token(e.renderer.data,67108864),e.pending[1]==="x"&&e.renderer.set_attr(e.renderer.data,re,""),e.renderer.end_token(e.renderer.data),e.pending=" ";continue}e.token=e.tokens[e.len],e.pending="",y(e,n);continue;case 8192:case 16384:{let r="*",o=2048;if(e.token===16384&&(r="_",o=4096),r===e.pending){if(m(e),r===t){p(e),e.pending="";continue}g(e,o),e.pending=t;continue}break}case 2048:case 4096:{let r="*",o=8192;switch(e.token===4096&&(r="_",o=16384),e.pending){case r:r===t?e.tokens[e.len-1]===o?e.pending=n:(m(e),g(e,o),e.pending=""):(m(e),p(e),e.pending=t);continue;case r+r:let h=e.token;m(e),p(e),p(e),r!==t?(g(e,h),e.pending=t):e.pending="";continue}break}case 32768:if(n==="~~"){m(e),p(e),e.pending="";continue}break;case 134217728:n==="http://"||n==="https://"?(m(e),g(e,131072),e.pending=n,e.text=n):"http:/"[e.pending.length]===t||"https:/"[e.pending.length]===t?e.pending=n:(e.token=e.tokens[e.len],y(e,t));continue;case 65536:case 262144:if(e.pending==="]"){m(e),t==="("?e.pending=n:(p(e),e.pending=t);continue}if(e.pending[0]==="]"&&e.pending[1]==="("){if(t===")"){let r=e.token===65536?M:ne,o=e.pending.slice(2);e.renderer.set_attr(e.renderer.data,r,o),p(e),e.pending=""}else e.pending+=t;continue}break;case 131072:t===" "||t===`
`||t==="\\"?(e.renderer.set_attr(e.renderer.data,M,e.pending),m(e),p(e),e.pending=t):(e.text+=t,e.pending=n);continue}switch(e.pending[0]){case"\\":if(t===`
`)e.pending=t;else{let a=t.charCodeAt(0);e.pending="",e.text+=se(a)||a>=65&&a<=90||a>=97&&a<=122?n:t}continue;case`
`:m(e),e.token=1048576,e.blockquote_idx=0,e.pending=t;continue;case"`":if(e.token&262144)break;t==="`"?(e.backticks_count+=1,e.pending=n):(e.backticks_count+=1,m(e),g(e,1024),e.text=t===" "||t===`
`?"":t,e.pending="");continue;case"_":case"*":{if(e.token&262144)break;let a=2048,r=8192,o=e.pending[0];if(o==="_"&&(a=4096,r=16384),e.pending.length===1){if(o===t){e.pending=n;continue}if(t!==" "&&t!==`
`){m(e),g(e,a),e.pending=t;continue}}else{if(o===t){m(e),g(e,r),g(e,a),e.pending="";continue}if(t!==" "&&t!==`
`){m(e),g(e,r),e.pending=t;continue}}break}case"~":if(e.token&294912)break;if(e.pending==="~"){if(t==="~"){e.pending=n;continue}}else if(t!==" "&&t!==`
`){m(e),g(e,32768),e.pending=t;continue}break;case"[":if(!(e.token&327680)&&t!=="]"){m(e),g(e,65536),e.pending=t;continue}break;case"!":if(!(e.token&262144)&&t==="["){m(e),g(e,262144),e.pending="";continue}break;case" ":if(t===" ")continue;break}if(!(e.token&327680)&&t==="h"&&(e.pending===" "||e.pending==="")){e.text+=e.pending,e.pending=t,e.token=134217728;continue}e.text+=e.pending,e.pending=t}m(e)}function P(e){return{add_token:Ft,end_token:Kt,add_text:zt,set_attr:qt,data:{nodes:[e,,,,,],index:0}}}function Ft(e,s){let t,n;switch(s){case 1:return;case 524288:t=n=document.createElement("blockquote");break;case 2:t=n=document.createElement("p");break;case 1048576:t=n=document.createElement("br");break;case 4194304:t=n=document.createElement("hr");break;case 4:t=n=document.createElement("h1");break;case 8:t=n=document.createElement("h2");break;case 16:t=n=document.createElement("h3");break;case 32:t=n=document.createElement("h4");break;case 64:t=n=document.createElement("h5");break;case 128:t=n=document.createElement("h6");break;case 2048:case 4096:t=n=document.createElement("em");break;case 8192:case 16384:t=n=document.createElement("strong");break;case 32768:t=n=document.createElement("s");break;case 1024:t=n=document.createElement("code");break;case 131072:case 65536:t=n=document.createElement("a");break;case 262144:t=n=document.createElement("img");break;case 8388608:t=n=document.createElement("ul");break;case 16777216:t=n=document.createElement("ol");break;case 33554432:t=n=document.createElement("li");break;case 67108864:let a=document.createElement("input");a.type="checkbox",a.disabled=!0,t=n=a;break;case 256:case 512:t=n=document.createElement("div");break}e.nodes[e.index].appendChild(t),e.index+=1,e.nodes[e.index]=n}function ie(e){let s=document.createElement("div"),t=P(s),n=U(t);return y(n,e),H(n),s.innerHTML}function Kt(e){e.index-=1}function zt(e,s){e.nodes[e.index].appendChild(document.createTextNode(s))}function qt(e,s,t){e.nodes[e.index].setAttribute($t(s),t)}var Ms=ee({"./languages/assembly.js":()=>Promise.resolve().then(()=>(de(),ce)),"./languages/bash.js":()=>Promise.resolve().then(()=>($(),he)),"./languages/batch.js":()=>Promise.resolve().then(()=>(ge(),ue)),"./languages/bf.js":()=>Promise.resolve().then(()=>(Ee(),me)),"./languages/c.js":()=>Promise.resolve().then(()=>(F(),pe)),"./languages/cpp.js":()=>Promise.resolve().then(()=>(fe(),be)),"./languages/csharp.js":()=>Promise.resolve().then(()=>(Ie(),ye)),"./languages/css.js":()=>Promise.resolve().then(()=>(Te(),_e)),"./languages/csv.js":()=>Promise.resolve().then(()=>(we(),Ae)),"./languages/dart.js":()=>Promise.resolve().then(()=>(Ne(),Ce)),"./languages/diff.js":()=>Promise.resolve().then(()=>(z(),Le)),"./languages/docker.js":()=>Promise.resolve().then(()=>(Se(),xe)),"./languages/git.js":()=>Promise.resolve().then(()=>(Oe(),Re)),"./languages/go.js":()=>Promise.resolve().then(()=>(ve(),ke)),"./languages/html.js":()=>Promise.resolve().then(()=>(He(),Ue)),"./languages/http.js":()=>Promise.resolve().then(()=>(Ge(),Pe)),"./languages/ini.js":()=>Promise.resolve().then(()=>(Be(),$e)),"./languages/java.js":()=>Promise.resolve().then(()=>(Ke(),Fe)),"./languages/javascript.js":()=>Promise.resolve().then(()=>(W(),ze)),"./languages/js_template_literals.js":()=>Promise.resolve().then(()=>(Ye(),qe)),"./languages/jsdoc.js":()=>Promise.resolve().then(()=>(je(),We)),"./languages/json.js":()=>Promise.resolve().then(()=>(Ve(),Xe)),"./languages/kotlin.js":()=>Promise.resolve().then(()=>(Je(),Qe)),"./languages/latex.js":()=>Promise.resolve().then(()=>(tt(),et)),"./languages/leanpub-md.js":()=>Promise.resolve().then(()=>(at(),nt)),"./languages/log.js":()=>Promise.resolve().then(()=>(ot(),rt)),"./languages/lua.js":()=>Promise.resolve().then(()=>(ct(),it)),"./languages/make.js":()=>Promise.resolve().then(()=>(lt(),dt)),"./languages/markdown.js":()=>Promise.resolve().then(()=>(Q(),st)),"./languages/perl.js":()=>Promise.resolve().then(()=>(ut(),ht)),"./languages/php.js":()=>Promise.resolve().then(()=>(mt(),gt)),"./languages/plain.js":()=>Promise.resolve().then(()=>(pt(),Et)),"./languages/powershell.js":()=>Promise.resolve().then(()=>(ft(),bt)),"./languages/python.js":()=>Promise.resolve().then(()=>(It(),yt)),"./languages/regex.js":()=>Promise.resolve().then(()=>(Tt(),_t)),"./languages/rust.js":()=>Promise.resolve().then(()=>(wt(),At)),"./languages/sql.js":()=>Promise.resolve().then(()=>(Nt(),Ct)),"./languages/swift.js":()=>Promise.resolve().then(()=>(xt(),Lt)),"./languages/todo.js":()=>Promise.resolve().then(()=>(X(),Ze)),"./languages/toml.js":()=>Promise.resolve().then(()=>(Rt(),St)),"./languages/typescript.js":()=>Promise.resolve().then(()=>(kt(),Ot)),"./languages/uri.js":()=>Promise.resolve().then(()=>(Dt(),vt)),"./languages/xml.js":()=>Promise.resolve().then(()=>(Y(),Me)),"./languages/yaml.js":()=>Promise.resolve().then(()=>(Ut(),Mt))});var Us={num:{type:"num",match:/(\.e?|\b)\d(e-|[\d.oxa-fA-F_])*(\.|\b)/g},str:{type:"str",match:/(["'])(\\[^]|(?!\1)[^\r\n\\])*\1?/g},strDouble:{type:"str",match:/"((?!")[^\r\n\\]|\\[^])*"?/g}},Hs=new Map,Ps=(e="")=>{let s={"&":"&#38;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,t=>s[t])},Gs=(e,s)=>s?`<span class="${s}">${e}</span>`:e;async function Ht(e,s,t){try{let n;if(typeof s=="string"){if(n=Hs.get(s),!n&&(n=await Ms(`./languages/${s}.js`),!n?.default))throw new Error(`Invalid language module for ${s}`)}else n=s;let a,r,o={},h,l=[],u=0,E=Array.isArray(n.sub)?[...n.sub]:Array.isArray(n.default)?[...n.default]:[];if(E.length===0){t(e);return}for(;u<e.length;){for(o.index=null,a=E.length;a-- >0;){if(r=E[a].expand?Us[E[a].expand]:E[a],l[a]===void 0||l[a].match.index<u){if(r.match.lastIndex=u,h=r.match.exec(e),h===null){E.splice(a,1),l.splice(a,1);continue}l[a]={match:h,lastIndex:r.match.lastIndex}}l[a].match[0]&&(l[a].match.index<=o.index||o.index===null)&&(o={part:r,index:l[a].match.index,match:l[a].match[0],end:l[a].lastIndex})}if(o.index===null)break;t(e.slice(u,o.index),n.type),u=o.end,o.part.sub?await Ht(o.match,typeof o.part.sub=="string"?o.part.sub:typeof o.part.sub=="function"?o.part.sub(o.match):o.part,t):t(o.match,o.part.type)}t(e.slice(u,e.length),n.type)}catch(n){console.error(`Tokenization error: ${n.message}`),t(e)}}function $s(e,s){navigator.clipboard.writeText(s.textContent).then(()=>{e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},2e3)}).catch(t=>{console.error("Failed to copy:",t),e.classList.add("failed")})}async function Bs(e,s,t=!0,n={}){let a="";return await Ht(e,s,(o,h)=>a+=Gs(Ps(o),h)),t?`<div class="header"><span class="lang">${s}</span><button class="copy" title="Copy Code"></button></div><div class="wrapper"><div class="numbers">${"<div></div>".repeat(n.lineNumbers&&e.split(`
`).length)}</div><code class="code">${a}</code></div>`:`<div class="wrapper"><code class="code">${a}</code></div><button class="copy" title="Copy Code"></button>`}async function Fs(e,s=e.dataset.codeLang,t,n){let a=e.textContent.trim();t??=`${a.split(`
`).length<2?"one":"multi"}line`,e.className=`${[...e.classList].filter(h=>!h.startsWith("")).join(" ")}code-block ${s} ${t} highlighted`,e.innerHTML=await Bs(a,s,t=="multiline",n);let r=e.querySelector(".copy"),o=e.querySelector(".code");r&&o&&r.addEventListener("click",()=>$s(r,o))}var Pt=async e=>Promise.all(Array.from(document.querySelectorAll("[data-code-lang]:not(.highlighted)")).map(s=>Fs(s,void 0,void 0,e)));var _=class{static parseMarkdown(s){return ie(s)}static getParser(s){let t=P(s);return U(t)}static parserWrite(s,t){y(s,t)}static parserEnd(s){H(s)}static highlightCode(){Pt()}};var J=class{constructor(s={}){this.config=new L(s),this.dbManager=new S(this.config),this.ui=new R(document.querySelector("#chat-app-root")),this.host="localhost:11434",this.chatService=new O(this.host),this.sessionId=0,this.context=[],this.maxContext=20,this.aiOptions={},this.systemPrompt=this.config.ai.system,this.model="",this.modelList=[],this.initialize(),this.registerEvents()}async initialize(){window.addEventListener("popstate",n=>{this.handleUrlChange(n)});let s=this.getSessionIdFromUrl();s?history.replaceState({type:"chat",sessionId:s},null,`?session=${s}`):history.replaceState({type:"new"},null,window.location.pathname),await this.dbManager.initialize()&&await this.loadChatHistory(),s&&await this.displayChatHistory(s),await this.loadModels()}registerEvents(){this.ui.root.addEventListener("send-message",async()=>{if(i.hasClass(this.ui.root,"generating")){this.abortGenerate();return}await this.processChat()}),this.ui.root.addEventListener("new-chat",()=>{this.startNewChat()}),this.ui.root.addEventListener("display-chat",async s=>{let t=s.detail.sessionId;history.pushState({type:"chat",sessionId:t},null,`?session=${t}`),await this.displayChatHistory(t)}),this.ui.root.addEventListener("model-selected",s=>{this.model=s.detail.model,localStorage.setItem("selectedModel",this.model)}),this.ui.root.addEventListener("save-edit",async s=>{let{messageBlock:t,content:n,messageIndex:a}=s.detail;await this.saveEdit(t,n,a)}),this.ui.root.addEventListener("rename-chat",async s=>{let{sessionId:t,title:n}=s.detail;!t||!n||(await this.dbManager.updateChatHistoryTitle(t,n),this.sessionId===Number(t)&&(document.title=n))}),this.ui.root.addEventListener("delete-chat",async s=>{let{sessionId:t}=s.detail;await this.dbManager.deleteSession(t),this.sessionId===Number(t)&&this.startNewChat()})}async processChat(s=null){try{let t=s||this.ui.textarea.value.trim();if(!t||i.hasClass(this.ui.root,"generating"))return;this.ui.textarea.value="",i.addClass(this.ui.root,"generating");let n=!this.ui.root.hasAttribute("data-session-id");n&&(this.sessionId=await this.dbManager.createNewSession(),i.setAttribute(this.ui.root,"data-session-id",this.sessionId),this.ui.addChatHistoryItem(`New Chat ${this.sessionId}`,this.sessionId,"afterbegin")),i.removeClass(this.ui.root,"initial"),this.ui.renderMessage(t,"user"),this.ui.renderMessage("","assistant"),this.ui.scrollToBottom(),await this.dbManager.addMessage(this.sessionId,{role:"user",content:t}),this.context.push({role:"user",content:t});let a=this.ui.contentContainer.querySelector(".chat__block.assistant:last-child .response_wrapper .response"),r=this.chatService.streamChat({model:this.model,messages:[{role:"system",content:this.systemPrompt},...this.context],options:this.aiOptions}),o=_.getParser(a),h="";for await(let l of r)h+=l.message.content,_.parserWrite(o,l.message.content);if(_.parserEnd(o),i.removeClass(this.ui.root,"generating"),_.highlightCode(),await this.dbManager.addMessage(this.sessionId,{role:"assistant",content:h}),this.context.push({role:"assistant",content:h}),n){let l=await this.chatService.getTitle(this.model,t);if(l){let u=this.ui.chatHistoryContainer.querySelector(`.item[data-session-id="${this.sessionId}"] .title`);u&&(u.textContent=l),await this.dbManager.updateChatHistoryTitle(this.sessionId,l)}}this.context.length>=this.maxContext&&await this.refreshContext(this.context,this.maxContext),console.log(this.context)}catch(t){i.removeClass(this.ui.root,"generating"),console.error("Error processing chat:",t)}}startNewChat(){i.addClass(this.ui.root,"initial"),this.ui.clearChatHistory(),this.ui.textarea.value="",i.removeAttribute(this.ui.root,"data-session-id"),this.context=[],history.pushState({type:"new"},null,window.location.pathname)}async loadChatHistory(){try{let s=await this.dbManager.getRecentItems(this.config.stores.sessions.name,this.config.ui.maxHistory,"updateTime");s.length&&s.forEach(t=>{this.ui.addChatHistoryItem(t.title,t.sessionId)})}catch(s){console.error("Error loading chat history:",s)}}async displayChatHistory(s){if(s!=this.sessionId)try{i.removeClass(this.ui.root,"initial"),this.ui.clearChatHistory(),i.setAttribute(this.ui.root,"data-session-id",s),this.sessionId=Number(s);let t=await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId);if(t.messages.length){for(let a of t.messages)a.role==="assistant"?this.ui.renderMessage(_.parseMarkdown(a.content),a.role):this.ui.renderMessage(a.content,a.role);this.ui.scrollToBottom(),_.highlightCode(),await this.refreshContext(t.messages,this.maxContext),console.log(this.context)}let n=await this.dbManager.db.get(this.config.stores.sessions.name,this.sessionId);document.title=n.title}catch(t){console.error("Error displaying chat history:",t)}}async loadModels(){try{let s=await this.chatService.list();s.models.length?(this.modelList=s.models,localStorage.getItem("selectedModel")||localStorage.setItem("selectedModel",this.modelList[0].name),this.model=localStorage.getItem("selectedModel"),this.ui.populateModelMenu(this.modelList),this.ui.setActiveModel(this.model)):(console.error("At least one model is required"),this.ui.addSystemMessage("At least one model is required"))}catch(s){console.error("Error initializing chat:",s),this.ui.addSystemMessage("Error initializing chat. Check console for details.")}}async refreshContext(s,t=10){try{if(s.length>t){let n=Math.floor(t/2),a=s.filter(o=>o.role==="user").slice(0,n),r=s.slice(-n);this.context=[...a,...r]}else s.length&&(this.context=s)}catch(n){console.error("Error updating context:",n)}}abortGenerate(){this.chatService.abort()}getSessionIdFromUrl(){return new URLSearchParams(window.location.search).get("session")}async handleUrlChange(s){let t=this.getSessionIdFromUrl(),n=s.state;n&&n.type==="chat"&&t?await this.displayChatHistory(t):n&&n.type==="new"&&this.startNewChat()}async saveEdit(s,t,n){try{let a=Number(this.ui.root.dataset.sessionId);await this.dbManager.updateMessage(a,s,t,n),this.ui.removeBlocksAfter(n);let r=await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId);await this.refreshContext(r.messages,this.maxContext),await this.processChat(t)}catch(a){console.error("Error saving edit:",a)}}},Cn=new J;})();
