(()=>{var qt=Object.defineProperty;var ne=e=>s=>{var t=e[s];if(t)return t();throw new Error("Module not found in bundle: "+s)};var c=(e,s)=>()=>(e&&(s=e(e=0)),s);var l=(e,s)=>{for(var t in s)qt(e,t,{get:s[t],enumerable:!0})};var ge={};l(ge,{default:()=>Qt});var Qt,pe=c(()=>{Qt=[{type:"cmnt",match:/(;|#).*/gm},{expand:"str"},{expand:"num"},{type:"num",match:/\$[\da-fA-F]*\b/g},{type:"kwd",match:/^[a-z]+\s+[a-z.]+\b/gm,sub:[{type:"func",match:/^[a-z]+/g}]},{type:"kwd",match:/^\t*[a-z][a-z\d]*\b/gm},{match:/%|\$/g,type:"oper"}]});var be={};l(be,{default:()=>F});var Ee,F,K=c(()=>{Ee={type:"var",match:/\$\w+|\${[^}]*}|\$\([^)]*\)/g},F=[{sub:"todo",match:/#.*/g},{type:"str",match:/(["'])((?!\1)[^\r\n\\]|\\[^])*\1?/g,sub:[Ee]},{type:"oper",match:/(?<=\s|^)\.*\/[a-z/_.-]+/gi},{type:"kwd",match:/\s-[a-zA-Z]+|$<|[&|;]+|\b(unset|readonly|shift|export|if|fi|else|elif|while|do|done|for|until|case|esac|break|continue|exit|return|trap|wait|eval|exec|then|declare|enable|local|select|typeset|time|add|remove|install|update|delete)(?=\s|$)/g},{expand:"num"},{type:"func",match:/(?<=(^|\||\&\&|\;)\s*)[a-z_.-]+(?=\s|$)/gmi},{type:"bool",match:/(?<=\s|^)(true|false)(?=\s|$)/g},{type:"oper",match:/[=(){}<>!]+/g},{type:"var",match:/(?<=\s|^)[\w_]+(?=\s*=)/g},Ee]});var fe={};l(fe,{default:()=>Jt});var Jt,ye=c(()=>{Jt=[{type:"kwd",match:/\b(echo|set|if|else|for|goto|call|exit|pause)\b/gi},{type:"var",match:/%[a-zA-Z0-9_]+%/g},{type:"str",match:/"(?:\\.|[^"])*"/g},{type:"cmnt",match:/::.*/g},{type:"cmnt",match:/rem .*/gi},{type:"oper",match:/(=|==|!=|<|>|<=|>=)/g},{type:"num",match:/\b\d+\b/g}]});var Ie={};l(Ie,{default:()=>es});var es,_e=c(()=>{es=[{match:/[^\[\->+.<\]\s].*/g,sub:"todo"},{type:"func",match:/\.+/g},{type:"kwd",match:/[<>]+/g},{type:"oper",match:/[+-]+/g}]});var Te={};l(Te,{default:()=>z});var z,q=c(()=>{z=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/#\s*include (<.*>|".*")/g,sub:[{type:"str",match:/(<|").*/g}]},{match:/asm\s*{[^}]*}/g,sub:[{type:"kwd",match:/^asm/g},{match:/[^{}]*(?=}$)/g,sub:"asm"}]},{type:"kwd",match:/\*|&|#[a-z]+\b|\b(asm|auto|double|int|struct|break|else|long|switch|case|enum|register|typedef|char|extern|return|union|const|float|short|unsigned|continue|for|signed|void|default|goto|sizeof|volatile|do|if|static|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var Ae={};l(Ae,{default:()=>ts});var ts,we=c(()=>{q();ts=[...z]});var Ce={};l(Ce,{default:()=>ss});var ss,Ne=c(()=>{ss=[{type:"kwd",match:/\b(using|namespace|class|public|static|void|string|int|bool|if|else|for|foreach|while|return|new|try|catch|finally|throw)\b/g},{type:"type",match:/\b(Console|WriteLine|List|Dictionary|Exception|Task|Thread)\b/g},{type:"str",match:/"(?:\\.|[^"])*"/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"cmnt",match:/\/\/.*/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||\?|:)/g}]});var xe={};l(xe,{default:()=>ns});var ns,Le=c(()=>{ns=[{match:/\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/@\w+\b|\b(and|not|only|or)\b|\b[a-z-]+(?=[^{}]*{)/g},{type:"var",match:/\b[\w-]+(?=\s*:)|(::?|\.)[\w-]+(?=[^{}]*{)/g},{type:"func",match:/#[\w-]+(?=[^{}]*{)/g},{type:"num",match:/#[\da-f]{3,8}/g},{type:"num",match:/\d+(\.\d+)?(cm|mm|in|px|pt|pc|em|ex|ch|rem|vm|vh|vmin|vmax|%)?/g,sub:[{type:"var",match:/[a-z]+|%/g}]},{match:/url\([^)]*\)/g,sub:[{type:"func",match:/url(?=\()/g},{type:"str",match:/[^()]+/g}]},{type:"func",match:/\b[a-zA-Z]\w*(?=\s*\()/g},{type:"num",match:/\b[a-z-]+\b/g}]});var Se={};l(Se,{default:()=>as});var as,ve=c(()=>{as=[{expand:"strDouble"},{type:"oper",match:/,/g}]});var Re={};l(Re,{default:()=>os});var os,ke=c(()=>{os=[{type:"kwd",match:/\b(import|export|library|part of|part|class|extends|with|implements|mixin|enum|typedef|abstract|static|final|const|factory|operator|get|set|return|if|else|for|while|do|switch|case|default|break|continue|assert|try|catch|finally|throw|rethrow|async|await|yield|late|required)\b/g},{type:"type",match:/\b(int|double|num|String|bool|List|Map|Set|dynamic|void|Object)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/'(.*?)'|"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=|\?\?)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var Oe={};l(Oe,{default:()=>Y});var Y,Z=c(()=>{Y=[{type:"deleted",match:/^[-<].*/gm},{type:"insert",match:/^[+>].*/gm},{type:"kwd",match:/!.*/gm},{type:"section",match:/^@@.*@@$|^\d.*|^([*-+])\1\1.*/gm}]});var De={};l(De,{default:()=>rs});var rs,Me=c(()=>{K();rs=[{type:"kwd",match:/^(FROM|RUN|CMD|LABEL|MAINTAINER|EXPOSE|ENV|ADD|COPY|ENTRYPOINT|VOLUME|USER|WORKDIR|ARG|ONBUILD|STOPSIGNAL|HEALTHCHECK|SHELL)\b/gmi},...F]});var He={};l(He,{default:()=>is});var is,Ue=c(()=>{Z();is=[{match:/^#.*/gm,sub:"todo"},{expand:"str"},...Y,{type:"func",match:/^(\$ )?git(\s.*)?$/gm},{type:"kwd",match:/^commit \w+$/gm}]});var Be={};l(Be,{default:()=>cs});var cs,Pe=c(()=>{cs=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\*|&|\b(break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go|goto|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"oper",match:/[+\-*\/%&|^~=!<>.^-]+/g}]});var $e={};l($e,{default:()=>W,name:()=>T,properties:()=>A,xmlElement:()=>I});var Ge,ls,T,A,I,W,j=c(()=>{Ge=":A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD",ls=Ge+"\\-\\.0-9\xB7\u0300-\u036F\u203F-\u2040",T=`[${Ge}][${ls}]*`,A=`\\s*(\\s+${T}\\s*(=\\s*([^"']\\S*|("|')(\\\\[^]|(?!\\4)[^])*\\4?)?)?\\s*)*`,I={match:RegExp(`<[/!?]?${T}${A}[/!?]?>`,"g"),sub:[{type:"var",match:RegExp(`^<[/!?]?${T}`,"g"),sub:[{type:"oper",match:/^<[\/!?]?/g}]},{type:"str",match:/=\s*([^"']\S*|("|')(\\[^]|(?!\2)[^])*\2?)/g,sub:[{type:"oper",match:/^=/g}]},{type:"oper",match:/[\/!?]?>/g},{type:"class",match:RegExp(T,"g")}]},W=[{match:/<!--((?!-->)[^])*-->/g,sub:"todo"},{type:"class",match:/<!\[CDATA\[[\s\S]*?\]\]>/gi},I,{type:"str",match:RegExp(`<\\?${T}([^?]|\\?[^?>])*\\?+>`,"g"),sub:[{type:"var",match:RegExp(`^<\\?${T}`,"g"),sub:[{type:"oper",match:/^<\?/g}]},{type:"oper",match:/\?+>$/g}]},{type:"var",match:/&(#x?)?[\da-z]{1,8};/gi}]});var Fe={};l(Fe,{default:()=>ds});var ds,Ke=c(()=>{j();ds=[{type:"class",match:/<!DOCTYPE("[^"]*"|'[^']*'|[^"'>])*>/gi,sub:[{type:"str",match:/"[^"]*"|'[^']*'/g},{type:"oper",match:/^<!|>$/g},{type:"var",match:/DOCTYPE/gi}]},{match:RegExp(`<style${A}>((?!</style>)[^])*</style\\s*>`,"g"),sub:[{match:RegExp(`^<style${A}>`,"g"),sub:I.sub},{match:RegExp(`${I.match}|[^]*(?=</style\\s*>$)`,"g"),sub:"css"},I]},{match:RegExp(`<script${A}>((?!<\/script>)[^])*<\/script\\s*>`,"g"),sub:[{match:RegExp(`^<script${A}>`,"g"),sub:I.sub},{match:RegExp(`${I.match}|[^]*(?=<\/script\\s*>$)`,"g"),sub:"js"},I]},...W]});var hs,w,M=c(()=>{hs=[["bash",[/#!(\/usr)?\/bin\/bash/g,500],[/\b(if|elif|then|fi|echo)\b|\$/g,10]],["html",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^\s+<!DOCTYPE\s+html/g,500]],["http",[/^(GET|HEAD|POST|PUT|DELETE|PATCH|HTTP)\b/g,500]],["javascript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require)\b/g,10]],["typescript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require|implements|interface|namespace)\b/g,10]],["python",[/\b(def|print|class|and|or|lambda)\b/g,10]],["sql",[/\b(SELECT|INSERT|FROM)\b/g,50]],["pl",[/#!(\/usr)?\/bin\/perl/g,500],[/\b(use|print)\b|\$/g,10]],["lua",[/#!(\/usr)?\/bin\/lua/g,500]],["make",[/\b(ifneq|endif|if|elif|then|fi|echo|.PHONY|^[a-z]+ ?:$)\b|\$/gm,10]],["uri",[/https?:|mailto:|tel:|ftp:/g,30]],["diff",[/^[+><-]/gm,10],[/^@@ ?[-+,0-9 ]+ ?@@/gm,25]],["markdown",[/^(>|\t\*|\t\d+.)/gm,10],[/\[.*\](.*)/g,10]],["docker",[/^(FROM|ENTRYPOINT|RUN)/gm,500]],["xml",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^<\?xml/g,500]],["c",[/#include\b|\bprintf\s+\(/g,100]],["rust",[/^\s+(use|fn|mut|match)\b/gm,100]],["go",[/\b(func|fmt|package)\b/g,100]],["java",[/^import\s+java/gm,500]],["asm",[/^(section|global main|extern|\t(call|mov|ret))/gm,100]],["css",[/^(@import|@page|@media|(\.|#)[a-z]+)/gm,20]],["json",[/\b(true|false|null|\{})\b|\"[^"]+\":/g,10]],["yaml",[/^(\s+)?[a-z][a-z0-9]*:/gmi,10]]],w=e=>hs.map(([s,...t])=>[s,t.reduce((n,[a,o])=>n+[...e.matchAll(a)].length*o,0)]).filter(([s,t])=>t>20).sort((s,t)=>t[1]-s[1])[0]?.[0]||"plain"});var ze={};l(ze,{default:()=>us});var us,qe=c(()=>{M();us=[{type:"kwd",match:/^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH|PRI|SEARCH)\b/gm},{expand:"str"},{type:"section",match:/\bHTTP\/[\d.]+\b/g},{expand:"num"},{type:"oper",match:/[,;:=]/g},{type:"var",match:/[a-zA-Z][\w-]*(?=:)/g},{match:/\n\n[^]*/g,sub:w}]});var Ye={};l(Ye,{default:()=>ms});var ms,Ze=c(()=>{ms=[{match:/(^[ \f\t\v]*)[#;].*/gm,sub:"todo"},{type:"str",match:/.*/g},{type:"var",match:/.*(?==)/g},{type:"section",match:/^\s*\[.+\]\s*$/gm},{type:"oper",match:/=/g}]});var We={};l(We,{default:()=>gs});var gs,je=c(()=>{gs=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(abstract|assert|boolean|break|byte|case|catch|char|class|continue|const|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|package|private|protected|public|requires|return|short|static|strictfp|super|switch|synchronized|this|throw|throws|transient|try|var|void|volatile|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var Xe={};l(Xe,{default:()=>X});var X,V=c(()=>{X=[{match:/\/\*\*((?!\*\/)[^])*(\*\/)?/g,sub:"jsdoc"},{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{match:/`((?!`)[^]|\\[^])*`?/g,sub:"js_template_literals"},{type:"kwd",match:/=>|\b(this|set|get|as|async|await|break|case|catch|class|const|constructor|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|if|implements|import|in|instanceof|interface|let|var|of|new|package|private|protected|public|return|static|super|switch|throw|throws|try|typeof|void|while|with|yield)\b/g},{match:/\/((?!\/)[^\r\n\\]|\\.)+\/[dgimsuy]*/g,sub:"regex"},{expand:"num"},{type:"num",match:/\b(NaN|null|undefined|[A-Z][A-Z_]*)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z$_][\w$_]*(?=\s*((\?\.)?\s*\(|=\s*(\(?[\w,{}\[\])]+\)? =>|function\b)))/g}]});var Ve={};l(Ve,{default:()=>ps,type:()=>Es});var ps,Es,Qe=c(()=>{ps=[{match:new class{exec(e){let s=this.lastIndex,t,n=a=>{for(;++s<e.length-2;)if(e[s]=="{")n();else if(e[s]=="}")return};for(;s<e.length;++s)if(e[s-1]!="\\"&&e[s]=="$"&&e[s+1]=="{")return t=s++,n(s),this.lastIndex=s+1,{index:t,0:e.slice(t,s+1)};return null}},sub:[{type:"kwd",match:/^\${|}$/g},{match:/(?!^\$|{)[^]+(?=}$)/g,sub:"js"}]}],Es="str"});var Je={};l(Je,{default:()=>Q,type:()=>bs});var Q,bs,J=c(()=>{Q=[{type:"err",match:/\b(TODO|FIXME|DEBUG|OPTIMIZE|WARNING|XXX|BUG)\b/g},{type:"class",match:/\bIDEA\b/g},{type:"insert",match:/\b(CHANGED|FIX|CHANGE)\b/g},{type:"oper",match:/\bQUESTION\b/g}],bs="cmnt"});var et={};l(et,{default:()=>fs,type:()=>ys});var fs,ys,tt=c(()=>{J();fs=[{type:"kwd",match:/@\w+/g},{type:"class",match:/{[\w\s|<>,.@\[\]]+}/g},{type:"var",match:/\[[\w\s="']+\]/g},...Q],ys="cmnt"});var st={};l(st,{default:()=>Is});var Is,nt=c(()=>{Is=[{type:"var",match:/("|')?[a-zA-Z]\w*\1(?=\s*:)/g},{expand:"str"},{expand:"num"},{type:"num",match:/\bnull\b/g},{type:"bool",match:/\b(true|false)\b/g}]});var at={};l(at,{default:()=>_s});var _s,ot=c(()=>{_s=[{type:"kwd",match:/\b(package|import|class|interface|fun|val|var|if|else|for|while|return|when|break|continue|try|catch|finally|throw|object|companion|init|constructor|this|super)\b/g},{type:"type",match:/\b(Int|String|Double|Float|Boolean|Long|Short|Byte|Char|Unit|Any)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var rt={};l(rt,{default:()=>Ts});var Ts,it=c(()=>{Ts=[{type:"kwd",match:/\b(documentclass|usepackage|begin|end)\b/g},{type:"func",match:/\b([a-zA-Z]+)\{/g},{type:"cmnt",match:/%.*/g},{type:"oper",match:/[+\-*\/=<>]/g},{type:"str",match:/\{[^}]*\}/g},{type:"num",match:/\b\d+(\.\d+)?\b/g}]});var ct={};l(ct,{default:()=>ee});var ee,te=c(()=>{M();ee=[{type:"cmnt",match:/^>.*|(=|-)\1+/gm},{type:"class",match:/\*\*((?!\*\*).)*\*\*/g},{match:/```((?!```)[^])*\n```/g,sub:e=>({type:"kwd",sub:[{match:/\n[^]*(?=```)/g,sub:e.split(`
`)[0].slice(3)||w(e)}]})},{type:"str",match:/`[^`]*`/g},{type:"var",match:/~~((?!~~).)*~~/g},{type:"kwd",match:/_[^_]*_|\*[^*]*\*/g},{type:"kwd",match:/^\s*(\*|\d+\.)\s/gm},{type:"oper",match:/\[[^\]]*]/g},{type:"func",match:/\([^)]*\)/g}]});var lt={};l(lt,{default:()=>As});var As,dt=c(()=>{te();M();As=[{type:"insert",match:/(leanpub-start-insert)((?!leanpub-end-insert)[^])*(leanpub-end-insert)?/g,sub:[{type:"insert",match:/leanpub-(start|end)-insert/g},{match:/(?!leanpub-start-insert)((?!leanpub-end-insert)[^])*/g,sub:w}]},{type:"deleted",match:/(leanpub-start-delete)((?!leanpub-end-delete)[^])*(leanpub-end-delete)?/g,sub:[{type:"deleted",match:/leanpub-(start|end)-delete/g},{match:/(?!leanpub-start-delete)((?!leanpub-end-delete)[^])*/g,sub:w}]},...ee]});var ht={};l(ht,{default:()=>ws});var ws,ut=c(()=>{ws=[{type:"cmnt",match:/^#.*/gm},{expand:"strDouble"},{expand:"num"},{type:"err",match:/\b(err(or)?|[a-z_-]*exception|warn|warning|failed|ko|invalid|not ?found|alert|fatal)\b/gi},{type:"num",match:/\b(null|undefined)\b/gi},{type:"bool",match:/\b(false|true|yes|no)\b/gi},{type:"oper",match:/\.|,/g}]});var mt={};l(mt,{default:()=>Cs});var Cs,gt=c(()=>{Cs=[{match:/^#!.*|--(\[(=*)\[((?!--\]\2\])[^])*--\]\2\]|.*)/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/\b(and|break|do|else|elseif|end|for|function|if|in|local|not|or|repeat|return|then|until|while)\b/g},{type:"bool",match:/\b(true|false|nil)\b/g},{type:"oper",match:/[+*/%^#=~<>:,.-]+/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*[({])/g}]});var pt={};l(pt,{default:()=>Ns});var Ns,Et=c(()=>{Ns=[{match:/^\s*#.*/gm,sub:"todo"},{expand:"str"},{type:"oper",match:/[${}()]+/g},{type:"class",match:/.PHONY:/gm},{type:"section",match:/^[\w.]+:/gm},{type:"kwd",match:/\b(ifneq|endif)\b/g},{expand:"num"},{type:"var",match:/[A-Z_]+(?=\s*=)/g},{match:/^.*$/gm,sub:"bash"}]});var bt={};l(bt,{default:()=>xs});var xs,ft=c(()=>{xs=[{match:/#.*/g,sub:"todo"},{type:"str",match:/(["'])(\\[^]|(?!\1)[^])*\1?/g},{expand:"num"},{type:"kwd",match:/\b(any|break|continue|default|delete|die|do|else|elsif|eval|for|foreach|given|goto|if|last|local|my|next|our|package|print|redo|require|return|say|state|sub|switch|undef|unless|until|use|when|while|not|and|or|xor)\b/g},{type:"oper",match:/[-+*/%~!&<>|=?,]+/g},{type:"func",match:/[a-z_]+(?=\s*\()/g}]});var yt={};l(yt,{default:()=>Ls});var Ls,It=c(()=>{Ls=[{type:"kwd",match:/\b(echo|print|function|return|if|else|elseif|for|foreach|while|switch|case|break|default|class|public|private|protected|static|new|extends|implements|use|namespace|include|require|include_once|require_once|global|isset|empty|unset|die|exit)\b/g},{type:"type",match:/\b(string|int|float|bool|array|object|resource|null|void|mixed|callable|iterable)\b/g},{type:"var",match:/\$\w+\b/g},{type:"str",match:/"(?:\\.|[^"])*"|'(?:\\.|[^'])*'/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"cmnt",match:/\/\/.*/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"cmnt",match:/#.*/g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||\?|:|\.|\->)/g}]});var _t={};l(_t,{default:()=>Ss});var Ss,Tt=c(()=>{Ss=[{expand:"strDouble"}]});var At={};l(At,{default:()=>vs});var vs,wt=c(()=>{vs=[{type:"cmnt",match:/#.*$/gm},{type:"str",match:/"(?:[^"\\]|\\.)*"/g},{type:"kwd",match:/\b(if|else|elseif|foreach|while|function|return|param)\b/g},{type:"var",match:/\$\w+\b/g},{type:"func",match:/\b\w+(?=\s*\()/g},{type:"num",match:/\b\d+\b/g},{type:"oper",match:/[-+*/%<>=!&|]/g}]});var Ct={};l(Ct,{default:()=>Rs});var Rs,Nt=c(()=>{Rs=[{match:/#.*/g,sub:"todo"},{match:/("""|''')(\\[^]|(?!\1)[^])*\1?/g,sub:"todo"},{type:"str",match:/f("|')(\\[^]|(?!\1).)*\1?|f((["'])\4\4)(\\[^]|(?!\3)[^])*\3?/gi,sub:[{type:"var",match:/{[^{}]*}/g,sub:[{match:/(?!^{)[^]*(?=}$)/g,sub:"py"}]}]},{expand:"str"},{type:"kwd",match:/\b(and|as|assert|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g},{type:"bool",match:/\b(False|True|None)\b/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*\()/g},{type:"oper",match:/[-/*+<>,=!&|^%]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var xt={};l(xt,{default:()=>ks,type:()=>Os});var ks,Os,Lt=c(()=>{ks=[{match:/^(?!\/).*/gm,sub:"todo"},{type:"num",match:/\[((?!\])[^\\]|\\.)*\]/g},{type:"kwd",match:/\||\^|\$|\\.|\w+($|\r|\n)/g},{type:"var",match:/\*|\+|\{\d+,\d+\}/g}],Os="oper"});var St={};l(St,{default:()=>Ds});var Ds,vt=c(()=>{Ds=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(as|break|const|continue|crate|else|enum|extern|false|fn|for|if|impl|in|let|loop|match|mod|move|mut|pub|ref|return|self|Self|static|struct|super|trait|true|type|unsafe|use|where|while|async|await|dyn|abstract|become|box|do|final|macro|override|priv|typeof|unsized|virtual|yield|try)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*!?\s*\()/g}]});var Rt={};l(Rt,{default:()=>Ms});var Ms,kt=c(()=>{Ms=[{match:/--.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"func",match:/\b(AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/g},{type:"kwd",match:/\b(ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|kwdS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:S|ING)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/g},{type:"num",match:/\.?\d[\d.oxa-fA-F-]*|\bNULL\b/g},{type:"bool",match:/\b(TRUE|FALSE)\b/g},{type:"oper",match:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|IN|ILIKE|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/g},{type:"var",match:/@\S+/g}]});var Ot={};l(Ot,{default:()=>Hs});var Hs,Dt=c(()=>{Hs=[{type:"kwd",match:/\b(import|class|struct|enum|func|let|var|if|else|for|while|return|switch|case|break|default|in|where|guard)\b/g},{type:"type",match:/\b(Int|String|Double|Float|Bool|Array|Dictionary|Set|Optional|Void|Any)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"num",match:/\b\d+(\.\d+)?\b/g},{type:"str",match:/"(.*?)"/g},{type:"cmnt",match:/\/\/(.*)/g},{type:"cmnt",match:/\/\*[\s\S]*?\*\//g},{type:"oper",match:/(\+|-|\*|\/|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=)/g},{type:"func",match:/\b([a-zA-Z_][a-zA-Z0-9_]*)\(/g}]});var Mt={};l(Mt,{default:()=>Us});var Us,Ht=c(()=>{Us=[{match:/#.*/g,sub:"todo"},{type:"str",match:/("""|''')((?!\1)[^]|\\[^])*\1?/g},{expand:"str"},{type:"section",match:/^\[.+\]\s*$/gm},{type:"num",match:/\b(inf|nan)\b|\d[\d:ZT.-]*/g},{expand:"num"},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[+,.=-]/g},{type:"var",match:/\w+(?= \=)/g}]});var Ut={};l(Ut,{default:()=>Bs});var Bs,Bt=c(()=>{V();Bs=[{type:"type",match:/:\s*(any|void|number|boolean|string|object|never|enum)\b/g},{type:"kwd",match:/\b(type|namespace|typedef|interface|public|private|protected|implements|declare|abstract|readonly)\b/g},...X]});var Pt={};l(Pt,{default:()=>Ps});var Ps,Gt=c(()=>{Ps=[{match:/^#.*/gm,sub:"todo"},{type:"class",match:/^\w+(?=:?)/gm},{type:"num",match:/:\d+/g},{type:"oper",match:/[:/&?]|\w+=/g},{type:"func",match:/[.\w]+@|#[\w]+$/gm},{type:"var",match:/\w+\.\w+(\.\w+)*/g}]});var $t={};l($t,{default:()=>Gs});var Gs,Ft=c(()=>{Gs=[{match:/#.*/g,sub:"todo"},{expand:"str"},{type:"str",match:/(>|\|)\r?\n((\s[^\n]*)?(\r?\n|$))*/g},{type:"type",match:/!![a-z]+/g},{type:"bool",match:/\b(Yes|No)\b/g},{type:"oper",match:/[+:-]/g},{expand:"num"},{type:"var",match:/[a-zA-Z]\w*(?=:)/g}]});var S=class{constructor(s={}){return{database:{name:"chatHistoryDB",version:1},stores:{sessions:{name:"sessions",options:{keyPath:"sessionId",autoIncrement:!1},indexes:[{name:"updateTime",keyPath:"updateTime",options:{unique:!1}},{name:"title",keyPath:"title",options:{unique:!1}}]},conversations:{name:"conversations",options:{keyPath:"sessionId",autoIncrement:!1}}},ai:{system:`
          You are a friendly AI assistant. Follow the user's vibe, and if needed, do role play.
          Your responses should be helpful, informative, and engaging.
          You can use markdown to format your responses.
          The current date and time is: ${new Date().toLocaleString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"long"})}.
        `,options:{}},ui:{pageSize:{history:100,messages:25}},...s}}};var v=class{constructor(s,t=1,n){this.dbName=s,this.version=t,this.upgradeCallback=n,this.db=null,this.openPromise=null}async open(){return this.db?this.db:this.openPromise?this.openPromise:(this.openPromise=new Promise((s,t)=>{let n=indexedDB.open(this.dbName,this.version);n.onupgradeneeded=a=>{this.db=a.target.result,this.upgradeCallback&&this.upgradeCallback(this.db,a.oldVersion,a.newVersion)},n.onsuccess=a=>{this.db=a.target.result,s(this.db),this.openPromise=null},n.onerror=a=>{t(new Error(`Error opening database: ${a.target.error.message}`)),this.openPromise=null}}),this.openPromise)}async transaction(s,t="readonly"){return(await this.open()).transaction(s,t)}async store(s,t="readonly"){return(await this.transaction(s,t)).objectStore(s)}async add(s,t,n){try{let a=await this.store(s,"readwrite");return await this.request(a.add(t,n))}catch(a){throw new Error(`Add operation failed: ${a.message}`)}}async get(s,t,n){try{let a=await this.store(s),o=n!==void 0?a.index(t).get(n):a.get(t);return await this.request(o)}catch(a){throw new Error(`Get operation failed: ${a.message}`)}}async getAll(s,t){try{let n=await this.store(s),a=[];return new Promise((o,r)=>{let d=t?n.openCursor(t):n.openCursor();d.onsuccess=h=>{let u=h.target.result;u?(a.push(u.value),u.continue()):o(a)},d.onerror=h=>r(new Error(`GetAll operation failed: ${h.target.error.message}`))})}catch(n){throw new Error(`GetAll operation failed: ${n.message}`)}}async forEach(s,t,n){try{let a=await this.store(s);return new Promise((o,r)=>{let d=t?a.openCursor(t):a.openCursor();d.onsuccess=async h=>{let u=h.target.result;u?(await n(u.value,u),u.continue()):o()},d.onerror=h=>r(new Error(`ForEach operation failed: ${h.target.error.message}`))})}catch(a){throw new Error(`ForEach operation failed: ${a.message}`)}}async put(s,t,n){try{let a=await this.store(s,"readwrite");return await this.request(a.put(t,n))}catch(a){throw new Error(`Put operation failed: ${a.message}`)}}async delete(s,t){try{let n=await this.store(s,"readwrite");return await this.request(n.delete(t))}catch(n){throw new Error(`Delete operation failed: ${n.message}`)}}async clear(s){try{let t=await this.store(s,"readwrite");return await this.request(t.clear())}catch(t){throw new Error(`Clear operation failed: ${t.message}`)}}close(){this.db&&(this.db.close(),this.db=null,this.openPromise=null)}async deleteDatabase(){return this.close(),new Promise((s,t)=>{let n=indexedDB.deleteDatabase(this.dbName);n.onsuccess=s,n.onerror=a=>t(new Error(`DeleteDatabase operation failed: ${a.target.error.message}`))})}request(s){return new Promise((t,n)=>{s.onsuccess=()=>t(s.result),s.onerror=a=>n(new Error(a.target.error.message))})}};var R=class{constructor(s){this.config=s,this.db=new v(s.database.name,s.database.version,this.upgradeDatabase.bind(this))}upgradeDatabase(s,t,n){console.log(`Upgrading database from version ${t} to ${n}...`);let{stores:a}=this.config;Object.values(a).forEach(o=>{let{name:r,options:d,indexes:h}=o;if(!s.objectStoreNames.contains(r)){let u=s.createObjectStore(r,d);h?.forEach(({name:p,keyPath:f,options:N})=>{u.createIndex(p,f,N)}),console.log(`Created store: ${r}`)}})}async initialize(){try{return await this.db.open(),localStorage.setItem("chatDB",!0),console.log("Database initialized successfully!"),!0}catch(s){return localStorage.setItem("chatDB",!1),console.error("Database initialization failed:",s),!1}}async addMessage(s,t){try{let n=await this.db.get(this.config.stores.conversations.name,s),a=await this.db.get(this.config.stores.sessions.name,s);n.messages.push(t),a.updateTime=Date.now(),await this.db.put(this.config.stores.conversations.name,n),await this.db.put(this.config.stores.sessions.name,a),console.log(`Message added successfully to conversation: ${s}`)}catch(n){console.error(`Error adding message to conversation: ${n.message}`)}}async getRecentItems(s,t=10,n){try{let a=await this.db.store(s),o=n?a.index(n):null;return new Promise((r,d)=>{let h=[],u=0,p=o?o.openCursor(null,"prev"):a.openCursor(null,"prev");p.onsuccess=f=>{let N=f.target.result;N&&u<t?(h.push(N.value),u++,N.continue()):r(h)},p.onerror=f=>{console.error("Error getting recent items:",f.target.error),d(f.target.error)}})}catch(a){throw console.error("Error in getRecentItems:",a),a}}async createNewSession(){try{let s=Number(localStorage.getItem("chatSessions"))||0;return s+=1,localStorage.setItem("chatSessions",s),await this.db.add(this.config.stores.conversations.name,{sessionId:s,messages:[]}),await this.db.add(this.config.stores.sessions.name,{sessionId:s,creationTime:Date.now(),title:`New Chat ${s}`,updateTime:Date.now()}),s}catch(s){return console.error("Error creating new session:",s),null}}async updateChatHistoryTitle(s,t){try{let n=await this.db.get(this.config.stores.sessions.name,Number(s));if(!n){console.warn(`Session ${s} not found`);return}n.title=t,n.updateTime=Date.now(),await this.db.put(this.config.stores.sessions.name,n),console.log(`History item updated: ${t}`)}catch(n){console.error("Error updating chat history title:",n)}}async updateMessage(s,t,n,a){try{let o=await this.db.get(this.config.stores.conversations.name,s);a>=0&&a<o.messages.length?(o.messages[a].content=n,o.messages=o.messages.slice(0,a),await this.db.put(this.config.stores.conversations.name,o),console.log(`Message updated successfully in conversation: ${s}`)):console.warn(`Message index out of bounds: ${a}`)}catch(o){console.error(`Error updating message in conversation: ${o.message}`)}}async deleteSession(s){try{await this.db.delete(this.config.stores.conversations.name,Number(s)),await this.db.delete(this.config.stores.sessions.name,Number(s)),console.log(`Session ${s} deleted successfully`)}catch(t){console.error(`Error deleting session: ${t.message}`)}}};var i=class{static findElement(s,t){return s.querySelector(t)}static findElements(s,t){return s.querySelectorAll(t)}static addClass(s,t){s.classList.add(t)}static removeClass(s,t){s.classList.remove(t)}static toggleClass(s,t){s.classList.toggle(t)}static hasClass(s,t){return s.classList.contains(t)}static setAttribute(s,t,n){s.setAttribute(t,n)}static removeAttribute(s,t){s.removeAttribute(t)}static dispatchEvent(s,t,n={}){let a=new CustomEvent(t,{bubbles:!0,cancelable:!0,composed:!1,detail:n});s.dispatchEvent(a)}static insertHTML(s,t,n){s.insertAdjacentHTML(t,n)}static removeElement(s){s.remove()}static clearInnerHTML(s){s.innerHTML=""}};function ae(e,s=250){let t;return function(...n){let a=this;clearTimeout(t),t=setTimeout(()=>e.apply(a,n),s)}}function oe(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}async function re(e){try{await navigator.clipboard.writeText(e)}catch(s){console.error("Failed to copy text:",s)}}var k=class{constructor(s){this.root=s}displayChatHistory(s){let t=s.getAttribute("data-session-id");t&&i.dispatchEvent(this.root,"display-chat",{sessionId:t})}enableHistoryRenameMode(s){let t=document.querySelector('meta[name="viewport"]'),n=s.querySelector(".title");if(!n||i.hasClass(s,"renaming"))return;let a=n.textContent,o=document.createElement("input");o.type="text",o.value=a,o.className="rename-input";let r=async()=>{let d=o.value.trim(),h=s.dataset.sessionId;d&&d!==a?(i.dispatchEvent(this.root,"rename-chat",{sessionId:h,title:d}),n.textContent=d):n.textContent=a,i.removeElement(o),i.removeClass(s,"renaming"),t.setAttribute("content","width=device-width, initial-scale=1.0, interactive-widget=resizes-content")};o.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),o.blur()),d.key==="Escape"&&(n.textContent=a,i.removeElement(o),i.removeClass(s,"renaming"),t.setAttribute("content","width=device-width, initial-scale=1.0, interactive-widget=resizes-content"))}),o.addEventListener("blur",r),i.addClass(s,"renaming"),t.setAttribute("content","width=device-width, initial-scale=1.0, interactive-widget=resizes-visual"),n.after(o),o.focus()}deleteHistoryItem(s){let t=s.dataset.sessionId;i.dispatchEvent(this.root,"delete-chat",{sessionId:t}),i.removeElement(s)}};var C=class{constructor(s){this.root=s,this.modelMenu=s.querySelector("#model-menu")}selectModel(s){try{let t=s.getAttribute("data-model");if(!t)return;localStorage.setItem("selectedModel",t),i.findElements(this.modelMenu,".model").forEach(a=>{i.removeClass(a,"active")});let n=this.modelMenu.querySelector(`[data-model="${t}"]`);n&&i.addClass(n,"active"),i.dispatchEvent(this.root,"model-selected",{model:t})}catch(t){console.error("Error selecting model:",t)}}populateModelMenu(s){s.forEach(t=>{let[n,a]=t.name.split(":");i.insertHTML(this.modelMenu,"beforeend",`
                <button class="model" data-model="${t.name}">
                    <span class="name">${n}</span>
                    <span class="info">${a||""}</span>
                </button>
            `)})}setActiveModel(s){let t=this.modelMenu.querySelector(`[data-model="${s}"]`);t&&i.addClass(t,"active")}};var x=class{static generateMessageBlock(s,t){switch(t){case"user":return`<div class="chat__block user" data-role="${t}">
                  <div class="actions__wrapper">
                    <button class="action__button edit" title="Edit message">
                      <svg class="icon">
                        <use href="/assets/image/svg/icons.svg#edit-icon" />
                      </svg>
                    </button>
                  </div>
                  <span class="message">${s}</span>
                </div>`;case"assistant":return`<div class="chat__block assistant" data-role="${t}">
                  <svg class="icon assistant__logo">
                    <use href="/assets/image/svg/icons.svg#stars-icon" />
                  </svg>
                  <div class="response_wrapper">
                    <div class="response">
                      ${s}
                    </div>
                    <div class="actions__wrapper">
                      <button class="action__button copy" title="Copy message">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#copy-icon" />
                        </svg>
                      </button>
                      <button class="action__button regenerate" title="Regenerate response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#repeat-icon" />
                        </svg>
                      </button>
                      <button class="action__button like" title="Good response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#like-icon" />
                        </svg>
                      </button>
                      <button class="action__button dislike" title="Bad response">
                        <svg class="icon">
                          <use href="/assets/image/svg/icons.svg#dislike-icon" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>`;case"system":return`<div class="chat__block system">
                  ${s} 
                </div>`;default:return""}}static generateChatHistoryItem(s,t){return`<div class="item" data-session-id="${t}" tabindex="0">
              <span class="title">${s}</span>
              <div class="menu">
                <button class="menu__item rename" title="Rename">
                  <svg class="icon">
                    <use href="/assets/image/svg/icons.svg#edit-icon" />
                  </svg>
                </button>
                <button class="menu__item delete" title="Delete">
                  <svg class="icon">
                    <use href="/assets/image/svg/icons.svg#delete-icon" />
                  </svg>
                </button>
              </div>
            </div>`}};var O=class{constructor(s={}){this.uiOptions={root:"#chat-app-root",sidebarTogglers:".sidebar-toggler",textarea:"#chat-massage",sendButton:"#chat-send-button",newChatButton:"#new-chat-button",chatHistoryContainer:"#chat-history-container",contentScrollContainer:"#content-scroll-container",contentContainer:"#content-container",modelMenu:"#model-menu",scrollButton:"#scroll-button",sidebarStateName:"chat-sidebar-open",backdrop:".chat-backdrop",...s},this.root=document.querySelector(this.uiOptions.root),this.historyManager=new k(this.root),this.modelManager=new C(this.root),this.initWindowControls(),this.initializeElements(),this.registerEventListeners(),this.editMode=null,this.activeHistoryItem=null}initializeElements(){this.sidebarTogglers=i.findElements(this.root,this.uiOptions.sidebarTogglers),this.textarea=i.findElement(this.root,this.uiOptions.textarea),this.sendButton=i.findElement(this.root,this.uiOptions.sendButton),this.newChatButton=i.findElement(this.root,this.uiOptions.newChatButton),this.chatHistoryContainer=i.findElement(this.root,this.uiOptions.chatHistoryContainer),this.contentScrollContainer=i.findElement(this.root,this.uiOptions.contentScrollContainer),this.contentContainer=i.findElement(this.root,this.uiOptions.contentContainer),this.modelMenu=i.findElement(this.root,this.uiOptions.modelMenu),this.scrollButton=i.findElement(this.root,this.uiOptions.scrollButton)}setActiveHistoryItem(s){this.activeHistoryItem&&i.removeClass(this.activeHistoryItem,"active"),this.activeHistoryItem=s,s&&i.addClass(this.activeHistoryItem,"active")}clearActiveHistoryItem(){this.activeHistoryItem&&(i.removeClass(this.activeHistoryItem,"active"),this.activeHistoryItem=null)}registerEventListeners(){this.sidebarTogglers.forEach(t=>{t.addEventListener("click",()=>{try{this.toggleSidebar()}catch(n){console.error("Error toggling sidebar:",n)}})}),localStorage.getItem(this.uiOptions.sidebarStateName)==="true"&&i.addClass(this.root,"sidebar-open"),document.addEventListener("keydown",t=>{if(t.key==="Escape"&&i.hasClass(this.root,"sidebar-open"))try{this.toggleSidebar()}catch(n){console.error("Error handling Escape key:",n)}}),this.sendButton.addEventListener("click",async t=>{i.dispatchEvent(this.root,"send-message")}),this.textarea.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),i.dispatchEvent(this.root,"send-message"))}),this.contentScrollContainer.addEventListener("scroll",ae(()=>this.updateScrollState()),{passive:!0}),this.scrollButton.addEventListener("click",()=>{this.scrollToBottom()}),this.chatHistoryContainer.addEventListener("click",t=>{let n=t.target.closest(".menu__item.rename");if(n){t.stopPropagation();let r=n.closest(".item");this.historyManager.enableHistoryRenameMode(r);return}let a=t.target.closest(".menu__item.delete");if(a){t.stopPropagation();let r=a.closest(".item");this.historyManager.deleteHistoryItem(r);return}let o=t.target.closest(".item");o&&this.setActiveHistoryItem(o);try{this.historyManager.displayChatHistory(t.target)}catch(r){console.error("Error showing chat history:",r)}}),this.newChatButton.addEventListener("click",()=>{i.dispatchEvent(this.root,"new-chat")}),this.modelMenu.addEventListener("click",t=>{this.modelManager.selectModel(t.target)}),document.addEventListener("DOMContentLoaded",()=>{i.addClass(this.root,"loaded")}),this.contentContainer.addEventListener("click",t=>{let n=t.target.closest(".action__button.edit");if(n){let r=n.closest(".chat__block");this.enableEditMode(r)}let a=t.target.closest(".action__button.copy");if(a){let r=a.closest(".chat__block.assistant"),d=r.querySelector(".response").textContent.trim();i.dispatchEvent(this.root,"copy-message",{block:r,content:d})}let o=t.target.closest(".action__button.regenerate");if(o){let r=o.closest(".chat__block.assistant"),d=Array.from(r.parentNode.children).indexOf(r);i.dispatchEvent(this.root,"regenerate-message",{messageBlock:r,messageIndex:d})}})}toggleSidebar(){try{let s=this.root.classList.toggle("sidebar-open");localStorage.setItem(this.uiOptions.sidebarStateName,s);let t=i.findElement(this.root,this.uiOptions.backdrop);!t&&s&&(t=document.createElement("backdrop"),i.addClass(t,"chat-backdrop"),t.addEventListener("click",()=>this.toggleSidebar()),this.root.appendChild(t)),t&&i.toggleClass(t,"open")}catch(s){console.error("Error in toggleSidebar:",s)}}updateNetworkStatus(){this.root.classList.toggle("offline",!navigator.onLine)}renderMessage(s,t){let n=t==="user"?oe(s):s,a=x.generateMessageBlock(n,t);i.insertHTML(this.contentContainer,"beforeend",a)}addChatHistoryItem(s,t,n="beforeend"){i.insertHTML(this.chatHistoryContainer,n,x.generateChatHistoryItem(s,t))}scrollToBottom(){this.contentScrollContainer.scrollTo({top:this.contentScrollContainer.scrollHeight,behavior:"smooth"})}updateScrollState(s=500){let t=this.contentScrollContainer,n=t.scrollHeight-t.scrollTop<=t.clientHeight+s;this.root.classList[n?"add":"remove"]("bottom"),this.root.classList.add("scrolled")}enableEditMode(s){if(this.editMode)return;let t=s.querySelector(".message"),n=t.textContent,a=`
      <div class="edit__wrapper">
        <textarea class="edit-textarea">${n}</textarea>
        <div class="edit__actions">
          <button class="dark r save-edit">Save</button>
          <button class="r cancel-edit">Cancel</button>
        </div> 
      </div>
    `;i.addClass(s,"editing"),i.insertHTML(s,"beforeend",a);let o=s.querySelector(".edit-textarea");o.focus(),this.editMode={block:s,messageSpan:t,original:n,textarea:o},s.querySelector(".save-edit").addEventListener("click",()=>this.saveEdit()),s.querySelector(".cancel-edit").addEventListener("click",()=>this.cancelEdit()),o.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.saveEdit()),r.key==="Escape"&&this.cancelEdit()})}saveEdit(){if(!this.editMode)return;let s=this.editMode.textarea.value.trim();if(s&&s!==this.editMode.original){this.editMode.messageSpan.textContent=s;let t=this.editMode.block,n=s,a=Array.from(t.parentNode.children).indexOf(t);i.dispatchEvent(this.root,"save-edit",{messageBlock:t,content:n,messageIndex:a})}this.exitEditMode()}cancelEdit(){this.editMode&&this.exitEditMode()}exitEditMode(){if(!this.editMode)return;i.removeClass(this.editMode.block,"editing");let s=this.editMode.block.querySelector(".edit__wrapper");s&&i.removeElement(s),this.editMode=null}clearChatHistory(){i.clearInnerHTML(this.contentContainer)}addSystemMessage(s){this.renderMessage(s,"system")}initWindowControls(){if("windowControlsOverlay"in navigator){let s=t=>{try{let n=navigator.windowControlsOverlay.visible,{x:a,y:o,width:r,height:d}=t?.titlebarAreaRect||navigator.windowControlsOverlay.getTitlebarAreaRect();this.root.style.setProperty("--title-bar-height",`${d}px`),this.root.style.setProperty("--title-bar-width",`${r}px`),this.root.style.setProperty("--title-bar-x",`${a}px`),this.root.style.setProperty("--title-bar-y",`${o}px`),this.root.classList.toggle("overlay-visible",n)}catch(n){console.error("Error updating titlebar area:",n)}};navigator.windowControlsOverlay.addEventListener("geometrychange",s),s()}}removeBlocksAfter(s){Array.from(this.contentContainer.children).slice(s).forEach(n=>{i.removeElement(n)})}};var D=class{constructor(s){this.host=s,this.abortController=new AbortController}async getTitle(s,t){let n=await this.chat({model:s,messages:[{role:"system",content:"You are an AI assistant. Generate a concise, engaging title under 6 words that reflects the core intent of the user's first message, from their perspective. The title should summarize the query clearly to aid in future searchability. Respond *only* with the title\u2014no explanations."},{role:"user",content:`Generate a title for this message: '${t}'.`}]},null);return n.message.content?n.message.content.replaceAll('"',""):null}async chat(s,t=this.abortController.signal){try{let n=await fetch(`http://${this.host}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,stream:!1}),signal:t});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return await n.json()}catch(n){if(n.name==="AbortError")console.warn("Request aborted by user.");else throw console.error("Error in chat:",n),n}}async*streamChat(s,t=this.abortController.signal){try{let n=await fetch(`http://${this.host}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,stream:!0}),signal:t});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);let a=n.body.getReader(),o=new TextDecoder,r="";try{for(;;){let{done:d,value:h}=await a.read();if(d)break;r+=o.decode(h);let u=r.indexOf(`
`);for(;u!==-1;){let p=r.substring(0,u);if(r=r.substring(u+1),p)try{yield JSON.parse(p)}catch(f){console.error("Error parsing JSON:",f,p)}u=r.indexOf(`
`)}}}finally{a.releaseLock()}}catch(n){if(n.name==="AbortError")console.warn("Request aborted by user.");else throw console.error("Error in streamChat:",n),n}}async list(){try{let s=await fetch(`http://${this.host}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);return await s.json()}catch(s){throw console.error("Error in list:",s),s}}abort(){this.abortController.abort(),this.abortController=new AbortController,console.warn("ChatService Aborted")}};var B=1,le=2,de=4,he=8,ue=16;function Yt(e){switch(e){case B:return"href";case le:return"src";case de:return"data-code-lang";case he:return"checked";case ue:return"start"}}var ie=24;function P(e){let s=new Uint32Array(ie);return s[0]=1,{renderer:e,text:"",pending:"",tokens:s,len:0,token:1,code_fence_body:0,blockquote_idx:0,hr_char:"",hr_chars:0,backticks_count:0,spaces:new Uint8Array(ie),indent:"",indent_len:0}}function G(e){e.pending.length>0&&y(e,`
`)}function g(e){e.text.length!==0&&(console.assert(e.len>0,"Never adding text to root"),e.renderer.add_text(e.renderer.data,e.text),e.text="")}function E(e){console.assert(e.len>0,"No nodes to end"),e.len-=1,e.token=e.tokens[e.len],e.renderer.end_token(e.renderer.data)}function m(e,s){e.tokens[e.len]&25165824&&!(s&33554432)&&E(e),e.len+=1,e.tokens[e.len]=s,e.token=s,e.renderer.add_token(e.renderer.data,s)}function Zt(e,s,t){for(;t<=e.len;){if(e.tokens[t]&s)return t;t+=1}return-1}function L(e,s){for(;e.len>s;)E(e)}function H(e,s){let t=-1,n=-1;for(let a=e.blockquote_idx+1;a<=e.len;a+=1)if(e.tokens[a]&33554432){if(e.indent_len<e.spaces[a]){n=-1;break}n=a}else e.tokens[a]&s&&(t=a);return n===-1?t===-1?(L(e,e.blockquote_idx),m(e,s),!0):(L(e,t),!1):(L(e,n),m(e,s),!0)}function U(e,s){m(e,33554432),e.spaces[e.len]=e.indent_len+s,b(e),e.token=268435456}function b(e){e.indent="",e.indent_len=0,e.pending=""}function ce(e){switch(e){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return!0;default:return!1}}function y(e,s){for(let t of s){let n=e.pending+t;switch(e.token){case 1048576:case 1:case 524288:case 16777216:case 8388608:switch(console.assert(e.text.length===0,"Root should not have any text"),e.pending[0]){case void 0:e.pending=t;continue;case" ":console.assert(e.pending.length===1),e.pending=t,e.indent+=" ",e.indent_len+=1;continue;case"	":console.assert(e.pending.length===1),e.pending=t,e.indent+="	",e.indent_len+=4;continue;case`
`:if(console.assert(e.pending.length===1),e.tokens[e.len]&33554432&&e.token&1048576){E(e),e.pending=t;continue}L(e,e.blockquote_idx),e.blockquote_idx=0,e.backticks_count=0,e.pending=t;continue;case"#":switch(t){case"#":if(e.pending.length<6){e.pending=n;continue}break;case" ":switch(e.pending.length){case 1:m(e,4),b(e);continue;case 2:m(e,8),b(e);continue;case 3:m(e,16),b(e);continue;case 4:m(e,32),b(e);continue;case 5:m(e,64),b(e);continue;case 6:m(e,128),b(e);continue}console.assert(!1,"Should not reach here")}break;case">":{let o=Zt(e,524288,e.blockquote_idx+1);o===-1?(L(e,e.blockquote_idx),e.blockquote_idx+=1,e.backticks_count=0,m(e,524288)):e.blockquote_idx=o,b(e),e.pending=t;continue}case"-":case"*":case"_":if(e.hr_chars===0&&(console.assert(e.pending.length===1,"Pending should be one character"),e.hr_chars=1,e.hr_char=e.pending),e.hr_chars>0){switch(t){case e.hr_char:e.hr_chars+=1,e.pending=n;continue;case" ":e.pending=n;continue;case`
`:if(e.hr_chars<3)break;e.renderer.add_token(e.renderer.data,4194304),e.renderer.end_token(e.renderer.data),e.pending="",e.hr_chars=0;continue}e.hr_chars=0}if(e.pending[0]!=="_"&&e.pending[1]===" "){H(e,8388608),U(e,2),y(e,n.slice(2));continue}break;case"`":if(e.pending.length<3){if(t==="`"){e.pending=n,e.backticks_count=n.length;continue}e.backticks_count=0;break}switch(t){case"`":e.pending.length===e.backticks_count?(e.pending=n,e.backticks_count=n.length):(m(e,2),b(e),e.backticks_count=0,y(e,n));continue;case`
`:m(e,512),e.pending.length>e.backticks_count&&e.renderer.set_attr(e.renderer.data,de,e.pending.slice(e.backticks_count)),b(e);continue;default:e.pending=n;continue}case"+":if(t!==" ")break;H(e,8388608),U(e,2);continue;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(e.pending[e.pending.length-1]==="."){if(t!==" ")break;H(e,16777216)&&e.pending!=="1."&&e.renderer.set_attr(e.renderer.data,ue,e.pending.slice(0,-1)),U(e,e.pending.length+1);continue}else{let o=t.charCodeAt(0);if(o===46||ce(o)){e.pending=n;continue}}break}let a=n;if(e.token&1048576)e.token=e.tokens[e.len],e.renderer.add_token(e.renderer.data,1048576),e.renderer.end_token(e.renderer.data);else if(e.indent_len>=4){let o=0;for(;o<4;o+=1)if(e.indent[o]==="	"){o=o+1;break}a=e.indent.slice(o)+n,m(e,256)}else m(e,2);b(e),y(e,a);continue;case 256:switch(n){case`
    `:case`
   	`:case`
  	`:case`
 	`:case`
	`:e.text+=`
`,e.pending="";continue;case`
`:case`
 `:case`
  `:case`
   `:e.pending=n;continue;default:e.pending.length!==0?(g(e),E(e),e.pending=t):e.text+=t;continue}case 512:switch(t){case"`":n.length===e.backticks_count+e.code_fence_body?(g(e),E(e),e.pending="",e.backticks_count=0,e.code_fence_body=0):e.pending=n;continue;case`
`:e.text+=e.pending,e.pending=t,e.code_fence_body=1;continue;default:e.text+=n,e.pending="",e.code_fence_body=1;continue}case 1024:switch(t){case"`":n.length===e.backticks_count+ +(e.pending[0]===" ")?(g(e),E(e),e.pending="",e.backticks_count=0):e.pending=n;continue;case`
`:e.text+=e.pending,e.pending="",e.token=1048576,e.blockquote_idx=0,g(e);continue;case" ":e.text+=e.pending,e.pending=t;continue;default:e.text+=n,e.pending="";continue}case 268435456:switch(e.pending.length){case 0:if(t!=="[")break;e.pending=n;continue;case 1:if(t!==" "&&t!=="x")break;e.pending=n;continue;case 2:if(t!=="]")break;e.pending=n;continue;case 3:if(t!==" ")break;e.renderer.add_token(e.renderer.data,67108864),e.pending[1]==="x"&&e.renderer.set_attr(e.renderer.data,he,""),e.renderer.end_token(e.renderer.data),e.pending=" ";continue}e.token=e.tokens[e.len],e.pending="",y(e,n);continue;case 8192:case 16384:{let o="*",r=2048;if(e.token===16384&&(o="_",r=4096),o===e.pending){if(g(e),o===t){E(e),e.pending="";continue}m(e,r),e.pending=t;continue}break}case 2048:case 4096:{let o="*",r=8192;switch(e.token===4096&&(o="_",r=16384),e.pending){case o:o===t?e.tokens[e.len-1]===r?e.pending=n:(g(e),m(e,r),e.pending=""):(g(e),E(e),e.pending=t);continue;case o+o:let d=e.token;g(e),E(e),E(e),o!==t?(m(e,d),e.pending=t):e.pending="";continue}break}case 32768:if(n==="~~"){g(e),E(e),e.pending="";continue}break;case 134217728:n==="http://"||n==="https://"?(g(e),m(e,131072),e.pending=n,e.text=n):"http:/"[e.pending.length]===t||"https:/"[e.pending.length]===t?e.pending=n:(e.token=e.tokens[e.len],y(e,t));continue;case 65536:case 262144:if(e.pending==="]"){g(e),t==="("?e.pending=n:(E(e),e.pending=t);continue}if(e.pending[0]==="]"&&e.pending[1]==="("){if(t===")"){let o=e.token===65536?B:le,r=e.pending.slice(2);e.renderer.set_attr(e.renderer.data,o,r),E(e),e.pending=""}else e.pending+=t;continue}break;case 131072:t===" "||t===`
`||t==="\\"?(e.renderer.set_attr(e.renderer.data,B,e.pending),g(e),E(e),e.pending=t):(e.text+=t,e.pending=n);continue}switch(e.pending[0]){case"\\":if(t===`
`)e.pending=t;else{let a=t.charCodeAt(0);e.pending="",e.text+=ce(a)||a>=65&&a<=90||a>=97&&a<=122?n:t}continue;case`
`:g(e),e.token=1048576,e.blockquote_idx=0,e.pending=t;continue;case"`":if(e.token&262144)break;t==="`"?(e.backticks_count+=1,e.pending=n):(e.backticks_count+=1,g(e),m(e,1024),e.text=t===" "||t===`
`?"":t,e.pending="");continue;case"_":case"*":{if(e.token&262144)break;let a=2048,o=8192,r=e.pending[0];if(r==="_"&&(a=4096,o=16384),e.pending.length===1){if(r===t){e.pending=n;continue}if(t!==" "&&t!==`
`){g(e),m(e,a),e.pending=t;continue}}else{if(r===t){g(e),m(e,o),m(e,a),e.pending="";continue}if(t!==" "&&t!==`
`){g(e),m(e,o),e.pending=t;continue}}break}case"~":if(e.token&294912)break;if(e.pending==="~"){if(t==="~"){e.pending=n;continue}}else if(t!==" "&&t!==`
`){g(e),m(e,32768),e.pending=t;continue}break;case"[":if(!(e.token&327680)&&t!=="]"){g(e),m(e,65536),e.pending=t;continue}break;case"!":if(!(e.token&262144)&&t==="["){g(e),m(e,262144),e.pending="";continue}break;case" ":if(t===" ")continue;break}if(!(e.token&327680)&&t==="h"&&(e.pending===" "||e.pending==="")){e.text+=e.pending,e.pending=t,e.token=134217728;continue}e.text+=e.pending,e.pending=t}g(e)}function $(e){return{add_token:Wt,end_token:jt,add_text:Xt,set_attr:Vt,data:{nodes:[e,,,,,],index:0}}}function Wt(e,s){let t,n;switch(s){case 1:return;case 524288:t=n=document.createElement("blockquote");break;case 2:t=n=document.createElement("p");break;case 1048576:t=n=document.createElement("br");break;case 4194304:t=n=document.createElement("hr");break;case 4:t=n=document.createElement("h1");break;case 8:t=n=document.createElement("h2");break;case 16:t=n=document.createElement("h3");break;case 32:t=n=document.createElement("h4");break;case 64:t=n=document.createElement("h5");break;case 128:t=n=document.createElement("h6");break;case 2048:case 4096:t=n=document.createElement("em");break;case 8192:case 16384:t=n=document.createElement("strong");break;case 32768:t=n=document.createElement("s");break;case 1024:t=n=document.createElement("code");break;case 131072:case 65536:t=n=document.createElement("a");break;case 262144:t=n=document.createElement("img");break;case 8388608:t=n=document.createElement("ul");break;case 16777216:t=n=document.createElement("ol");break;case 33554432:t=n=document.createElement("li");break;case 67108864:let a=document.createElement("input");a.type="checkbox",a.disabled=!0,t=n=a;break;case 256:case 512:t=n=document.createElement("div");break}e.nodes[e.index].appendChild(t),e.index+=1,e.nodes[e.index]=n}function me(e){let s=document.createElement("div"),t=$(s),n=P(t);return y(n,e),G(n),s.innerHTML}function jt(e){e.index-=1}function Xt(e,s){e.nodes[e.index].appendChild(document.createTextNode(s))}function Vt(e,s,t){e.nodes[e.index].setAttribute(Yt(s),t)}var $s=ne({"./languages/assembly.js":()=>Promise.resolve().then(()=>(pe(),ge)),"./languages/bash.js":()=>Promise.resolve().then(()=>(K(),be)),"./languages/batch.js":()=>Promise.resolve().then(()=>(ye(),fe)),"./languages/bf.js":()=>Promise.resolve().then(()=>(_e(),Ie)),"./languages/c.js":()=>Promise.resolve().then(()=>(q(),Te)),"./languages/cpp.js":()=>Promise.resolve().then(()=>(we(),Ae)),"./languages/csharp.js":()=>Promise.resolve().then(()=>(Ne(),Ce)),"./languages/css.js":()=>Promise.resolve().then(()=>(Le(),xe)),"./languages/csv.js":()=>Promise.resolve().then(()=>(ve(),Se)),"./languages/dart.js":()=>Promise.resolve().then(()=>(ke(),Re)),"./languages/diff.js":()=>Promise.resolve().then(()=>(Z(),Oe)),"./languages/docker.js":()=>Promise.resolve().then(()=>(Me(),De)),"./languages/git.js":()=>Promise.resolve().then(()=>(Ue(),He)),"./languages/go.js":()=>Promise.resolve().then(()=>(Pe(),Be)),"./languages/html.js":()=>Promise.resolve().then(()=>(Ke(),Fe)),"./languages/http.js":()=>Promise.resolve().then(()=>(qe(),ze)),"./languages/ini.js":()=>Promise.resolve().then(()=>(Ze(),Ye)),"./languages/java.js":()=>Promise.resolve().then(()=>(je(),We)),"./languages/javascript.js":()=>Promise.resolve().then(()=>(V(),Xe)),"./languages/js_template_literals.js":()=>Promise.resolve().then(()=>(Qe(),Ve)),"./languages/jsdoc.js":()=>Promise.resolve().then(()=>(tt(),et)),"./languages/json.js":()=>Promise.resolve().then(()=>(nt(),st)),"./languages/kotlin.js":()=>Promise.resolve().then(()=>(ot(),at)),"./languages/latex.js":()=>Promise.resolve().then(()=>(it(),rt)),"./languages/leanpub-md.js":()=>Promise.resolve().then(()=>(dt(),lt)),"./languages/log.js":()=>Promise.resolve().then(()=>(ut(),ht)),"./languages/lua.js":()=>Promise.resolve().then(()=>(gt(),mt)),"./languages/make.js":()=>Promise.resolve().then(()=>(Et(),pt)),"./languages/markdown.js":()=>Promise.resolve().then(()=>(te(),ct)),"./languages/perl.js":()=>Promise.resolve().then(()=>(ft(),bt)),"./languages/php.js":()=>Promise.resolve().then(()=>(It(),yt)),"./languages/plain.js":()=>Promise.resolve().then(()=>(Tt(),_t)),"./languages/powershell.js":()=>Promise.resolve().then(()=>(wt(),At)),"./languages/python.js":()=>Promise.resolve().then(()=>(Nt(),Ct)),"./languages/regex.js":()=>Promise.resolve().then(()=>(Lt(),xt)),"./languages/rust.js":()=>Promise.resolve().then(()=>(vt(),St)),"./languages/sql.js":()=>Promise.resolve().then(()=>(kt(),Rt)),"./languages/swift.js":()=>Promise.resolve().then(()=>(Dt(),Ot)),"./languages/todo.js":()=>Promise.resolve().then(()=>(J(),Je)),"./languages/toml.js":()=>Promise.resolve().then(()=>(Ht(),Mt)),"./languages/typescript.js":()=>Promise.resolve().then(()=>(Bt(),Ut)),"./languages/uri.js":()=>Promise.resolve().then(()=>(Gt(),Pt)),"./languages/xml.js":()=>Promise.resolve().then(()=>(j(),$e)),"./languages/yaml.js":()=>Promise.resolve().then(()=>(Ft(),$t))});var Fs={num:{type:"num",match:/(\.e?|\b)\d(e-|[\d.oxa-fA-F_])*(\.|\b)/g},str:{type:"str",match:/(["'])(\\[^]|(?!\1)[^\r\n\\])*\1?/g},strDouble:{type:"str",match:/"((?!")[^\r\n\\]|\\[^])*"?/g}},Ks=new Map,zs=(e="")=>{let s={"&":"&#38;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,t=>s[t])},qs=(e,s)=>s?`<span class="${s}">${e}</span>`:e;async function Kt(e,s,t){try{let n;if(typeof s=="string"){if(n=Ks.get(s),!n&&(n=await $s(`./languages/${s}.js`),!n?.default))throw new Error(`Invalid language module for ${s}`)}else n=s;let a,o,r={},d,h=[],u=0,p=Array.isArray(n.sub)?[...n.sub]:Array.isArray(n.default)?[...n.default]:[];if(p.length===0){t(e);return}for(;u<e.length;){for(r.index=null,a=p.length;a-- >0;){if(o=p[a].expand?Fs[p[a].expand]:p[a],h[a]===void 0||h[a].match.index<u){if(o.match.lastIndex=u,d=o.match.exec(e),d===null){p.splice(a,1),h.splice(a,1);continue}h[a]={match:d,lastIndex:o.match.lastIndex}}h[a].match[0]&&(h[a].match.index<=r.index||r.index===null)&&(r={part:o,index:h[a].match.index,match:h[a].match[0],end:h[a].lastIndex})}if(r.index===null)break;t(e.slice(u,r.index),n.type),u=r.end,r.part.sub?await Kt(r.match,typeof r.part.sub=="string"?r.part.sub:typeof r.part.sub=="function"?r.part.sub(r.match):r.part,t):t(r.match,r.part.type)}t(e.slice(u,e.length),n.type)}catch(n){console.error(`Tokenization error: ${n.message}`),t(e)}}function Ys(e,s){navigator.clipboard.writeText(s.textContent).then(()=>{e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},2e3)}).catch(t=>{console.error("Failed to copy:",t),e.classList.add("failed")})}async function Zs(e,s,t=!0,n={}){let a="";return await Kt(e,s,(r,d)=>a+=qs(zs(r),d)),t?`<div class="header"><span class="lang">${s}</span><button class="copy" title="Copy Code"></button></div><div class="wrapper"><div class="numbers">${"<div></div>".repeat(n.lineNumbers&&e.split(`
`).length)}</div><code class="code">${a}</code></div>`:`<div class="wrapper"><code class="code">${a}</code></div><button class="copy" title="Copy Code"></button>`}async function Ws(e,s=e.dataset.codeLang,t,n){let a=e.textContent.trim();t??=`${a.split(`
`).length<2?"one":"multi"}line`,e.className=`${[...e.classList].filter(d=>!d.startsWith("")).join(" ")}code-block ${s} ${t} highlighted`,e.innerHTML=await Zs(a,s,t=="multiline",n);let o=e.querySelector(".copy"),r=e.querySelector(".code");o&&r&&o.addEventListener("click",()=>Ys(o,r))}var zt=async e=>Promise.all(Array.from(document.querySelectorAll("[data-code-lang]:not(.highlighted)")).map(s=>Ws(s,void 0,void 0,e)));var _=class{static parseMarkdown(s){return me(s)}static getParser(s){let t=$(s);return P(t)}static parserWrite(s,t){y(s,t)}static parserEnd(s){G(s)}static highlightCode(){zt()}};var se=class{constructor(s={}){this.config=new S(s),this.dbManager=new R(this.config),this.ui=new O,this.modelManager=new C(this.ui.root),this.host="localhost:11434",this.chatService=new D(this.host),this.sessionId=0,this.context=[],this.maxContext=20,this.aiOptions={},this.systemPrompt=this.config.ai.system,this.model="",this.modelList=[],this.initialize(),this.registerEvents()}async initialize(){window.addEventListener("popstate",n=>{this.handleUrlChange(n)});let s=this.getSessionIdFromUrl();s?history.replaceState({type:"chat",sessionId:s},null,`?session=${s}`):history.replaceState({type:"new"},null,window.location.pathname),await this.dbManager.initialize()&&await this.loadChatHistory(),s&&await this.displayChatHistory(s),await this.loadModels()}registerEvents(){this.ui.root.addEventListener("send-message",async()=>{if(i.hasClass(this.ui.root,"generating")){this.abortGenerate();return}await this.processChat()}),this.ui.root.addEventListener("new-chat",()=>{this.startNewChat()}),this.ui.root.addEventListener("display-chat",async s=>{let t=s.detail.sessionId;history.pushState({type:"chat",sessionId:t},null,`?session=${t}`),await this.displayChatHistory(t)}),this.ui.root.addEventListener("model-selected",s=>{this.model=s.detail.model,localStorage.setItem("selectedModel",this.model)}),this.ui.root.addEventListener("save-edit",async s=>{let{messageBlock:t,content:n,messageIndex:a}=s.detail;await this.saveEdit(t,n,a)}),this.ui.root.addEventListener("rename-chat",async s=>{let{sessionId:t,title:n}=s.detail;!t||!n||(await this.dbManager.updateChatHistoryTitle(t,n),this.sessionId===Number(t)&&(document.title=n))}),this.ui.root.addEventListener("delete-chat",async s=>{let{sessionId:t}=s.detail;await this.dbManager.deleteSession(t),this.sessionId===Number(t)&&this.startNewChat()}),this.ui.root.addEventListener("copy-message",async s=>{await re(s.detail.content)}),this.ui.root.addEventListener("regenerate-message",async s=>{let{messageBlock:t,messageIndex:n}=s.detail,o=this.ui.contentContainer.children[n-1].querySelector(".message").textContent;this.ui.removeBlocksAfter(n-1);let d=(await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId)).messages.slice(0,[n-1]);await this.refreshContext(d,this.maxContext),await this.processChat(o)})}async processChat(s=null){try{let t=s||this.ui.textarea.value.trim();if(!t||i.hasClass(this.ui.root,"generating"))return;this.ui.textarea.value="",i.addClass(this.ui.root,"generating");let n=!this.ui.root.hasAttribute("data-session-id");n&&(this.sessionId=await this.dbManager.createNewSession(),i.setAttribute(this.ui.root,"data-session-id",this.sessionId),this.ui.addChatHistoryItem(`New Chat ${this.sessionId}`,this.sessionId,"afterbegin")),i.removeClass(this.ui.root,"initial"),this.ui.renderMessage(t,"user"),this.ui.renderMessage("","assistant"),this.ui.scrollToBottom(),await this.dbManager.addMessage(this.sessionId,{role:"user",content:t}),this.context.push({role:"user",content:t});let a=this.ui.contentContainer.querySelector(".chat__block.assistant:last-child .response_wrapper .response"),o=this.chatService.streamChat({model:this.model,messages:[{role:"system",content:this.systemPrompt},...this.context],options:this.aiOptions}),r=_.getParser(a),d="";for await(let h of o)d+=h.message.content,_.parserWrite(r,h.message.content);if(_.parserEnd(r),i.removeClass(this.ui.root,"generating"),_.highlightCode(),await this.dbManager.addMessage(this.sessionId,{role:"assistant",content:d}),this.context.push({role:"assistant",content:d}),n){let h=await this.chatService.getTitle(this.model,t);if(h){let u=this.ui.chatHistoryContainer.querySelector(`.item[data-session-id="${this.sessionId}"] .title`);u&&(u.textContent=h),await this.dbManager.updateChatHistoryTitle(this.sessionId,h)}}this.context.length>=this.maxContext&&await this.refreshContext(this.context,this.maxContext),console.log(this.context)}catch(t){i.removeClass(this.ui.root,"generating"),console.error("Error processing chat:",t)}}startNewChat(){i.addClass(this.ui.root,"initial"),this.ui.clearChatHistory(),this.ui.textarea.value="",i.removeAttribute(this.ui.root,"data-session-id"),this.context=[],this.sessionId=0,this.ui.clearActiveHistoryItem(),history.pushState({type:"new"},null,window.location.pathname)}async loadChatHistory(){try{let s=await this.dbManager.getRecentItems(this.config.stores.sessions.name,this.config.ui.maxHistory,"updateTime");s.length&&s.forEach(t=>{this.ui.addChatHistoryItem(t.title,t.sessionId)})}catch(s){console.error("Error loading chat history:",s)}}async displayChatHistory(s){if(s!=this.sessionId)try{i.removeClass(this.ui.root,"initial"),this.ui.clearChatHistory(),i.setAttribute(this.ui.root,"data-session-id",s),this.sessionId=Number(s);let t=await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId);if(t.messages.length){for(let o of t.messages)o.role==="assistant"?this.ui.renderMessage(_.parseMarkdown(o.content),o.role):this.ui.renderMessage(o.content,o.role);this.ui.scrollToBottom(),_.highlightCode(),await this.refreshContext(t.messages,this.maxContext),console.log(this.context)}let n=await this.dbManager.db.get(this.config.stores.sessions.name,this.sessionId);document.title=n.title;let a=this.ui.chatHistoryContainer.querySelector(`.item[data-session-id="${s}"]`);a&&this.ui.setActiveHistoryItem(a)}catch(t){console.error("Error displaying chat history:",t)}}async loadModels(){try{let s=await this.chatService.list();s.models.length?(this.modelList=s.models,localStorage.getItem("selectedModel")||localStorage.setItem("selectedModel",this.modelList[0].name),this.model=localStorage.getItem("selectedModel"),this.modelManager.populateModelMenu(this.modelList),this.modelManager.setActiveModel(this.model)):(console.error("At least one model is required"),this.ui.addSystemMessage("At least one model is required"))}catch(s){console.error("Error initializing chat:",s),this.ui.addSystemMessage("Error initializing chat. Check console for details.")}}async refreshContext(s,t=10){try{if(s.length>t){let n=Math.floor(t/2),a=s.filter(r=>r.role==="user").slice(0,n),o=s.slice(-n);this.context=[...a,...o]}else s.length&&(this.context=s)}catch(n){console.error("Error updating context:",n)}}abortGenerate(){this.chatService.abort()}getSessionIdFromUrl(){return new URLSearchParams(window.location.search).get("session")}async handleUrlChange(s){let t=this.getSessionIdFromUrl(),n=s.state;n&&n.type==="chat"&&t?await this.displayChatHistory(t):n&&n.type==="new"&&this.startNewChat()}async saveEdit(s,t,n){try{let a=Number(this.ui.root.dataset.sessionId);await this.dbManager.updateMessage(a,s,t,n),this.ui.removeBlocksAfter(n);let o=await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId);await this.refreshContext(o.messages,this.maxContext),await this.processChat(t)}catch(a){console.error("Error saving edit:",a)}}},Gn=new se;})();
