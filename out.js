(()=>{var vs=Object.defineProperty;var Fe=n=>e=>{var t=n[e];if(t)return t();throw new Error("Module not found in bundle: "+e)};var p=(n,e)=>()=>(n&&(e=n(n=0)),e);var d=(n,e)=>{for(var t in e)vs(n,t,{get:e[t],enumerable:!0})};var dt={};d(dt,{default:()=>Cr});var Cr,ft=p(()=>{Cr=[{type:"cmnt",match:/(;|#).*/gm},{expand:"str"},{expand:"num"},{type:"num",match:/\$[\da-fA-F]*\b/g},{type:"kwd",match:/^[a-z]+\s+[a-z.]+\b/gm,sub:[{type:"func",match:/^[a-z]+/g}]},{type:"kwd",match:/^\t*[a-z][a-z\d]*\b/gm},{match:/%|\$/g,type:"oper"}]});var mt={};d(mt,{default:()=>ke});var gt,ke,Te=p(()=>{gt={type:"var",match:/\$\w+|\${[^}]*}|\$\([^)]*\)/g},ke=[{sub:"todo",match:/#.*/g},{type:"str",match:/(["'])((?!\1)[^\r\n\\]|\\[^])*\1?/g,sub:[gt]},{type:"oper",match:/(?<=\s|^)\.*\/[a-z/_.-]+/gi},{type:"kwd",match:/\s-[a-zA-Z]+|$<|[&|;]+|\b(unset|readonly|shift|export|if|fi|else|elif|while|do|done|for|until|case|esac|break|continue|exit|return|trap|wait|eval|exec|then|declare|enable|local|select|typeset|time|add|remove|install|update|delete)(?=\s|$)/g},{expand:"num"},{type:"func",match:/(?<=(^|\||\&\&|\;)\s*)[a-z_.-]+(?=\s|$)/gmi},{type:"bool",match:/(?<=\s|^)(true|false)(?=\s|$)/g},{type:"oper",match:/[=(){}<>!]+/g},{type:"var",match:/(?<=\s|^)[\w_]+(?=\s*=)/g},gt]});var bt={};d(bt,{default:()=>Lr});var Lr,yt=p(()=>{Lr=[{match:/[^\[\->+.<\]\s].*/g,sub:"todo"},{type:"func",match:/\.+/g},{type:"kwd",match:/[<>]+/g},{type:"oper",match:/[+-]+/g}]});var wt={};d(wt,{default:()=>Se});var Se,Ae=p(()=>{Se=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/#\s*include (<.*>|".*")/g,sub:[{type:"str",match:/(<|").*/g}]},{match:/asm\s*{[^}]*}/g,sub:[{type:"kwd",match:/^asm/g},{match:/[^{}]*(?=}$)/g,sub:"asm"}]},{type:"kwd",match:/\*|&|#[a-z]+\b|\b(asm|auto|double|int|struct|break|else|long|switch|case|enum|register|typedef|char|extern|return|union|const|float|short|unsigned|continue|for|signed|void|default|goto|sizeof|volatile|do|if|static|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var xt={};d(xt,{default:()=>Or});var Or,Et=p(()=>{Ae();Or=[...Se]});var kt={};d(kt,{default:()=>$r});var $r,Tt=p(()=>{$r=[{match:/\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/@\w+\b|\b(and|not|only|or)\b|\b[a-z-]+(?=[^{}]*{)/g},{type:"var",match:/\b[\w-]+(?=\s*:)|(::?|\.)[\w-]+(?=[^{}]*{)/g},{type:"func",match:/#[\w-]+(?=[^{}]*{)/g},{type:"num",match:/#[\da-f]{3,8}/g},{type:"num",match:/\d+(\.\d+)?(cm|mm|in|px|pt|pc|em|ex|ch|rem|vm|vh|vmin|vmax|%)?/g,sub:[{type:"var",match:/[a-z]+|%/g}]},{match:/url\([^)]*\)/g,sub:[{type:"func",match:/url(?=\()/g},{type:"str",match:/[^()]+/g}]},{type:"func",match:/\b[a-zA-Z]\w*(?=\s*\()/g},{type:"num",match:/\b[a-z-]+\b/g}]});var St={};d(St,{default:()=>Nr});var Nr,At=p(()=>{Nr=[{expand:"strDouble"},{type:"oper",match:/,/g}]});var Rt={};d(Rt,{default:()=>Re});var Re,Ie=p(()=>{Re=[{type:"deleted",match:/^[-<].*/gm},{type:"insert",match:/^[+>].*/gm},{type:"kwd",match:/!.*/gm},{type:"section",match:/^@@.*@@$|^\d.*|^([*-+])\1\1.*/gm}]});var It={};d(It,{default:()=>_r});var _r,vt=p(()=>{Te();_r=[{type:"kwd",match:/^(FROM|RUN|CMD|LABEL|MAINTAINER|EXPOSE|ENV|ADD|COPY|ENTRYPOINT|VOLUME|USER|WORKDIR|ARG|ONBUILD|STOPSIGNAL|HEALTHCHECK|SHELL)\b/gmi},...ke]});var Ct={};d(Ct,{default:()=>Pr});var Pr,Lt=p(()=>{Ie();Pr=[{match:/^#.*/gm,sub:"todo"},{expand:"str"},...Re,{type:"func",match:/^(\$ )?git(\s.*)?$/gm},{type:"kwd",match:/^commit \w+$/gm}]});var Ot={};d(Ot,{default:()=>Dr});var Dr,$t=p(()=>{Dr=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\*|&|\b(break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go|goto|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"oper",match:/[+\-*\/%&|^~=!<>.^-]+/g}]});var _t={};d(_t,{default:()=>ve,name:()=>_,properties:()=>P,xmlElement:()=>C});var Nt,Br,_,P,C,ve,Ce=p(()=>{Nt=":A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD",Br=Nt+"\\-\\.0-9\xB7\u0300-\u036F\u203F-\u2040",_=`[${Nt}][${Br}]*`,P=`\\s*(\\s+${_}\\s*(=\\s*([^"']\\S*|("|')(\\\\[^]|(?!\\4)[^])*\\4?)?)?\\s*)*`,C={match:RegExp(`<[/!?]?${_}${P}[/!?]?>`,"g"),sub:[{type:"var",match:RegExp(`^<[/!?]?${_}`,"g"),sub:[{type:"oper",match:/^<[\/!?]?/g}]},{type:"str",match:/=\s*([^"']\S*|("|')(\\[^]|(?!\2)[^])*\2?)/g,sub:[{type:"oper",match:/^=/g}]},{type:"oper",match:/[\/!?]?>/g},{type:"class",match:RegExp(_,"g")}]},ve=[{match:/<!--((?!-->)[^])*-->/g,sub:"todo"},{type:"class",match:/<!\[CDATA\[[\s\S]*?\]\]>/gi},C,{type:"str",match:RegExp(`<\\?${_}([^?]|\\?[^?>])*\\?+>`,"g"),sub:[{type:"var",match:RegExp(`^<\\?${_}`,"g"),sub:[{type:"oper",match:/^<\?/g}]},{type:"oper",match:/\?+>$/g}]},{type:"var",match:/&(#x?)?[\da-z]{1,8};/gi}]});var Pt={};d(Pt,{default:()=>Mr});var Mr,Dt=p(()=>{Ce();Mr=[{type:"class",match:/<!DOCTYPE("[^"]*"|'[^']*'|[^"'>])*>/gi,sub:[{type:"str",match:/"[^"]*"|'[^']*'/g},{type:"oper",match:/^<!|>$/g},{type:"var",match:/DOCTYPE/gi}]},{match:RegExp(`<style${P}>((?!</style>)[^])*</style\\s*>`,"g"),sub:[{match:RegExp(`^<style${P}>`,"g"),sub:C.sub},{match:RegExp(`${C.match}|[^]*(?=</style\\s*>$)`,"g"),sub:"css"},C]},{match:RegExp(`<script${P}>((?!<\/script>)[^])*<\/script\\s*>`,"g"),sub:[{match:RegExp(`^<script${P}>`,"g"),sub:C.sub},{match:RegExp(`${C.match}|[^]*(?=<\/script\\s*>$)`,"g"),sub:"js"},C]},...ve]});var zr,D,re=p(()=>{zr=[["bash",[/#!(\/usr)?\/bin\/bash/g,500],[/\b(if|elif|then|fi|echo)\b|\$/g,10]],["html",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^\s+<!DOCTYPE\s+html/g,500]],["http",[/^(GET|HEAD|POST|PUT|DELETE|PATCH|HTTP)\b/g,500]],["javascript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require)\b/g,10]],["typescript",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require|implements|interface|namespace)\b/g,10]],["python",[/\b(def|print|class|and|or|lambda)\b/g,10]],["sql",[/\b(SELECT|INSERT|FROM)\b/g,50]],["pl",[/#!(\/usr)?\/bin\/perl/g,500],[/\b(use|print)\b|\$/g,10]],["lua",[/#!(\/usr)?\/bin\/lua/g,500]],["make",[/\b(ifneq|endif|if|elif|then|fi|echo|.PHONY|^[a-z]+ ?:$)\b|\$/gm,10]],["uri",[/https?:|mailto:|tel:|ftp:/g,30]],["diff",[/^[+><-]/gm,10],[/^@@ ?[-+,0-9 ]+ ?@@/gm,25]],["markdown",[/^(>|\t\*|\t\d+.)/gm,10],[/\[.*\](.*)/g,10]],["docker",[/^(FROM|ENTRYPOINT|RUN)/gm,500]],["xml",[/<\/?[a-z-]+[^\n>]*>/g,10],[/^<\?xml/g,500]],["c",[/#include\b|\bprintf\s+\(/g,100]],["rust",[/^\s+(use|fn|mut|match)\b/gm,100]],["go",[/\b(func|fmt|package)\b/g,100]],["java",[/^import\s+java/gm,500]],["asm",[/^(section|global main|extern|\t(call|mov|ret))/gm,100]],["css",[/^(@import|@page|@media|(\.|#)[a-z]+)/gm,20]],["json",[/\b(true|false|null|\{})\b|\"[^"]+\":/g,10]],["yaml",[/^(\s+)?[a-z][a-z0-9]*:/gmi,10]]],D=n=>zr.map(([e,...t])=>[e,t.reduce((s,[r,i])=>s+[...n.matchAll(r)].length*i,0)]).filter(([e,t])=>t>20).sort((e,t)=>t[1]-e[1])[0]?.[0]||"plain"});var Bt={};d(Bt,{default:()=>Ur});var Ur,Mt=p(()=>{re();Ur=[{type:"kwd",match:/^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH|PRI|SEARCH)\b/gm},{expand:"str"},{type:"section",match:/\bHTTP\/[\d.]+\b/g},{expand:"num"},{type:"oper",match:/[,;:=]/g},{type:"var",match:/[a-zA-Z][\w-]*(?=:)/g},{match:/\n\n[^]*/g,sub:D}]});var zt={};d(zt,{default:()=>Hr});var Hr,Ut=p(()=>{Hr=[{match:/(^[ \f\t\v]*)[#;].*/gm,sub:"todo"},{type:"str",match:/.*/g},{type:"var",match:/.*(?==)/g},{type:"section",match:/^\s*\[.+\]\s*$/gm},{type:"oper",match:/=/g}]});var Ht={};d(Ht,{default:()=>Fr});var Fr,Ft=p(()=>{Fr=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(abstract|assert|boolean|break|byte|case|catch|char|class|continue|const|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|package|private|protected|public|requires|return|short|static|strictfp|super|switch|synchronized|this|throw|throws|transient|try|var|void|volatile|while)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*\()/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var qt={};d(qt,{default:()=>Le});var Le,Oe=p(()=>{Le=[{match:/\/\*\*((?!\*\/)[^])*(\*\/)?/g,sub:"jsdoc"},{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{match:/`((?!`)[^]|\\[^])*`?/g,sub:"js_template_literals"},{type:"kwd",match:/=>|\b(this|set|get|as|async|await|break|case|catch|class|const|constructor|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|if|implements|import|in|instanceof|interface|let|var|of|new|package|private|protected|public|return|static|super|switch|throw|throws|try|typeof|void|while|with|yield)\b/g},{match:/\/((?!\/)[^\r\n\\]|\\.)+\/[dgimsuy]*/g,sub:"regex"},{expand:"num"},{type:"num",match:/\b(NaN|null|undefined|[A-Z][A-Z_]*)\b/g},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z$_][\w$_]*(?=\s*((\?\.)?\s*\(|=\s*(\(?[\w,{}\[\])]+\)? =>|function\b)))/g}]});var Gt={};d(Gt,{default:()=>qr,type:()=>Gr});var qr,Gr,jt=p(()=>{qr=[{match:new class{exec(n){let e=this.lastIndex,t,s=r=>{for(;++e<n.length-2;)if(n[e]=="{")s();else if(n[e]=="}")return};for(;e<n.length;++e)if(n[e-1]!="\\"&&n[e]=="$"&&n[e+1]=="{")return t=e++,s(e),this.lastIndex=e+1,{index:t,0:n.slice(t,e+1)};return null}},sub:[{type:"kwd",match:/^\${|}$/g},{match:/(?!^\$|{)[^]+(?=}$)/g,sub:"js"}]}],Gr="str"});var Zt={};d(Zt,{default:()=>$e,type:()=>jr});var $e,jr,Ne=p(()=>{$e=[{type:"err",match:/\b(TODO|FIXME|DEBUG|OPTIMIZE|WARNING|XXX|BUG)\b/g},{type:"class",match:/\bIDEA\b/g},{type:"insert",match:/\b(CHANGED|FIX|CHANGE)\b/g},{type:"oper",match:/\bQUESTION\b/g}],jr="cmnt"});var Yt={};d(Yt,{default:()=>Zr,type:()=>Yr});var Zr,Yr,Xt=p(()=>{Ne();Zr=[{type:"kwd",match:/@\w+/g},{type:"class",match:/{[\w\s|<>,.@\[\]]+}/g},{type:"var",match:/\[[\w\s="']+\]/g},...$e],Yr="cmnt"});var Vt={};d(Vt,{default:()=>Xr});var Xr,Wt=p(()=>{Xr=[{type:"var",match:/("|')?[a-zA-Z]\w*\1(?=\s*:)/g},{expand:"str"},{expand:"num"},{type:"num",match:/\bnull\b/g},{type:"bool",match:/\b(true|false)\b/g}]});var Kt={};d(Kt,{default:()=>_e});var _e,Pe=p(()=>{re();_e=[{type:"cmnt",match:/^>.*|(=|-)\1+/gm},{type:"class",match:/\*\*((?!\*\*).)*\*\*/g},{match:/```((?!```)[^])*\n```/g,sub:n=>({type:"kwd",sub:[{match:/\n[^]*(?=```)/g,sub:n.split(`
`)[0].slice(3)||D(n)}]})},{type:"str",match:/`[^`]*`/g},{type:"var",match:/~~((?!~~).)*~~/g},{type:"kwd",match:/_[^_]*_|\*[^*]*\*/g},{type:"kwd",match:/^\s*(\*|\d+\.)\s/gm},{type:"oper",match:/\[[^\]]*]/g},{type:"func",match:/\([^)]*\)/g}]});var Qt={};d(Qt,{default:()=>Vr});var Vr,Jt=p(()=>{Pe();re();Vr=[{type:"insert",match:/(leanpub-start-insert)((?!leanpub-end-insert)[^])*(leanpub-end-insert)?/g,sub:[{type:"insert",match:/leanpub-(start|end)-insert/g},{match:/(?!leanpub-start-insert)((?!leanpub-end-insert)[^])*/g,sub:D}]},{type:"deleted",match:/(leanpub-start-delete)((?!leanpub-end-delete)[^])*(leanpub-end-delete)?/g,sub:[{type:"deleted",match:/leanpub-(start|end)-delete/g},{match:/(?!leanpub-start-delete)((?!leanpub-end-delete)[^])*/g,sub:D}]},..._e]});var es={};d(es,{default:()=>Wr});var Wr,ts=p(()=>{Wr=[{type:"cmnt",match:/^#.*/gm},{expand:"strDouble"},{expand:"num"},{type:"err",match:/\b(err(or)?|[a-z_-]*exception|warn|warning|failed|ko|invalid|not ?found|alert|fatal)\b/gi},{type:"num",match:/\b(null|undefined)\b/gi},{type:"bool",match:/\b(false|true|yes|no)\b/gi},{type:"oper",match:/\.|,/g}]});var ss={};d(ss,{default:()=>Kr});var Kr,rs=p(()=>{Kr=[{match:/^#!.*|--(\[(=*)\[((?!--\]\2\])[^])*--\]\2\]|.*)/g,sub:"todo"},{expand:"str"},{type:"kwd",match:/\b(and|break|do|else|elseif|end|for|function|if|in|local|not|or|repeat|return|then|until|while)\b/g},{type:"bool",match:/\b(true|false|nil)\b/g},{type:"oper",match:/[+*/%^#=~<>:,.-]+/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*[({])/g}]});var ns={};d(ns,{default:()=>Qr});var Qr,is=p(()=>{Qr=[{match:/^\s*#.*/gm,sub:"todo"},{expand:"str"},{type:"oper",match:/[${}()]+/g},{type:"class",match:/.PHONY:/gm},{type:"section",match:/^[\w.]+:/gm},{type:"kwd",match:/\b(ifneq|endif)\b/g},{expand:"num"},{type:"var",match:/[A-Z_]+(?=\s*=)/g},{match:/^.*$/gm,sub:"bash"}]});var as={};d(as,{default:()=>Jr});var Jr,os=p(()=>{Jr=[{match:/#.*/g,sub:"todo"},{type:"str",match:/(["'])(\\[^]|(?!\1)[^])*\1?/g},{expand:"num"},{type:"kwd",match:/\b(any|break|continue|default|delete|die|do|else|elsif|eval|for|foreach|given|goto|if|last|local|my|next|our|package|print|redo|require|return|say|state|sub|switch|undef|unless|until|use|when|while|not|and|or|xor)\b/g},{type:"oper",match:/[-+*/%~!&<>|=?,]+/g},{type:"func",match:/[a-z_]+(?=\s*\()/g}]});var ls={};d(ls,{default:()=>en});var en,cs=p(()=>{en=[{expand:"strDouble"}]});var hs={};d(hs,{default:()=>tn});var tn,us=p(()=>{tn=[{match:/#.*/g,sub:"todo"},{match:/("""|''')(\\[^]|(?!\1)[^])*\1?/g,sub:"todo"},{type:"str",match:/f("|')(\\[^]|(?!\1).)*\1?|f((["'])\4\4)(\\[^]|(?!\3)[^])*\3?/gi,sub:[{type:"var",match:/{[^{}]*}/g,sub:[{match:/(?!^{)[^]*(?=}$)/g,sub:"py"}]}]},{expand:"str"},{type:"kwd",match:/\b(and|as|assert|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g},{type:"bool",match:/\b(False|True|None)\b/g},{expand:"num"},{type:"func",match:/[a-z_]+(?=\s*\()/g},{type:"oper",match:/[-/*+<>,=!&|^%]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g}]});var ps={};d(ps,{default:()=>sn,type:()=>rn});var sn,rn,ds=p(()=>{sn=[{match:/^(?!\/).*/gm,sub:"todo"},{type:"num",match:/\[((?!\])[^\\]|\\.)*\]/g},{type:"kwd",match:/\||\^|\$|\\.|\w+($|\r|\n)/g},{type:"var",match:/\*|\+|\{\d+,\d+\}/g}],rn="oper"});var fs={};d(fs,{default:()=>nn});var nn,gs=p(()=>{nn=[{match:/\/\/.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{expand:"num"},{type:"kwd",match:/\b(as|break|const|continue|crate|else|enum|extern|false|fn|for|if|impl|in|let|loop|match|mod|move|mut|pub|ref|return|self|Self|static|struct|super|trait|true|type|unsafe|use|where|while|async|await|dyn|abstract|become|box|do|final|macro|override|priv|typeof|unsized|virtual|yield|try)\b/g},{type:"oper",match:/[/*+:?&|%^~=!,<>.^-]+/g},{type:"class",match:/\b[A-Z][\w_]*\b/g},{type:"func",match:/[a-zA-Z_][\w_]*(?=\s*!?\s*\()/g}]});var ms={};d(ms,{default:()=>an});var an,bs=p(()=>{an=[{match:/--.*\n?|\/\*((?!\*\/)[^])*(\*\/)?/g,sub:"todo"},{expand:"str"},{type:"func",match:/\b(AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/g},{type:"kwd",match:/\b(ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|kwdS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:S|ING)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/g},{type:"num",match:/\.?\d[\d.oxa-fA-F-]*|\bNULL\b/g},{type:"bool",match:/\b(TRUE|FALSE)\b/g},{type:"oper",match:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|IN|ILIKE|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/g},{type:"var",match:/@\S+/g}]});var ys={};d(ys,{default:()=>on});var on,ws=p(()=>{on=[{match:/#.*/g,sub:"todo"},{type:"str",match:/("""|''')((?!\1)[^]|\\[^])*\1?/g},{expand:"str"},{type:"section",match:/^\[.+\]\s*$/gm},{type:"num",match:/\b(inf|nan)\b|\d[\d:ZT.-]*/g},{expand:"num"},{type:"bool",match:/\b(true|false)\b/g},{type:"oper",match:/[+,.=-]/g},{type:"var",match:/\w+(?= \=)/g}]});var xs={};d(xs,{default:()=>ln});var ln,Es=p(()=>{Oe();ln=[{type:"type",match:/:\s*(any|void|number|boolean|string|object|never|enum)\b/g},{type:"kwd",match:/\b(type|namespace|typedef|interface|public|private|protected|implements|declare|abstract|readonly)\b/g},...Le]});var ks={};d(ks,{default:()=>cn});var cn,Ts=p(()=>{cn=[{match:/^#.*/gm,sub:"todo"},{type:"class",match:/^\w+(?=:?)/gm},{type:"num",match:/:\d+/g},{type:"oper",match:/[:/&?]|\w+=/g},{type:"func",match:/[.\w]+@|#[\w]+$/gm},{type:"var",match:/\w+\.\w+(\.\w+)*/g}]});var Ss={};d(Ss,{default:()=>hn});var hn,As=p(()=>{hn=[{match:/#.*/g,sub:"todo"},{expand:"str"},{type:"str",match:/(>|\|)\r?\n((\s[^\n]*)?(\r?\n|$))*/g},{type:"type",match:/!![a-z]+/g},{type:"bool",match:/\b(Yes|No)\b/g},{type:"oper",match:/[+:-]/g},{expand:"num"},{type:"var",match:/[a-zA-Z]\w*(?=:)/g}]});var X=class{constructor(e={}){return{database:{name:"chatHistoryDB",version:1},stores:{sessions:{name:"sessions",options:{keyPath:"sessionId",autoIncrement:!1},indexes:[{name:"updateTime",keyPath:"updateTime",options:{unique:!1}},{name:"title",keyPath:"title",options:{unique:!1}}]},conversations:{name:"conversations",options:{keyPath:"sessionId",autoIncrement:!1}}},ai:{system:`
          You are a friendly AI assistant. Follow the user's vibe, and if needed, do role play.
          Your responses should be helpful, informative, and engaging.
          You can use markdown to format your responses.
          The current date and time is: ${new Date().toLocaleString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"long"})}.
        `,options:{}},...e}}};var V=class{constructor(e,t=1,s){this.dbName=e,this.version=t,this.upgradeCallback=s,this.db=null,this.openPromise=null}async open(){return this.db?this.db:this.openPromise?this.openPromise:(this.openPromise=new Promise((e,t)=>{let s=indexedDB.open(this.dbName,this.version);s.onupgradeneeded=r=>{this.db=r.target.result,this.upgradeCallback&&this.upgradeCallback(this.db,r.oldVersion,r.newVersion)},s.onsuccess=r=>{this.db=r.target.result,e(this.db),this.openPromise=null},s.onerror=r=>{t(new Error(`Error opening database: ${r.target.error.message}`)),this.openPromise=null}}),this.openPromise)}async transaction(e,t="readonly"){return(await this.open()).transaction(e,t)}async store(e,t="readonly"){return(await this.transaction(e,t)).objectStore(e)}async add(e,t,s){try{let r=await this.store(e,"readwrite");return await this.request(r.add(t,s))}catch(r){throw new Error(`Add operation failed: ${r.message}`)}}async get(e,t,s){try{let r=await this.store(e),i=s!==void 0?r.index(t).get(s):r.get(t);return await this.request(i)}catch(r){throw new Error(`Get operation failed: ${r.message}`)}}async getAll(e,t){try{let s=await this.store(e),r=[];return new Promise((i,a)=>{let o=t?s.openCursor(t):s.openCursor();o.onsuccess=l=>{let c=l.target.result;c?(r.push(c.value),c.continue()):i(r)},o.onerror=l=>a(new Error(`GetAll operation failed: ${l.target.error.message}`))})}catch(s){throw new Error(`GetAll operation failed: ${s.message}`)}}async forEach(e,t,s){try{let r=await this.store(e);return new Promise((i,a)=>{let o=t?r.openCursor(t):r.openCursor();o.onsuccess=async l=>{let c=l.target.result;c?(await s(c.value,c),c.continue()):i()},o.onerror=l=>a(new Error(`ForEach operation failed: ${l.target.error.message}`))})}catch(r){throw new Error(`ForEach operation failed: ${r.message}`)}}async put(e,t,s){try{let r=await this.store(e,"readwrite");return await this.request(r.put(t,s))}catch(r){throw new Error(`Put operation failed: ${r.message}`)}}async delete(e,t){try{let s=await this.store(e,"readwrite");return await this.request(s.delete(t))}catch(s){throw new Error(`Delete operation failed: ${s.message}`)}}async clear(e){try{let t=await this.store(e,"readwrite");return await this.request(t.clear())}catch(t){throw new Error(`Clear operation failed: ${t.message}`)}}close(){this.db&&(this.db.close(),this.db=null,this.openPromise=null)}async deleteDatabase(){return this.close(),new Promise((e,t)=>{let s=indexedDB.deleteDatabase(this.dbName);s.onsuccess=e,s.onerror=r=>t(new Error(`DeleteDatabase operation failed: ${r.target.error.message}`))})}request(e){return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=r=>s(new Error(r.target.error.message))})}};var W=class{constructor(e){this.config=e,this.db=new V(e.database.name,e.database.version,this.upgradeDatabase.bind(this))}upgradeDatabase(e,t,s){console.log(`Upgrading database from version ${t} to ${s}...`);let{stores:r}=this.config;Object.values(r).forEach(i=>{let{name:a,options:o,indexes:l}=i;if(!e.objectStoreNames.contains(a)){let c=e.createObjectStore(a,o);l?.forEach(({name:h,keyPath:u,options:b})=>{c.createIndex(h,u,b)}),console.log(`Created store: ${a}`)}})}async initialize(){try{return await this.db.open(),localStorage.setItem("chatDB",!0),console.log("Database initialized successfully!"),!0}catch(e){return localStorage.setItem("chatDB",!1),console.error("Database initialization failed:",e),!1}}async addMessage(e,t){try{let s=await this.db.get(this.config.stores.conversations.name,e),r=await this.db.get(this.config.stores.sessions.name,e);s.messages.push(t),r.updateTime=Date.now(),await this.db.put(this.config.stores.conversations.name,s),await this.db.put(this.config.stores.sessions.name,r),console.log(`Message added successfully to conversation: ${e}`)}catch(s){console.error(`Error adding message to conversation: ${s.message}`)}}async getRecentItems(e,t=10,s){try{let r=await this.db.store(e),i=s?r.index(s):null;return new Promise((a,o)=>{let l=[],c=0,h=i?i.openCursor(null,"prev"):r.openCursor(null,"prev");h.onsuccess=u=>{let b=u.target.result;b&&c<t?(l.push(b.value),c++,b.continue()):a(l)},h.onerror=u=>{console.error("Error getting recent items:",u.target.error),o(u.target.error)}})}catch(r){throw console.error("Error in getRecentItems:",r),r}}async createNewSession(){try{let e=Number(localStorage.getItem("chatSessions"))||0;return e+=1,localStorage.setItem("chatSessions",e),await this.db.add(this.config.stores.conversations.name,{sessionId:e,messages:[]}),await this.db.add(this.config.stores.sessions.name,{sessionId:e,creationTime:Date.now(),title:`New Chat ${e}`,updateTime:Date.now()}),e}catch(e){return console.error("Error creating new session:",e),null}}async updateChatHistoryTitle(e,t){try{let s=await this.db.get(this.config.stores.sessions.name,e);s.title=t,await this.db.put(this.config.stores.sessions.name,s),console.log(`History item updated: ${t}`)}catch(s){console.error("Error updating chat history title:",s)}}};var K=class{constructor(e,t={}){this.root=e,this.uiOptions={sidebarTogglers:".sidebar-toggler",textarea:"#chat-massage",sendButton:"#chat-send-button",newChatButton:"#new-chat-button",chatHistoryContainer:"#chat-history-container",contentScrollContainer:"#content-scroll-container",contentContainer:"#content-container",modelMenu:"#model-menu",sidebarStateName:"chat-sidebar-open",backdrop:".chat-backdrop",...t},this.initWindowControls(),this.initializeElements(),this.registerEventListeners(),this.editMode=null}initializeElements(){this.sidebarTogglers=this.root.querySelectorAll(this.uiOptions.sidebarTogglers),this.textarea=this.root.querySelector(this.uiOptions.textarea),this.sendButton=this.root.querySelector(this.uiOptions.sendButton),this.newChatButton=this.root.querySelector(this.uiOptions.newChatButton),this.chatHistoryContainer=this.root.querySelector(this.uiOptions.chatHistoryContainer),this.contentScrollContainer=this.root.querySelector(this.uiOptions.contentScrollContainer),this.contentContainer=this.root.querySelector(this.uiOptions.contentContainer),this.modelMenu=this.root.querySelector(this.uiOptions.modelMenu)}registerEventListeners(){this.sidebarTogglers.forEach(t=>{t.addEventListener("click",()=>{try{this.toggleSidebar()}catch(s){console.error("Error toggling sidebar:",s)}})}),localStorage.getItem(this.uiOptions.sidebarStateName)==="true"&&this.root.classList.add("sidebar-open"),document.addEventListener("keydown",t=>{if(t.key==="Escape"&&this.root.classList.contains("sidebar-open"))try{this.toggleSidebar()}catch(s){console.error("Error handling Escape key:",s)}}),this.sendButton.addEventListener("click",async t=>{let s=new CustomEvent("send-message",{bubbles:!0,cancelable:!0,composed:!1});this.root.dispatchEvent(s)}),this.textarea.addEventListener("keydown",t=>{if(t.key==="Enter"&&!t.shiftKey){t.preventDefault();let s=new CustomEvent("send-message",{bubbles:!0,cancelable:!0,composed:!1});this.root.dispatchEvent(s)}}),this.chatHistoryContainer.addEventListener("click",t=>{try{this.displayChatHistory(t.target)}catch(s){console.error("Error showing chat history:",s)}}),this.newChatButton.addEventListener("click",()=>{let t=new CustomEvent("new-chat",{bubbles:!0,cancelable:!0,composed:!1});this.root.dispatchEvent(t)}),this.modelMenu.addEventListener("click",t=>{this.selectModel(t.target)}),document.addEventListener("DOMContentLoaded",()=>{this.root.classList.add("loaded")}),this.contentContainer.addEventListener("click",t=>{let s=t.target.closest(".action__button.edit");if(s){let r=s.closest(".chat__block");this.enableEditMode(r)}})}toggleSidebar(){try{let e=this.root.classList.toggle("sidebar-open");localStorage.setItem(this.uiOptions.sidebarStateName,e);let t=this.root.querySelector(this.uiOptions.backdrop);!t&&e&&(t=document.createElement("backdrop"),t.classList.add("chat-backdrop"),t.addEventListener("click",()=>this.toggleSidebar()),this.root.appendChild(t)),t&&t.classList.toggle("open")}catch(e){console.error("Error in toggleSidebar:",e)}}updateNetworkStatus(){this.root.classList.toggle("offline",!navigator.onLine)}sanitizeInput(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}renderMessage(e,t){let s=t==="user"?this.sanitizeInput(e):e,r=this.generateMessageBlock(s,t);this.contentContainer.insertAdjacentHTML("beforeend",r)}addChatHistoryItem(e,t,s="beforeend"){this.chatHistoryContainer.insertAdjacentHTML(s,`<button class="item" data-session-id="${t}">${e}</button>`)}generateMessageBlock(e,t){switch(t){case"user":return`<div class="chat__block user" data-role="${t}">
                  <div class="actions__wrapper">
                    <button class="action__button edit" title="Edit message">
                      <svg class="icon">
                        <use href="#edit-icon" />
                      </svg>
                    </button>
                  </div>
                  <span class="message">${e}</span>
                </div>`;case"assistant":return`<div class="chat__block assistant" data-role="${t}">
                  <svg class="icon assistant__logo">
                    <use href="#stars-icon" />
                  </svg>
                  <div class="response_wrapper">
                    <div class="response">
                      ${e}
                    </div>
                    <div class="actions__wrapper">
                      <button class="action__button copy" title="Copy message">
                        <svg class="icon">
                          <use href="#copy-icon" />
                        </svg>
                      </button>
                      <button class="action__button repeat" title="Regenerate response">
                        <svg class="icon">
                          <use href="#repeat-icon" />
                        </svg>
                      </button>
                      <button class="action__button like" title="Good response">
                        <svg class="icon">
                          <use href="#like-icon" />
                        </svg>
                      </button>
                      <button class="action__button dislike" title="Bad response">
                        <svg class="icon">
                          <use href="#dislike-icon" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>`;case"system":return`<div class="chat__block system">
                  ${e} 
                </div>`;default:return""}}scrollToBottom(){this.contentScrollContainer.scrollTo({top:this.contentScrollContainer.scrollHeight,behavior:"smooth"})}enableEditMode(e){if(this.editMode)return;let t=e.querySelector(".message"),s=t.textContent,r=`
      <div class="edit__wrapper">
        <textarea class="edit-textarea">${s}</textarea>
        <div class="edit__actions">
          <button class="dark r save-edit">Save</button>
          <button class="r cancel-edit">Cancel</button>
        </div> 
      </div>
    `;e.classList.add("editing"),e.insertAdjacentHTML("beforeend",r);let i=e.querySelector(".edit-textarea");i.focus(),this.editMode={block:e,messageSpan:t,original:s,textarea:i},e.querySelector(".save-edit").addEventListener("click",()=>this.saveEdit()),e.querySelector(".cancel-edit").addEventListener("click",()=>this.cancelEdit()),i.addEventListener("keydown",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),this.saveEdit()),a.key==="Escape"&&this.cancelEdit()})}saveEdit(){if(!this.editMode)return;let e=this.editMode.textarea.value.trim();e&&e!==this.editMode.original&&(this.editMode.messageSpan.textContent=e),this.exitEditMode()}cancelEdit(){this.editMode&&this.exitEditMode()}exitEditMode(){if(!this.editMode)return;this.editMode.block.classList.remove("editing");let e=this.editMode.block.querySelector(".edit__wrapper");e&&e.remove(),this.editMode=null}displayChatHistory(e){let t=e.getAttribute("data-session-id");if(!t)return;let s=new CustomEvent("display-chat",{detail:{sessionId:t},bubbles:!0,cancelable:!0,composed:!1});this.root.dispatchEvent(s)}selectModel(e){try{let t=e.getAttribute("data-model");if(!t)return;localStorage.setItem("selectedModel",t),this.modelMenu.querySelectorAll(".model").forEach(r=>{r.classList.remove("active")}),this.modelMenu.querySelector(`[data-model="${t}"]`)?.classList.add("active");let s=new CustomEvent("model-selected",{detail:{model:t},bubbles:!0,cancelable:!0,composed:!1});this.root.dispatchEvent(s)}catch(t){console.error("Error selecting model:",t)}}populateModelMenu(e){e.forEach(t=>{let[s,r]=t.name.split(":");this.modelMenu.insertAdjacentHTML("beforeend",`
        <button class="model" data-model="${t.name}">
          <span class="name">${s}</span>
          <span class="info">${r||""}</span>
        </button>
      `)})}setActiveModel(e){this.modelMenu.querySelector(`[data-model="${e}"]`)?.classList.add("active")}clearChatHistory(){this.contentContainer.innerHTML=""}addSystemMessage(e){this.renderMessage(e,"system")}initWindowControls(){if("windowControlsOverlay"in navigator){let e=t=>{try{let s=navigator.windowControlsOverlay.visible,{x:r,y:i,width:a,height:o}=t?.titlebarAreaRect||navigator.windowControlsOverlay.getTitlebarAreaRect();this.root.style.setProperty("--title-bar-height",`${o}px`),this.root.style.setProperty("--title-bar-width",`${a}px`),this.root.style.setProperty("--title-bar-x",`${r}px`),this.root.style.setProperty("--title-bar-y",`${i}px`),this.root.classList.toggle("overlay-visible",s)}catch(s){console.error("Error updating titlebar area:",s)}};navigator.windowControlsOverlay.addEventListener("geometrychange",e),e()}}};var x=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},k={searchParams:"URLSearchParams"in x,iterable:"Symbol"in x&&"iterator"in Symbol,blob:"FileReader"in x&&"Blob"in x&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in x,arrayBuffer:"ArrayBuffer"in x};function Cs(n){return n&&DataView.prototype.isPrototypeOf(n)}k.arrayBuffer&&(qe=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ze=ArrayBuffer.isView||function(n){return n&&qe.indexOf(Object.prototype.toString.call(n))>-1});var qe,Ze;function M(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function ce(n){return typeof n!="string"&&(n=String(n)),n}function he(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return k.iterable&&(e[Symbol.iterator]=function(){return e}),e}function w(n){this.map={},n instanceof w?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}w.prototype.append=function(n,e){n=M(n),e=ce(e);var t=this.map[n];this.map[n]=t?t+", "+e:e};w.prototype.delete=function(n){delete this.map[M(n)]};w.prototype.get=function(n){return n=M(n),this.has(n)?this.map[n]:null};w.prototype.has=function(n){return this.map.hasOwnProperty(M(n))};w.prototype.set=function(n,e){this.map[M(n)]=ce(e)};w.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)};w.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),he(n)};w.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),he(n)};w.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),he(n)};k.iterable&&(w.prototype[Symbol.iterator]=w.prototype.entries);function ae(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function Ye(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Ls(n){var e=new FileReader,t=Ye(e);return e.readAsArrayBuffer(n),t}function Os(n){var e=new FileReader,t=Ye(e),s=/charset=([A-Za-z0-9_-]+)/.exec(n.type),r=s?s[1]:"utf-8";return e.readAsText(n,r),t}function $s(n){for(var e=new Uint8Array(n),t=new Array(e.length),s=0;s<e.length;s++)t[s]=String.fromCharCode(e[s]);return t.join("")}function Ge(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function Xe(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:k.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:k.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:k.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():k.arrayBuffer&&k.blob&&Cs(n)?(this._bodyArrayBuffer=Ge(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):k.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||Ze(n))?this._bodyArrayBuffer=Ge(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):k.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},k.blob&&(this.blob=function(){var n=ae(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=ae(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(k.blob)return this.blob().then(Ls);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=ae(this);if(n)return n;if(this._bodyBlob)return Os(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($s(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},k.formData&&(this.formData=function(){return this.text().then(Ps)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ns=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function _s(n){var e=n.toUpperCase();return Ns.indexOf(e)>-1?e:n}function O(n,e){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof O){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new w(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new w(e.headers)),this.method=_s(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in x){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+new Date().getTime());else{var r=/\?/;this.url+=(r.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}O.prototype.clone=function(){return new O(this,{body:this._bodyInit})};function Ps(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var s=t.split("="),r=s.shift().replace(/\+/g," "),i=s.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function Ds(n){var e=new w,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(s){return s.indexOf(`
`)===0?s.substr(1,s.length):s}).forEach(function(s){var r=s.split(":"),i=r.shift().trim();if(i){var a=r.join(":").trim();try{e.append(i,a)}catch(o){console.warn("Response "+o.message)}}}),e}Xe.call(O.prototype);function I(n,e){if(!(this instanceof I))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new w(e.headers),this.url=e.url||"",this._initBody(n)}Xe.call(I.prototype);I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new w(this.headers),url:this.url})};I.error=function(){var n=new I(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var Bs=[301,302,303,307,308];I.redirect=function(n,e){if(Bs.indexOf(e)===-1)throw new RangeError("Invalid status code");return new I(null,{status:e,headers:{location:n}})};var L=x.DOMException;try{new L}catch{L=function(e,t){this.message=e,this.name=t;var s=Error(e);this.stack=s.stack},L.prototype=Object.create(Error.prototype),L.prototype.constructor=L}function Ve(n,e){return new Promise(function(t,s){var r=new O(n,e);if(r.signal&&r.signal.aborted)return s(new L("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var c={statusText:i.statusText,headers:Ds(i.getAllResponseHeaders()||"")};r.url.indexOf("file://")===0&&(i.status<200||i.status>599)?c.status=200:c.status=i.status,c.url="responseURL"in i?i.responseURL:c.headers.get("X-Request-URL");var h="response"in i?i.response:i.responseText;setTimeout(function(){t(new I(h,c))},0)},i.onerror=function(){setTimeout(function(){s(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){s(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){s(new L("Aborted","AbortError"))},0)};function o(c){try{return c===""&&x.location.href?x.location.href:c}catch{return c}}if(i.open(r.method,o(r.url),!0),r.credentials==="include"?i.withCredentials=!0:r.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(k.blob?i.responseType="blob":k.arrayBuffer&&(i.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof w||x.Headers&&e.headers instanceof x.Headers)){var l=[];Object.getOwnPropertyNames(e.headers).forEach(function(c){l.push(M(c)),i.setRequestHeader(c,ce(e.headers[c]))}),r.headers.forEach(function(c,h){l.indexOf(h)===-1&&i.setRequestHeader(h,c)})}else r.headers.forEach(function(c,h){i.setRequestHeader(h,c)});r.signal&&(r.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&r.signal.removeEventListener("abort",a)}),i.send(typeof r._bodyInit>"u"?null:r._bodyInit)})}Ve.polyfill=!0;x.fetch||(x.fetch=Ve,x.Headers=w,x.Request=O,x.Response=I);var Ms="0.5.12",zs=Object.defineProperty,Us=(n,e,t)=>e in n?zs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,oe=(n,e,t)=>(Us(n,typeof e!="symbol"?e+"":e,t),t),Hs=class We extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,We)}},Fs=class{constructor(n,e,t){oe(this,"abortController"),oe(this,"itr"),oe(this,"doneCallback"),this.abortController=n,this.itr=e,this.doneCallback=t}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let n of this.itr){if("error"in n)throw new Error(n.error);if(yield n,n.done||n.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},ue=async n=>{if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if(n.headers.get("content-type")?.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new Hs(e,n.status)};function qs(){return typeof window<"u"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process<"u"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var pe=async(n,e,t={})=>{let s={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Ms} (${qs()})`};t.headers||(t.headers={});let r=Object.fromEntries(Object.entries(t.headers).filter(([i])=>!Object.keys(s).some(a=>a.toLowerCase()===i.toLowerCase())));return t.headers={...s,...r},n(e,t)},je=async(n,e,t)=>{let s=await pe(n,e,{headers:t?.headers});return await ue(s),s},B=async(n,e,t,s)=>{let i=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,a=await pe(n,e,{method:"POST",body:i,signal:s?.signal,headers:s?.headers});return await ue(a),a},Gs=async(n,e,t,s)=>{let r=await pe(n,e,{method:"DELETE",body:JSON.stringify(t),headers:s?.headers});return await ue(r),r},js=async function*(n){let e=new TextDecoder("utf-8"),t="",s=n.getReader();for(;;){let{done:r,value:i}=await s.read();if(r)break;t+=e.decode(i);let a=t.split(`
`);t=a.pop()??"";for(let o of a)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(let r of t.split(`
`).filter(i=>i!==""))try{yield JSON.parse(r)}catch{console.warn("invalid json: ",r)}},Zs=n=>{if(!n)return"http://127.0.0.1:11434";let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),s=t.port;s||(e?s=t.protocol==="https:"?"443":"80":s="11434");let r=`${t.protocol}//${t.hostname}:${s}${t.pathname}`;return r.endsWith("/")&&(r=r.slice(0,-1)),r},Ys=Object.defineProperty,Xs=(n,e,t)=>e in n?Ys(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,le=(n,e,t)=>(Xs(n,typeof e!="symbol"?e+"":e,t),t),Q=class{constructor(e){le(this,"config"),le(this,"fetch"),le(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=Zs(e?.host??"http://127.0.0.1:11434")),this.fetch=e?.fetch??fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;let s=`${this.config.host}/api/${e}`;if(t.stream){let i=new AbortController,a=await B(this.fetch,s,t,{signal:i.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");let o=js(a.body),l=new Fs(i,o,()=>{let c=this.ongoingStreamedRequests.indexOf(l);c>-1&&this.ongoingStreamedRequests.splice(c,1)});return this.ongoingStreamedRequests.push(l),l}return await(await B(this.fetch,s,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),s="",r=t.byteLength;for(let i=0;i<r;i++)s+=String.fromCharCode(t[i]);return btoa(s)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await Gs(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await B(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await je(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await B(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await B(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await B(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await je(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}};function ge(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var N=ge();function st(n){N=n}var j={exec:()=>null};function g(n,e=""){let t=typeof n=="string"?n:n.source,s={replace:(r,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(T.caret,"$1"),t=t.replace(r,a),s},getRegex:()=>new RegExp(t,e)};return s}var T={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},Vs=/^(?:[ \t]*(?:\n|$))+/,Ws=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ks=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Y=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Qs=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,rt=/(?:[*+-]|\d{1,9}[.)])/,nt=g(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,rt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),me=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Js=/^[^\n]+/,be=/(?!\s*\])(?:\\.|[^\[\]\\])+/,er=g(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",be).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),tr=g(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,rt).getRegex(),te="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ye=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,sr=g("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ye).replace("tag",te).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),it=g(me).replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex(),rr=g(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",it).getRegex(),we={blockquote:rr,code:Ws,def:er,fences:Ks,heading:Qs,hr:Y,html:sr,lheading:nt,list:tr,newline:Vs,paragraph:it,table:j,text:Js},Ke=g("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex(),nr={...we,table:Ke,paragraph:g(me).replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ke).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex()},ir={...we,html:g(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ye).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:j,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:g(me).replace("hr",Y).replace("heading",` *#{1,6} *[^
]`).replace("lheading",nt).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ar=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,or=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,at=/^( {2,}|\\)\n(?!\s*$)/,lr=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,se=/[\p{P}\p{S}]/u,xe=/[\s\p{P}\p{S}]/u,ot=/[^\s\p{P}\p{S}]/u,cr=g(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,xe).getRegex(),lt=/(?!~)[\p{P}\p{S}]/u,hr=/(?!~)[\s\p{P}\p{S}]/u,ur=/(?:[^\s\p{P}\p{S}]|~)/u,pr=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,ct=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,dr=g(ct,"u").replace(/punct/g,se).getRegex(),fr=g(ct,"u").replace(/punct/g,lt).getRegex(),ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",gr=g(ht,"gu").replace(/notPunctSpace/g,ot).replace(/punctSpace/g,xe).replace(/punct/g,se).getRegex(),mr=g(ht,"gu").replace(/notPunctSpace/g,ur).replace(/punctSpace/g,hr).replace(/punct/g,lt).getRegex(),br=g("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ot).replace(/punctSpace/g,xe).replace(/punct/g,se).getRegex(),yr=g(/\\(punct)/,"gu").replace(/punct/g,se).getRegex(),wr=g(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),xr=g(ye).replace("(?:-->|$)","-->").getRegex(),Er=g("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",xr).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ee=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,kr=g(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",ee).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ut=g(/^!?\[(label)\]\[(ref)\]/).replace("label",ee).replace("ref",be).getRegex(),pt=g(/^!?\[(ref)\](?:\[\])?/).replace("ref",be).getRegex(),Tr=g("reflink|nolink(?!\\()","g").replace("reflink",ut).replace("nolink",pt).getRegex(),Ee={_backpedal:j,anyPunctuation:yr,autolink:wr,blockSkip:pr,br:at,code:or,del:j,emStrongLDelim:dr,emStrongRDelimAst:gr,emStrongRDelimUnd:br,escape:ar,link:kr,nolink:pt,punctuation:cr,reflink:ut,reflinkSearch:Tr,tag:Er,text:lr,url:j},Sr={...Ee,link:g(/^!?\[(label)\]\((.*?)\)/).replace("label",ee).getRegex(),reflink:g(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ee).getRegex()},de={...Ee,emStrongRDelimAst:mr,emStrongLDelim:fr,url:g(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Ar={...de,br:g(at).replace("{2,}","*").getRegex(),text:g(de.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},J={normal:we,gfm:nr,pedantic:ir},q={normal:Ee,gfm:de,breaks:Ar,pedantic:Sr},Rr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Qe=n=>Rr[n];function v(n,e){if(e){if(T.escapeTest.test(n))return n.replace(T.escapeReplace,Qe)}else if(T.escapeTestNoEncode.test(n))return n.replace(T.escapeReplaceNoEncode,Qe);return n}function Je(n){try{n=encodeURI(n).replace(T.percentDecode,"%")}catch{return null}return n}function et(n,e){let t=n.replace(T.findPipe,(i,a,o)=>{let l=!1,c=a;for(;--c>=0&&o[c]==="\\";)l=!l;return l?"|":" |"}),s=t.split(T.splitPipe),r=0;if(s[0].trim()||s.shift(),s.length>0&&!s.at(-1)?.trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;r<s.length;r++)s[r]=s[r].trim().replace(T.slashPipe,"|");return s}function G(n,e,t){let s=n.length;if(s===0)return"";let r=0;for(;r<s&&n.charAt(s-r-1)===e;)r++;return n.slice(0,s-r)}function Ir(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<n.length;s++)if(n[s]==="\\")s++;else if(n[s]===e[0])t++;else if(n[s]===e[1]&&(t--,t<0))return s;return-1}function tt(n,e,t,s,r){let i=e.href,a=e.title||null,o=n[1].replace(r.other.outputLinkReplace,"$1");if(n[0].charAt(0)!=="!"){s.state.inLink=!0;let l={type:"link",raw:t,href:i,title:a,text:o,tokens:s.inlineTokens(o)};return s.state.inLink=!1,l}return{type:"image",raw:t,href:i,title:a,text:o}}function vr(n,e,t){let s=n.match(t.other.indentCodeCompensation);if(s===null)return e;let r=s[1];return e.split(`
`).map(i=>{let a=i.match(t.other.beginningSpace);if(a===null)return i;let[o]=a;return o.length>=r.length?i.slice(r.length):i}).join(`
`)}var U=class{options;rules;lexer;constructor(e){this.options=e||N}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:G(s,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let s=t[0],r=vr(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){let r=G(s,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(s=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:G(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let s=G(t[0],`
`).split(`
`),r="",i="",a=[];for(;s.length>0;){let o=!1,l=[],c;for(c=0;c<s.length;c++)if(this.rules.other.blockquoteStart.test(s[c]))l.push(s[c]),o=!0;else if(!o)l.push(s[c]);else break;s=s.slice(c);let h=l.join(`
`),u=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${h}`:h,i=i?`${i}
${u}`:u;let b=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,a,!0),this.lexer.state.top=b,s.length===0)break;let m=a.at(-1);if(m?.type==="code")break;if(m?.type==="blockquote"){let E=m,y=E.raw+`
`+s.join(`
`),S=this.blockquote(y);a[a.length-1]=S,r=r.substring(0,r.length-E.raw.length)+S.raw,i=i.substring(0,i.length-E.text.length)+S.text;break}else if(m?.type==="list"){let E=m,y=E.raw+`
`+s.join(`
`),S=this.list(y);a[a.length-1]=S,r=r.substring(0,r.length-m.raw.length)+S.raw,i=i.substring(0,i.length-E.raw.length)+S.raw,s=y.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:a,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim(),r=s.length>1,i={type:"list",raw:"",ordered:r,start:r?+s.slice(0,-1):"",loose:!1,items:[]};s=r?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=r?s:"[*+-]");let a=this.rules.other.listItemRegex(s),o=!1;for(;e;){let c=!1,h="",u="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;h=t[0],e=e.substring(h.length);let b=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,ne=>" ".repeat(3*ne.length)),m=e.split(`
`,1)[0],E=!b.trim(),y=0;if(this.options.pedantic?(y=2,u=b.trimStart()):E?y=t[1].length+1:(y=t[2].search(this.rules.other.nonSpaceChar),y=y>4?1:y,u=b.slice(y),y+=t[1].length),E&&this.rules.other.blankLine.test(m)&&(h+=m+`
`,e=e.substring(m.length+1),c=!0),!c){let ne=this.rules.other.nextBulletRegex(y),ze=this.rules.other.hrRegex(y),Ue=this.rules.other.fencesBeginRegex(y),He=this.rules.other.headingBeginRegex(y),Is=this.rules.other.htmlBeginRegex(y);for(;e;){let ie=e.split(`
`,1)[0],F;if(m=ie,this.options.pedantic?(m=m.replace(this.rules.other.listReplaceNesting,"  "),F=m):F=m.replace(this.rules.other.tabCharGlobal,"    "),Ue.test(m)||He.test(m)||Is.test(m)||ne.test(m)||ze.test(m))break;if(F.search(this.rules.other.nonSpaceChar)>=y||!m.trim())u+=`
`+F.slice(y);else{if(E||b.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Ue.test(b)||He.test(b)||ze.test(b))break;u+=`
`+m}!E&&!m.trim()&&(E=!0),h+=ie+`
`,e=e.substring(ie.length+1),b=F.slice(y)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(h)&&(o=!0));let S=null,Me;this.options.gfm&&(S=this.rules.other.listIsTask.exec(u),S&&(Me=S[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:h,task:!!S,checked:Me,loose:!1,text:u,tokens:[]}),i.raw+=h}let l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let h=i.items[c].tokens.filter(b=>b.type==="space"),u=h.length>0&&h.some(b=>this.rules.other.anyLine.test(b.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:r,title:i}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let s=et(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?a.align.push("right"):this.rules.other.tableAlignCenter.test(o)?a.align.push("center"):this.rules.other.tableAlignLeft.test(o)?a.align.push("left"):a.align.push(null);for(let o=0;o<s.length;o++)a.header.push({text:s[o],tokens:this.lexer.inline(s[o]),header:!0,align:a.align[o]});for(let o of i)a.rows.push(et(o,a.header.length).map((l,c)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:a.align[c]})));return a}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;let a=G(s.slice(0,-1),"\\");if((s.length-a.length)%2===0)return}else{let a=Ir(t[2],"()");if(a>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){let a=this.rules.other.pedanticHrefTitle.exec(r);a&&(r=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?r=r.slice(1):r=r.slice(1,-1)),tt(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){let r=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[r.toLowerCase()];if(!i){let a=s[0].charAt(0);return{type:"text",raw:a,text:a}}return tt(s,i,s[0],this.lexer,this.rules)}}emStrong(e,t,s=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!r||r[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(r[1]||r[2]||"")||!s||this.rules.inline.punctuation.exec(s)){let a=[...r[0]].length-1,o,l,c=a,h=0,u=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,t=t.slice(-1*e.length+a);(r=u.exec(t))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(l=[...o].length,r[3]||r[4]){c+=l;continue}else if((r[5]||r[6])&&a%3&&!((a+l)%3)){h+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+h);let b=[...r[0]][0].length,m=e.slice(0,a+r.index+b+l);if(Math.min(a,l)%2){let y=m.slice(1,-1);return{type:"em",raw:m,text:y,tokens:this.lexer.inlineTokens(y)}}let E=m.slice(2,-2);return{type:"strong",raw:m,text:E,tokens:this.lexer.inlineTokens(E)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(s),i=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return r&&i&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let s,r;return t[2]==="@"?(s=t[1],r="mailto:"+s):(s=t[1],r=s),{type:"link",raw:t[0],text:s,href:r,tokens:[{type:"text",raw:s,text:s}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let s,r;if(t[2]==="@")s=t[0],r="mailto:"+s;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);s=t[0],t[1]==="www."?r="http://"+t[0]:r=t[0]}return{type:"link",raw:t[0],text:s,href:r,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}},A=class n{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||N,this.options.tokenizer=this.options.tokenizer||new U,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:T,block:J.normal,inline:q.normal};this.options.pedantic?(t.block=J.pedantic,t.inline=q.pedantic):this.options.gfm&&(t.block=J.gfm,this.options.breaks?t.inline=q.breaks:t.inline=q.gfm),this.tokenizer.rules=t}static get rules(){return{block:J,inline:q}}static lex(e,t){return new n(t).lex(e)}static lexInline(e,t){return new n(t).inlineTokens(e)}lex(e){e=e.replace(T.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){for(this.options.pedantic&&(e=e.replace(T.tabCharGlobal,"    ").replace(T.spaceLine,""));e;){let r;if(this.options.extensions?.block?.some(a=>(r=a.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);let a=t.at(-1);r.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.at(-1).src=a.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let i=e;if(this.options.extensions?.startBlock){let a=1/0,o=e.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},o),typeof l=="number"&&l>=0&&(a=Math.min(a,l))}),a<1/0&&a>=0&&(i=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(i))){let a=t.at(-1);s&&a?.type==="paragraph"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(r),s=i.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s=e,r=null;if(this.tokens.links){let o=Object.keys(this.tokens.links);if(o.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)o.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,r.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i=!1,a="";for(;e;){i||(a=""),i=!1;let o;if(this.options.extensions?.inline?.some(c=>(o=c.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.escape(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.tag(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.link(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(o.raw.length);let c=t.at(-1);o.type==="text"&&c?.type==="text"?(c.raw+=o.raw,c.text+=o.text):t.push(o);continue}if(o=this.tokenizer.emStrong(e,s,a)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.codespan(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.br(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.del(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.autolink(e)){e=e.substring(o.raw.length),t.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(e))){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if(this.options.extensions?.startInline){let c=1/0,h=e.slice(1),u;this.options.extensions.startInline.forEach(b=>{u=b.call({lexer:this},h),typeof u=="number"&&u>=0&&(c=Math.min(c,u))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(o=this.tokenizer.inlineText(l)){e=e.substring(o.raw.length),o.raw.slice(-1)!=="_"&&(a=o.raw.slice(-1)),i=!0;let c=t.at(-1);c?.type==="text"?(c.raw+=o.raw,c.text+=o.text):t.push(o);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}},H=class{options;parser;constructor(e){this.options=e||N}space(e){return""}code({text:e,lang:t,escaped:s}){let r=(t||"").match(T.notSpaceStart)?.[0],i=e.replace(T.endingNewline,"")+`
`;return r?'<div data-code-lang="'+v(r)+'">'+(s?i:v(i,!0))+"</div>":"<pre><code>"+(s?i:v(i,!0))+"</code></pre>"}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,s=e.start,r="";for(let o=0;o<e.items.length;o++){let l=e.items[o];r+=this.listitem(l)}let i=t?"ol":"ul",a=t&&s!==1?' start="'+s+'"':"";return"<"+i+a+`>
`+r+"</"+i+`>
`}listitem(e){let t="";if(e.task){let s=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+v(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let i=0;i<e.header.length;i++)s+=this.tablecell(e.header[i]);t+=this.tablerow({text:s});let r="";for(let i=0;i<e.rows.length;i++){let a=e.rows[i];s="";for(let o=0;o<a.length;o++)s+=this.tablecell(a[o]);r+=this.tablerow({text:s})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${v(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){let r=this.parser.parseInline(s),i=Je(e);if(i===null)return r;e=i;let a='<a href="'+e+'"';return t&&(a+=' title="'+v(t)+'"'),a+=">"+r+"</a>",a}image({href:e,title:t,text:s}){let r=Je(e);if(r===null)return v(s);e=r;let i=`<img src="${e}" alt="${s}"`;return t&&(i+=` title="${v(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:v(e.text)}},Z=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},R=class n{options;renderer;textRenderer;constructor(e){this.options=e||N,this.options.renderer=this.options.renderer||new H,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Z}static parse(e,t){return new n(t).parse(e)}static parseInline(e,t){return new n(t).parseInline(e)}parse(e,t=!0){let s="";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions?.renderers?.[i.type]){let o=i,l=this.options.extensions.renderers[o.type].call({parser:this},o);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){s+=l||"";continue}}let a=i;switch(a.type){case"space":{s+=this.renderer.space(a);continue}case"hr":{s+=this.renderer.hr(a);continue}case"heading":{s+=this.renderer.heading(a);continue}case"code":{s+=this.renderer.code(a);continue}case"table":{s+=this.renderer.table(a);continue}case"blockquote":{s+=this.renderer.blockquote(a);continue}case"list":{s+=this.renderer.list(a);continue}case"html":{s+=this.renderer.html(a);continue}case"paragraph":{s+=this.renderer.paragraph(a);continue}case"text":{let o=a,l=this.renderer.text(o);for(;r+1<e.length&&e[r+1].type==="text";)o=e[++r],l+=`
`+this.renderer.text(o);t?s+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):s+=l;continue}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return s}parseInline(e,t=this.renderer){let s="";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions?.renderers?.[i.type]){let o=this.options.extensions.renderers[i.type].call({parser:this},i);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){s+=o||"";continue}}let a=i;switch(a.type){case"escape":{s+=t.text(a);break}case"html":{s+=t.html(a);break}case"link":{s+=t.link(a);break}case"image":{s+=t.image(a);break}case"strong":{s+=t.strong(a);break}case"em":{s+=t.em(a);break}case"codespan":{s+=t.codespan(a);break}case"br":{s+=t.br(a);break}case"del":{s+=t.del(a);break}case"text":{s+=t.text(a);break}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return s}},z=class{options;block;constructor(e){this.options=e||N}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?A.lex:A.lexInline}provideParser(){return this.block?R.parse:R.parseInline}},fe=class{defaults=ge();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=R;Renderer=H;TextRenderer=Z;Lexer=A;Tokenizer=U;Hooks=z;constructor(...e){this.use(...e)}walkTokens(e,t){let s=[];for(let r of e)switch(s=s.concat(t.call(this,r)),r.type){case"table":{let i=r;for(let a of i.header)s=s.concat(this.walkTokens(a.tokens,t));for(let a of i.rows)for(let o of a)s=s.concat(this.walkTokens(o.tokens,t));break}case"list":{let i=r;s=s.concat(this.walkTokens(i.items,t));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(a=>{let o=i[a].flat(1/0);s=s.concat(this.walkTokens(o,t))}):i.tokens&&(s=s.concat(this.walkTokens(i.tokens,t)))}}return s}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{let r={...s};if(r.async=this.defaults.async||r.async||!1,s.extensions&&(s.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let a=t.renderers[i.name];a?t.renderers[i.name]=function(...o){let l=i.renderer.apply(this,o);return l===!1&&(l=a.apply(this,o)),l}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),r.extensions=t),s.renderer){let i=this.defaults.renderer||new H(this.defaults);for(let a in s.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;let o=a,l=s.renderer[o],c=i[o];i[o]=(...h)=>{let u=l.apply(i,h);return u===!1&&(u=c.apply(i,h)),u||""}}r.renderer=i}if(s.tokenizer){let i=this.defaults.tokenizer||new U(this.defaults);for(let a in s.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;let o=a,l=s.tokenizer[o],c=i[o];i[o]=(...h)=>{let u=l.apply(i,h);return u===!1&&(u=c.apply(i,h)),u}}r.tokenizer=i}if(s.hooks){let i=this.defaults.hooks||new z;for(let a in s.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;let o=a,l=s.hooks[o],c=i[o];z.passThroughHooks.has(a)?i[o]=h=>{if(this.defaults.async)return Promise.resolve(l.call(i,h)).then(b=>c.call(i,b));let u=l.call(i,h);return c.call(i,u)}:i[o]=(...h)=>{let u=l.apply(i,h);return u===!1&&(u=c.apply(i,h)),u}}r.hooks=i}if(s.walkTokens){let i=this.defaults.walkTokens,a=s.walkTokens;r.walkTokens=function(o){let l=[];return l.push(a.call(this,o)),i&&(l=l.concat(i.call(this,o))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return A.lex(e,t??this.defaults)}parser(e,t){return R.parse(e,t??this.defaults)}parseMarkdown(e){return(s,r)=>{let i={...r},a={...this.defaults,...i},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);let l=a.hooks?a.hooks.provideLexer():e?A.lex:A.lexInline,c=a.hooks?a.hooks.provideParser():e?R.parse:R.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(s):s).then(h=>l(h,a)).then(h=>a.hooks?a.hooks.processAllTokens(h):h).then(h=>a.walkTokens?Promise.all(this.walkTokens(h,a.walkTokens)).then(()=>h):h).then(h=>c(h,a)).then(h=>a.hooks?a.hooks.postprocess(h):h).catch(o);try{a.hooks&&(s=a.hooks.preprocess(s));let h=l(s,a);a.hooks&&(h=a.hooks.processAllTokens(h)),a.walkTokens&&this.walkTokens(h,a.walkTokens);let u=c(h,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(h){return o(h)}}}onError(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let r="<p>An error occurred:</p><pre>"+v(s.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(s);throw s}}},$=new fe;function f(n,e){return $.parse(n,e)}f.options=f.setOptions=function(n){return $.setOptions(n),f.defaults=$.defaults,st(f.defaults),f};f.getDefaults=ge;f.defaults=N;f.use=function(...n){return $.use(...n),f.defaults=$.defaults,st(f.defaults),f};f.walkTokens=function(n,e){return $.walkTokens(n,e)};f.parseInline=$.parseInline;f.Parser=R;f.parser=R.parse;f.Renderer=H;f.TextRenderer=Z;f.Lexer=A;f.lexer=A.lex;f.Tokenizer=U;f.Hooks=z;f.parse=f;var Rn=f.options,In=f.setOptions,vn=f.use,Cn=f.walkTokens,Ln=f.parseInline;var On=R.parse,$n=A.lex;var un=Fe({"./languages/assembly.js":()=>Promise.resolve().then(()=>(ft(),dt)),"./languages/bash.js":()=>Promise.resolve().then(()=>(Te(),mt)),"./languages/bf.js":()=>Promise.resolve().then(()=>(yt(),bt)),"./languages/c.js":()=>Promise.resolve().then(()=>(Ae(),wt)),"./languages/cpp.js":()=>Promise.resolve().then(()=>(Et(),xt)),"./languages/css.js":()=>Promise.resolve().then(()=>(Tt(),kt)),"./languages/csv.js":()=>Promise.resolve().then(()=>(At(),St)),"./languages/diff.js":()=>Promise.resolve().then(()=>(Ie(),Rt)),"./languages/docker.js":()=>Promise.resolve().then(()=>(vt(),It)),"./languages/git.js":()=>Promise.resolve().then(()=>(Lt(),Ct)),"./languages/go.js":()=>Promise.resolve().then(()=>($t(),Ot)),"./languages/html.js":()=>Promise.resolve().then(()=>(Dt(),Pt)),"./languages/http.js":()=>Promise.resolve().then(()=>(Mt(),Bt)),"./languages/ini.js":()=>Promise.resolve().then(()=>(Ut(),zt)),"./languages/java.js":()=>Promise.resolve().then(()=>(Ft(),Ht)),"./languages/javascript.js":()=>Promise.resolve().then(()=>(Oe(),qt)),"./languages/js_template_literals.js":()=>Promise.resolve().then(()=>(jt(),Gt)),"./languages/jsdoc.js":()=>Promise.resolve().then(()=>(Xt(),Yt)),"./languages/json.js":()=>Promise.resolve().then(()=>(Wt(),Vt)),"./languages/leanpub-md.js":()=>Promise.resolve().then(()=>(Jt(),Qt)),"./languages/log.js":()=>Promise.resolve().then(()=>(ts(),es)),"./languages/lua.js":()=>Promise.resolve().then(()=>(rs(),ss)),"./languages/make.js":()=>Promise.resolve().then(()=>(is(),ns)),"./languages/markdown.js":()=>Promise.resolve().then(()=>(Pe(),Kt)),"./languages/pl.js":()=>Promise.resolve().then(()=>(os(),as)),"./languages/plain.js":()=>Promise.resolve().then(()=>(cs(),ls)),"./languages/python.js":()=>Promise.resolve().then(()=>(us(),hs)),"./languages/regex.js":()=>Promise.resolve().then(()=>(ds(),ps)),"./languages/rust.js":()=>Promise.resolve().then(()=>(gs(),fs)),"./languages/sql.js":()=>Promise.resolve().then(()=>(bs(),ms)),"./languages/todo.js":()=>Promise.resolve().then(()=>(Ne(),Zt)),"./languages/toml.js":()=>Promise.resolve().then(()=>(ws(),ys)),"./languages/typescript.js":()=>Promise.resolve().then(()=>(Es(),xs)),"./languages/uri.js":()=>Promise.resolve().then(()=>(Ts(),ks)),"./languages/xml.js":()=>Promise.resolve().then(()=>(Ce(),_t)),"./languages/yaml.js":()=>Promise.resolve().then(()=>(As(),Ss))});var pn={num:{type:"num",match:/(\.e?|\b)\d(e-|[\d.oxa-fA-F_])*(\.|\b)/g},str:{type:"str",match:/(["'])(\\[^]|(?!\1)[^\r\n\\])*\1?/g},strDouble:{type:"str",match:/"((?!")[^\r\n\\]|\\[^])*"?/g}},dn=new Map,fn=(n="")=>{let e={"&":"&#38;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return n.replace(/[&<>"']/g,t=>e[t])},gn=(n,e)=>e?`<span class="${e}">${n}</span>`:n;async function Rs(n,e,t){try{let s;if(typeof e=="string"){if(s=dn.get(e),!s&&(s=await un(`./languages/${e}.js`),!s?.default))throw new Error(`Invalid language module for ${e}`)}else s=e;let r,i,a={},o,l=[],c=0,h=Array.isArray(s.sub)?[...s.sub]:Array.isArray(s.default)?[...s.default]:[];if(h.length===0){t(n);return}for(;c<n.length;){for(a.index=null,r=h.length;r-- >0;){if(i=h[r].expand?pn[h[r].expand]:h[r],l[r]===void 0||l[r].match.index<c){if(i.match.lastIndex=c,o=i.match.exec(n),o===null){h.splice(r,1),l.splice(r,1);continue}l[r]={match:o,lastIndex:i.match.lastIndex}}l[r].match[0]&&(l[r].match.index<=a.index||a.index===null)&&(a={part:i,index:l[r].match.index,match:l[r].match[0],end:l[r].lastIndex})}if(a.index===null)break;t(n.slice(c,a.index),s.type),c=a.end,a.part.sub?await Rs(a.match,typeof a.part.sub=="string"?a.part.sub:typeof a.part.sub=="function"?a.part.sub(a.match):a.part,t):t(a.match,a.part.type)}t(n.slice(c,n.length),s.type)}catch(s){console.error(`Tokenization error: ${s.message}`),t(n)}}async function mn(n,e,t=!0,s={}){let r="";return await Rs(n,e,(i,a)=>r+=gn(fn(i),a)),t?`<div class="wrapper"><div class="numbers">${"<div></div>".repeat(s.lineNumbers&&n.split(`
`).length-1)}</div><code class="code">${r}</code></div>`:r}async function bn(n,e=n.dataset.codeLang,t,s){let r=n.textContent;t??=`${r.split(`
`).length<2?"one":"multi"}line`,n.className=`${[...n.classList].filter(i=>!i.startsWith("")).join(" ")}code-block ${e} ${t} highlighted`,n.innerHTML=await mn(r,e,t=="multiline",s)}var De=async n=>Promise.all(Array.from(document.querySelectorAll("[data-code-lang]:not(.highlighted)")).map(e=>bn(e,void 0,void 0,n)));var Be=class{constructor(e={}){this.config=new X(e),this.dbManager=new W(this.config),this.ui=new K(document.querySelector("#chat-app-root")),this.host="localhost:11434",this.sessionId=0,this.context=[],this.maxContext=20,this.aiOptions={},this.systemPrompt=this.config.ai.system,this.model="",this.modelList=[],this.initialize(),this.registerEvents()}async initialize(){await this.dbManager.initialize()&&await this.loadChatHistory(),this.ollama=new Q({host:this.host}),await this.loadModels()}registerEvents(){this.ui.root.addEventListener("send-message",async()=>{if(this.ui.root.classList.contains("generating")){this.abortGenerate();return}await this.processChat()}),this.ui.root.addEventListener("new-chat",()=>{this.startNewChat()}),this.ui.root.addEventListener("display-chat",async e=>{await this.displayChatHistory(e.detail.sessionId)}),this.ui.root.addEventListener("model-selected",e=>{this.model=e.detail.model,localStorage.setItem("selectedModel",this.model)})}async processChat(){try{let e=this.ui.textarea.value.trim();if(!e||this.ui.root.classList.contains("generating"))return;this.ui.textarea.value="",this.ui.root.classList.add("generating");let t=!this.ui.root.hasAttribute("data-session-id");t&&(this.sessionId=await this.dbManager.createNewSession(),this.ui.root.setAttribute("data-session-id",this.sessionId),this.ui.addChatHistoryItem(`New Chat ${this.sessionId}`,this.sessionId,"afterbegin")),this.ui.root.classList.remove("initial"),this.ui.renderMessage(e,"user"),this.ui.renderMessage("","assistant"),this.ui.scrollToBottom(),await this.dbManager.addMessage(this.sessionId,{role:"user",content:e}),this.context.push({role:"user",content:e});let s=this.ui.contentContainer.querySelector(".chat__block.assistant:last-child .response_wrapper .response"),r=await this.ollama.chat({model:this.model,messages:[{role:"system",content:this.systemPrompt},...this.context],options:this.aiOptions,stream:!0}),i="";for await(let a of r)i+=a.message.content,s.innerHTML=f.parse(i);if(this.ui.root.classList.remove("generating"),De(),await this.dbManager.addMessage(this.sessionId,{role:"assistant",content:i}),this.context.push({role:"assistant",content:i}),t){let a=await this.ollama.chat({model:this.model,messages:[{role:"system",content:"You are an AI assistant. Generate a concise, engaging title under 6 words that reflects the core intent of the user's first message, from their perspective. The title should summarize the query clearly to aid in future searchability. Respond *only* with the title\u2014no explanations."},{role:"user",content:`Generate a title for this message: '${e}'.`}]});if(a.message.content){let o=a.message.content.replaceAll('"',""),l=this.ui.chatHistoryContainer.querySelector(`.item[data-session-id="${this.sessionId}"]`);l&&(l.textContent=o),await this.dbManager.updateChatHistoryTitle(this.sessionId,o)}}this.context.length>=this.maxContext&&await this.refreshContext(this.context,this.maxContext),console.log(this.context)}catch(e){this.ui.root.classList.remove("generating"),console.error("Error processing chat:",e)}}abortGenerate(){ollama.abort()}startNewChat(){this.ui.root.classList.add("initial"),this.ui.clearChatHistory(),this.ui.textarea.value="",this.ui.root.removeAttribute("data-session-id"),this.context=[]}async loadChatHistory(){try{let e=await this.dbManager.getRecentItems(this.config.stores.sessions.name,100,"updateTime");e.length&&e.forEach(t=>{this.ui.addChatHistoryItem(t.title,t.sessionId)})}catch(e){console.error("Error loading chat history:",e)}}async displayChatHistory(e){try{this.ui.root.classList.remove("initial"),this.ui.clearChatHistory(),this.ui.root.setAttribute("data-session-id",e),this.sessionId=Number(e);let t=await this.dbManager.db.get(this.config.stores.conversations.name,this.sessionId);if(t.messages.length){for(let s of t.messages)s.role==="assistant"?this.ui.renderMessage(f.parse(s.content),s.role):this.ui.renderMessage(s.content,s.role);this.ui.scrollToBottom(),De(),await this.refreshContext(t.messages,this.maxContext),console.log(this.context)}}catch(t){console.error("Error displaying chat history:",t)}}async loadModels(){try{let e=await this.ollama.list();e.models.length?(this.modelList=e.models,localStorage.getItem("selectedModel")||localStorage.setItem("selectedModel",this.modelList[0].name),this.model=localStorage.getItem("selectedModel"),this.ui.populateModelMenu(this.modelList),this.ui.setActiveModel(this.model)):(console.error("At least one model is required"),this.ui.addSystemMessage("At least one model is required"))}catch(e){console.error("Error initializing chat:",e),this.ui.addSystemMessage("Error initializing chat. Check console for details.")}}async refreshContext(e,t=10){try{if(e.length>t){let s=Math.floor(t/2),r=e.filter(a=>a.role==="user").slice(0,s),i=e.slice(-s);this.context=[...r,...i]}else e.length&&(this.context=e)}catch(s){console.error("Error updating context:",s)}}},si=new Be;})();
